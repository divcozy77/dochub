"use strict";(self.webpackChunkvanilla_webpack_app=self.webpackChunkvanilla_webpack_app||[]).push([[792],{114:function(){const t=new Map;function e(e,n){return t.has(e)||t.set(e,new Set),t.get(e).add(n),()=>function(e,n){const a=t.get(e);a&&a.delete(n)}(e,n)}function n(e,n){const a=t.get(e);if(a)for(const t of a)try{t(n)}catch(t){console.error(`[bus:${e}]`,t)}}const a="msaas-docs-state-v1",o="msaas-safe-mode",s=()=>(new Date).toISOString(),i=()=>crypto?.randomUUID?crypto.randomUUID():Math.random().toString(36).slice(2),l=()=>({docs:[{id:i(),title:"Product Vision 2025",description:"North-star doc covering strategy, themes, and bets.",tags:["strategy","vision"],url:"",createdAt:s(),updatedAt:s(),bookmarked:!0,starred:!0},{id:i(),title:"Onboarding Guide",description:"How we ship fast, safely: workflows, rituals, tools.",tags:["onboarding","playbook"],url:"",createdAt:s(),updatedAt:s(),bookmarked:!1,starred:!1},{id:i(),title:"API Reference",description:"Public endpoints, quotas, examples and gotchas.",tags:["api","docs"],url:"",createdAt:s(),updatedAt:s(),bookmarked:!0,starred:!1},{id:i(),title:"Security Review Template",description:"Checklist for new features before launch.",tags:["security","template"],url:"",createdAt:s(),updatedAt:s(),bookmarked:!1,starred:!1}],comments:{},activities:[],savedFilters:[]});let d=function(){try{const t=localStorage.getItem(a);if(!t)return l();const e=JSON.parse(t);return e.savedFilters||(e.savedFilters=[]),e.activities||(e.activities=[]),e.comments||(e.comments={}),e.docs||(e.docs=[]),e}catch{return l()}}();function r(){"1"!==localStorage.getItem(o)&&localStorage.setItem(a,JSON.stringify(d))}function c(t,e){const a={id:i(),type:t,ts:s(),meta:e};d.activities.unshift(a),n("activity:added",a)}const m={all(){return[...d.docs].sort((t,e)=>new Date(e.updatedAt)-new Date(t.updatedAt))},byId(t){return d.docs.find(e=>e.id===t)},search(t){const e=t.trim().toLowerCase();return e?this.all().filter(t=>t.title.toLowerCase().includes(e)||t.description.toLowerCase().includes(e)||(t.tags||[]).some(t=>t.toLowerCase().includes(e))):this.all()},getAllTags(){const t=new Set;for(const e of d.docs)for(const n of e.tags||[])t.add(n);return Array.from(t).sort((t,e)=>t.localeCompare(e))},addDoc({title:t,description:e,tags:a=[],url:o=""}){const l={id:i(),title:t,description:e,tags:a,url:o,createdAt:s(),updatedAt:s(),bookmarked:!1,starred:!1};return d.docs.unshift(l),r(),n("docs:changed"),c("doc:new",{id:l.id,title:l.title}),l},toggleBookmark(t){const e=this.byId(t);e&&(e.bookmarked=!e.bookmarked,e.updatedAt=s(),r(),n("docs:changed"),c(e.bookmarked?"doc:bookmarked":"doc:unbookmarked",{id:t,title:e.title}))},toggleStar(t){const e=this.byId(t);e&&(e.starred=!e.starred,e.updatedAt=s(),r(),n("docs:changed"),c(e.starred?"doc:starred":"doc:unstarred",{id:t,title:e.title}))},updateTags(t,e=[]){const a=this.byId(t);a&&(a.tags=e,a.updatedAt=s(),r(),n("docs:changed"),c("doc:tags",{id:t,title:a.title,tags:e}))},updateTitle(t,e=""){const a=this.byId(t);if(!a)return;const o=String(e||"").trim();o&&(a.title=o,a.updatedAt=s(),r(),n("docs:changed"),c("doc:title",{id:t,title:a.title}))},updateDoc(t,e={}){const a=this.byId(t);a&&(void 0!==e.title&&(a.title=String(e.title||"").trim()),void 0!==e.description&&(a.description=String(e.description||"").trim()),void 0!==e.tags&&(a.tags=Array.isArray(e.tags)?e.tags:[]),void 0!==e.url&&(a.url=String(e.url||"").trim()),void 0!==e.owner&&(a.owner=String(e.owner||"").trim()),void 0!==e.status&&(a.status=String(e.status||"").trim()),void 0!==e.icon&&(a.icon=String(e.icon||"").trim()),void 0!==e.color&&(a.color=String(e.color||"").trim()),a.updatedAt=s(),r(),n("docs:changed"),c("doc:update",{id:t,title:a.title,tags:a.tags}))},remove(t){const e=this.byId(t);e&&(d.docs=d.docs.filter(e=>e.id!==t),delete d.comments[t],r(),n("docs:changed"),c("doc:deleted",{id:t,title:e.title}))},commentsFor(t){return d.comments[t]?[...d.comments[t]]:[]},addComment(t,e,a="You"){d.comments[t]||(d.comments[t]=[]);const o={id:i(),text:e,author:a,ts:s()};d.comments[t].push(o),r(),n("comments:changed",{docId:t,msg:o});const l=this.byId(t);return c("comment:new",{docId:t,title:l?.title||"Unknown",author:a}),o},activities(){return[...d.activities]},counts(){return{all:d.docs.length,bookmarks:d.docs.filter(t=>t.bookmarked).length,starred:d.docs.filter(t=>t.starred).length}},savedFilters(){return[...d.savedFilters]},addFilter({name:t,query:e="",tags:a=[]}){const o={id:i(),name:t,query:e,tags:a};return d.savedFilters.push(o),r(),n("filters:changed"),o},removeFilter(t){d.savedFilters=d.savedFilters.filter(e=>e.id!==t),r(),n("filters:changed")},exportFilters(){return d.savedFilters.map(({name:t,query:e="",tags:n=[]})=>({name:t,query:e,tags:n}))},importFilters(t=[],{overwriteByName:e=!1}={}){const a=Array.isArray(t)?t:JSON.parse(t);let o=0;for(const t of a){const n=String(t.name||"").trim();if(!n)continue;const a=String(t.query||""),s=Array.isArray(t.tags)?t.tags.map(t=>String(t).trim()).filter(Boolean):[];if(e)d.savedFilters=d.savedFilters.filter(t=>t.name!=n);else if(d.savedFilters.some(t=>t.name===n))continue;d.savedFilters.push({id:i(),name:n,query:a,tags:s}),o++}return r(),n("filters:changed"),o},quickImportStarters(){return this.importFilters([{name:"Onboarding",tags:["onboarding"]},{name:"API",tags:["api"]},{name:"Security",tags:["security"]},{name:"Vision & Strategy",tags:["vision","strategy"]}])},renameFilter(t,e){const a=d.savedFilters.find(e=>e.id===t);if(!a)return!1;const o=String(e||"").trim();return!!o&&(!d.savedFilters.some(e=>e.id!==t&&e.name===o)&&(a.name=o,r(),n("filters:changed"),!0))},reorderFilters(t=[]){const e=new Map(d.savedFilters.map(t=>[t.id,t])),a=[];for(const n of t)e.has(n)&&a.push(e.get(n));for(const e of d.savedFilters)t.includes(e.id)||a.push(e);d.savedFilters=a,r(),n("filters:changed")},removeFilters(t=[]){const e=new Set(t);d.savedFilters=d.savedFilters.filter(t=>!e.has(t.id)),r(),n("filters:changed")},renameTag(t,e){const a=String(t||"").trim(),o=String(e||"").trim();if(!a||!o||a===o)return!1;let s=0;return d.docs.forEach(t=>{const e=t.tags||[],n=[];let i=!1;const l=new Set;for(const t of e){const e=t===a?o:t;l.has(e)||n.push(e),l.add(e),e!==t&&(i=!0)}i&&(t.tags=n,s++)}),d.savedFilters.forEach(t=>{const e=t.tags||[],n=[];let i=!1;const l=new Set;for(const t of e){const e=t===a?o:t;l.has(e)||n.push(e),l.add(e),e!==t&&(i=!0)}i&&(t.tags=n,s++)}),r(),n("docs:changed"),n("filters:changed"),s},deleteTag(t){const e=String(t||"").trim();if(!e)return!1;let a=0;return d.docs.forEach(t=>{const n=t.tags||[],o=n.filter(t=>t!==e);o.length!==n.length&&(t.tags=o,a++)}),d.savedFilters.forEach(t=>{const n=t.tags||[],o=n.filter(t=>t!==e);o.length!==n.length&&(t.tags=o,a++)}),r(),n("docs:changed"),n("filters:changed"),a},mergeTags(t=[],e){const n=String(e||"").trim();if(!n||!Array.isArray(t)||0===t.length)return!1;const a=new Set(t.map(t=>String(t||"").trim()).filter(Boolean));a.delete(n);let o=0;for(const t of a)o+=this.renameTag(t,n)||0;return o},isSafeMode(){return"1"===localStorage.getItem(o)},setSafeMode(t){t?localStorage.setItem(o,"1"):localStorage.removeItem(o)}};function u(t=""){return t.replace(/[&<>"]/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"}[t]))}function b(t=[]){return(t||[]).map(t=>`\n    <button type="button" class="badge badge-elevated me-1 tag-badge tag-badge-link" \n            data-action="filter-tag" data-tag="${u(t)}" title="Filter by #${u(t)}">#${u(t)}</button>`).join("")}function g(t=""){return(t=(t||"").toLowerCase()).includes("publish")?"text-success-emphasis bg-success-subtle":t.includes("review")?"text-warning-emphasis bg-warning-subtle":t.includes("draft")?"text-secondary-emphasis bg-secondary-subtle":t.includes("archive")?"text-body-secondary bg-body-secondary-subtle":"text-secondary-emphasis bg-secondary-subtle"}function p(t){const e=new Date(t),n=Math.floor((Date.now()-e)/1e3),a=(t,e)=>`${t} ${e}${t>1?"s":""} ago`;if(n<60)return a(n,"sec");const o=Math.floor(n/60);if(o<60)return a(o,"min");const s=Math.floor(o/60);if(s<24)return a(s,"hr");const i=Math.floor(s/24);if(i<30)return a(i,"day");const l=Math.floor(i/30);if(l<12)return a(l,"mo");return a(Math.floor(l/12),"yr")}function v(t){const e=t.url?`<a href="${t.url}" target="_blank" rel="noopener" class="btn btn-outline-secondary"><i class="bi bi-box-arrow-up-right"></i></a>`:"";return`\n  <div class="col-12 col-sm-6 col-xl-4" data-id="${t.id}">\n    <div class="card doc h-100" ${t.color?`style="border-left:4px solid ${u(t.color)}"`:""}>\n      <div class="card-body d-flex flex-column">\n        <div class="d-flex justify-content-between align-items-start mb-2">\n          <h5 class="card-title me-2">${u(t.title)}</h5>\n          <div class="btn-group doc-actions" role="group">\n            ${e}\n            <button class="btn btn-outline-secondary" data-action="comment" title="Comments"><i class="bi bi-chat"></i></button>\n            <button class="btn ${t.bookmarked?"btn-secondary":"btn-outline-secondary"}" data-action="bookmark" title="Bookmark"><i class="bi bi-bookmark${t.bookmarked?"-fill":""}"></i></button>\n            <button class="btn ${t.starred?"btn-warning":"btn-outline-warning"}" data-action="star" title="Star"><i class="bi bi-star${t.starred?"-fill":""}"></i></button>\n            ${window.Auth?.canEdit?.()?'<button class="btn btn-outline-secondary" data-action="edit-doc" title="Edit"><i class="bi bi-pencil-square"></i></button>':""}\n            <button class="btn btn-outline-secondary" data-action="edit-tags" title="Edit tags"><i class="bi bi-tags"></i></button>\n            <button class="btn btn-outline-danger" data-action="delete" title="Delete"><i class="bi bi-trash"></i></button>\n          </div>\n        </div>\n        ${t.owner||t.status||t.icon||t.color?`\n        <div class="doc-meta d-flex align-items-center gap-2 mb-2 text-body-secondary">\n          ${t.icon?`<span class="doc-icon">${u(t.icon)}</span>`:""}\n          ${t.color?`<span class="doc-color-dot" style="background:${u(t.color)}"></span>`:""}\n          ${t.owner?`<span class="doc-owner">By ${u(t.owner)}</span>`:""}\n          ${t.status?`<button type="button" class="badge rounded-pill ms-auto ${g(t.status)}" data-action="filter-status" data-status="${u(t.status)}" title="Filter by status">${u(t.status)}</button>`:""}\n        </div>`:""}\n        <p class="card-text flex-grow-1">${u(t.description)}</p>\n\n        <div class="d-flex justify-content-between align-items-center">\n          <div class="d-flex flex-wrap gap-1" style="max-width:60%">${b(t.tags)}</div>\n          <small class="text-body-secondary">Updated ${p(t.updatedAt)}</small>\n        </div>\n\n        <div class="tag-editor d-none mt-2">\n          <div class="input-group input-group-sm">\n            <input type="text" class="form-control" placeholder="tag1, tag2" value="${u((t.tags||[]).join(", "))}" list="all-tags">\n            <button class="btn btn-primary" data-action="save-tags">Save</button>\n            <button class="btn btn-outline-secondary" data-action="cancel-tags">Cancel</button>\n          </div>\n          <div class="form-text">Separate tags with commas.</div>\n        </div>\n\n      </div>\n    </div>\n  </div>`}function f(t){const e=t.url?`<a href="${t.url}" target="_blank" rel="noopener" class="btn btn-outline-secondary"><i class="bi bi-box-arrow-up-right"></i></a>`:"";return`\n  <div class="col-12 col-sm-6 col-xl-4" data-id="${t.id}">\n    <div class="card doc h-100" ${t.color?`style="border-left:4px solid ${u(t.color)}"`:""}>\n      <div class="card-body d-flex flex-column">\n        <div class="d-flex justify-content-between align-items-start mb-2">\n          <h5 class="card-title me-2">${u(t.title)}</h5>\n          <div class="btn-group doc-actions" role="group">\n            ${e}\n            <button class="btn btn-outline-secondary" data-action="comment" title="Comments"><i class="bi bi-chat"></i></button>\n          </div>\n        </div>\n        ${t.owner||t.status||t.icon||t.color?`\n        <div class="doc-meta d-flex align-items-center gap-2 mb-2 text-body-secondary">\n          ${t.icon?`<span class="doc-icon">${u(t.icon)}</span>`:""}\n          ${t.color?`<span class="doc-color-dot" style="background:${u(t.color)}"></span>`:""}\n          ${t.owner?`<span class="doc-owner">By ${u(t.owner)}</span>`:""}\n          ${t.status?`<button type="button" class="badge rounded-pill ms-auto ${g(t.status)}" data-action="filter-status" data-status="${u(t.status)}" title="Filter by status">${u(t.status)}</button>`:""}\n        </div>`:""}\n        <p class="card-text flex-grow-1">${u(t.description)}</p>\n\n        <div class="d-flex justify-content-between align-items-center">\n          <div class="d-flex flex-wrap gap-1" style="max-width:60%">${b(t.tags)}</div>\n          <small class="text-body-secondary">Updated ${p(t.updatedAt)}</small>\n        </div>\n\n        <div class="tag-editor d-none mt-2">\n          <div class="input-group input-group-sm">\n            <input type="text" class="form-control" placeholder="tag1, tag2" value="${u((t.tags||[]).join(", "))}" list="all-tags">\n            <button class="btn btn-primary" data-action="save-tags">Save</button>\n            <button class="btn btn-outline-secondary" data-action="cancel-tags">Cancel</button>\n          </div>\n          <div class="form-text">Separate tags with commas.</div>\n        </div>\n\n      </div>\n    </div>\n  </div>`}function y(t,e="primary"){const n=document.getElementById("toast-holder"),a=document.createElement("div");a.className=`toast align-items-center text-bg-${e} border-0`,a.role="status",a.ariaLive="polite",a.ariaAtomic="true",a.innerHTML=`\n    <div class="d-flex">\n      <div class="toast-body">${t}</div>\n      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>\n    </div>`,n.appendChild(a);new window.bootstrap.Toast(a,{delay:2200}).show(),a.addEventListener("hidden.bs.toast",()=>a.remove())}function h(){const t=m.counts();document.getElementById("count-all").textContent=t.all,document.getElementById("count-bookmarks").textContent=t.bookmarks,document.getElementById("count-starred").textContent=t.starred}let k,w,S,x,E,I,B,L;const A=new Set;function $(t){const e=function(t){const e=t;return 0===A.size?e:e.filter(t=>{const e=Array.from(A).filter(t=>String(t).toLowerCase().startsWith("status:")).map(t=>String(t).toLowerCase().slice(7)),n=new Set((t.tags||[]).map(t=>t.toLowerCase()));for(const t of A){const e=String(t).toLowerCase();if(!e.startsWith("status:")&&!n.has(e))return!1}if(e.length){const n=String(t.status||"").toLowerCase();if(!e.includes(n))return!1}return!0})}(w.value?m.search(w.value):m.all());k.innerHTML=e.length?e.map(v).join(""):`\n  <div class="col-12">\n    <div class="text-center text-body-secondary py-5">\n      <i class="bi bi-folder2-open" style="font-size:3rem"></i>\n      <div class="mt-2">${"No documents match your filters."}</div>\n    </div>\n  </div>`,h(),function(){if(0===A.size)x.classList.add("d-none"),S.innerHTML="";else{x.classList.remove("d-none");const t=Array.from(A).map(t=>`\n      <span class="filter-chip" data-chip="${t}">${String(t).toLowerCase().startsWith("status:")?M(String(t).slice(7)):""}${F(t)}\n        <button class="remove" type="button" data-action="remove-chip" aria-label="Remove tag ${t}"><i class="bi bi-x-lg"></i></button>\n      </span>`).join(""),e='<button type="button" class="btn btn-sm btn-outline-secondary filter-clear" data-action="clear-chips"><i class="bi bi-x-circle"></i> Clear</button>';S.innerHTML=t+e}C()}()}function T(t=""){return String(t).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;")}function F(t=""){const e=String(t);if(e.toLowerCase().startsWith("status:")){const t=e.slice(7);return`Status: ${T(t?t.charAt(0).toUpperCase()+t.slice(1):"")}`}return`#${T(e)}`}function M(t=""){const e=String(t||"").toLowerCase(),n=t=>`<i class="bi bi-circle-fill me-1" style="font-size:.6rem;color:${t}"></i>`;return e.includes("publish")?n("#16a34a"):e.includes("review")?n("#f59e0b"):e.includes("draft")?n("#6c757d"):e.includes("archive")?n("#64748b"):n("#6c757d")}function C(){const t=m.savedFilters();E.innerHTML=t.length?t.map(t=>`\n    <span class="smart-chip d-inline-flex flex-column align-items-start" data-id="${t.id}">\n      <div class="w-100 d-flex align-items-center gap-1">\n        <button class="apply" type="button" data-action="apply-saved" title="Apply filter">${t.name}</button>\n        <button class="remove" type="button" data-action="remove-saved" title="Remove saved filter ${t.name}"><i class="bi bi-x-circle"></i></button>\n      </div>\n      ${Array.isArray(t.tags)&&t.tags.length?`\n        <div class="saved-preview small mt-1">\n          ${t.tags.map(t=>`<span class="badge bg-body-tertiary border me-1">${String(t).toLowerCase().startsWith("status:")?M(String(t).slice(7)):""}${F(t)}</span>`).join("")}\n        </div>`:""}\n    </span>`).join(""):'<span class="text-body-secondary small">No saved filters yet.</span>'}function D(t,e=!0){const n=t.querySelector(".tag-editor");n&&(n.classList.toggle("d-none",!e),e&&n.querySelector("input")?.focus())}function q(t){const e=t.target.closest("button");if(!e)return;const a=t.target.closest("[data-id]"),o=a?.dataset?.id;if(!o)return;const s=e.dataset.action;if("bookmark"===s&&(m.toggleBookmark(o),y("Bookmark toggled","secondary")),"star"===s&&(m.toggleStar(o),y("Star toggled","warning")),"delete"===s){const t=a.querySelector(".doc-title,.card-title")?.textContent?.trim();return void niceConfirm(`Delete ${t?`"${t}"`:"this document"}?\nThis action cannot be undone.`,{okText:"Delete",cancelText:"Cancel",variant:"danger"}).then(t=>{t&&("function"==typeof m.deleteDoc?m.deleteDoc(o,{confirmed:!0}):"function"==typeof m.remove?m.remove(o):"function"==typeof m.del&&m.del(o),y("Document deleted","danger"),$(m.all()))})}if("comment"===s&&n("comments:open",{docId:o}),"filter-status"===s){const t="status:"+(e.dataset.status||"").toLowerCase();return A.has(t)?A.delete(t):A.add(t),void $(m.all())}if("filter-tag"===s){const t=e.dataset.tag||"";return A.has(t)?A.delete(t):A.add(t),void $(m.all())}if("edit-doc"!==s){if("edit-tags"===s){const t=e.closest(".card"),n=!1===t.querySelector(".tag-editor")?.classList.contains("d-none");return k.querySelectorAll(".tag-editor").forEach(t=>t.classList.add("d-none")),void D(t,!n)}if("save-tags"===s){const t=e.closest(".card").querySelector(".tag-editor input"),n=(t?.value||"").split(",").map(t=>t.trim()).filter(Boolean);return m.updateTags(o,n),y("Tags updated","primary"),void $(m.all())}if("cancel-tags"===s){return void D(e.closest(".card"),!1)}$(m.all())}else!function(t){const e=(t,e,n)=>{const a=t?.querySelector(`[name="${e}"]`);a&&(a.value=n??"")},n=m.byId(t);if(!n)return;const a=document.getElementById("editDocForm");a.dataset.mode="edit",a.dataset.id=t,a.querySelector('[name="title"]').value=n.title||"",a.querySelector('[name="description"]').value=n.description||"",a.querySelector('[name="tags"]').value=(n.tags||[]).join(", "),e(a,"url",n.url||""),e(a,"owner",n.owner||""),e(a,"status",n.status||""),e(a,"icon",n.icon||""),e(a,"color",n.color||"#2563eb");const o=document.getElementById("editDocModal"),s=o.querySelector(".modal-title"),i=a.querySelector('button[type="submit"]');s&&(s.textContent="Edit Document");i&&(i.textContent="Save");o.addEventListener("show.bs.modal",function t(){o.removeAttribute("inert"),o.removeEventListener("show.bs.modal",t)});(window.bootstrap.Modal.getInstance(o)||new window.bootstrap.Modal(o)).show()}(o)}function O(t){const e=t.target.closest('[data-action="remove-chip"]'),n=t.target.closest('[data-action="clear-chips"]'),a=t.target.closest('[data-action="apply-saved"]'),o=t.target.closest('[data-action="remove-saved"]');if(e){const t=e.closest("[data-chip]")?.dataset?.chip;return t&&A.delete(t),void $(m.all())}if(n)return A.clear(),void $(m.all());if(a){const t=a.closest("[data-id]")?.dataset?.id,e=m.savedFilters().find(e=>e.id===t);if(e){A.clear();for(const t of e.tags||[])A.add(t);w.value=e.query||"",$(m.all())}return}if(o){const t=o.closest("[data-id]")?.dataset?.id;m.removeFilter(t),C(),y("Saved filter removed","secondary")}}function N(){!function(t){const e=document.getElementById(t);if(!e)return;e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),e.setAttribute("aria-modal","true");let n=bootstrap.Modal.getInstance(e);n||(n=new bootstrap.Modal(e,{focus:!0,backdrop:!0,keyboard:!0}));n.show()}("addDocModal")}function j(){k=document.getElementById("grid-all"),w=document.getElementById("searchInput"),S=document.getElementById("active-tags"),x=document.getElementById("filtersBar"),E=document.getElementById("saved-filters"),I=document.getElementById("btnSaveFilter"),L=document.getElementById("btnQuickImport"),B=document.getElementById("addDocButton"),k.addEventListener("click",q),S.addEventListener("click",O),E.addEventListener("click",O),B.addEventListener("click",N),function(){const t=document.getElementById("addDocModal"),e=document.getElementById("addDocForm");e.addEventListener("submit",n=>{n.preventDefault();const a=new FormData(e),o=a.get("title")?.toString().trim(),s=a.get("description")?.toString().trim(),i=(a.get("tags")?.toString()||"").split(",").map(t=>t.trim()).filter(Boolean),l=a.get("url")?.toString().trim(),d=a.get("owner")?.toString().trim()||"",r=a.get("status")?.toString().trim()||"",c=a.get("icon")?.toString().trim()||"",u=a.get("color")?.toString().trim()||"";o&&s&&(m.addDoc({title:o,description:s,tags:i,url:l,owner:d,status:r,icon:c,color:u}),y(`Added “${o}”`,"primary"),e.reset(),e.dataset.mode="",e.dataset.id="",(window.bootstrap.Modal.getInstance(t)||new window.bootstrap.Modal(t)).hide(),$(m.all()))})}(),function(){const t=document.getElementById("editDocForm");t.addEventListener("submit",e=>{e.preventDefault();const n=new FormData(t),a=n.get("title")?.toString().trim(),o=n.get("description")?.toString().trim(),s=(n.get("tags")?.toString()||"").split(",").map(t=>t.trim()).filter(Boolean),i=n.get("url")?.toString().trim(),l=n.get("owner")?.toString().trim()||"",d=n.get("status")?.toString().trim()||"",r=n.get("icon")?.toString().trim()||"",c=n.get("color")?.toString().trim()||"";if(!a||!o)return;const u=t.dataset.id;m.updateDoc(u,{title:a,description:o,tags:s,url:i,owner:l,status:d,icon:r,color:c}),y("Saved changes","primary"),t.reset(),t.dataset.mode="",t.dataset.id="";const b=document.getElementById("editDocModal");(window.bootstrap.Modal.getInstance(b)||new window.bootstrap.Modal(b)).hide(),$(m.all())})}(),I.addEventListener("click",()=>{const t=document.getElementById("saveFilterModal"),e=window.bootstrap.Modal.getInstance(t)||new window.bootstrap.Modal(t);document.getElementById("saveFilterName").value="",e.show()}),document.getElementById("saveFilterForm").addEventListener("submit",t=>{t.preventDefault();const e=document.getElementById("saveFilterName").value.trim(),n=w.value.trim(),a=Array.from(A);if(!e)return;if(!n&&0===a.length)return void y("Nothing to save — add text or tag filters first","warning");m.addFilter({name:e,query:n,tags:a}),y("Saved filter","primary"),C();const o=document.getElementById("saveFilterModal");window.bootstrap.Modal.getInstance(o).hide()}),e("filters:changed",C),L.addEventListener("click",()=>{const t=m.quickImportStarters();C(),y(`${t} starter filter${1===t?"":"s"} added`,t?"primary":"secondary")}),document.getElementById("importFiltersForm").addEventListener("submit",t=>{t.preventDefault();try{const t=document.getElementById("importFiltersJson").value.trim(),e=m.importFilters(JSON.parse(t));y(`${e} filter${1===e?"":"s"} imported`,"primary"),C();const n=document.getElementById("importFiltersModal");window.bootstrap.Modal.getInstance(n).hide()}catch(t){y("Invalid JSON","danger")}}),$(m.all()),w.addEventListener("input",()=>$(m.search(w.value))),e("docs:changed",()=>{$(m.all())}),document.addEventListener("force:rerender",()=>{$(m.all())})}let R,P,U,H,J,K,z,W,Q;function V(){const t=m.all().filter(t=>t.bookmarked);R.innerHTML=t.map(f).join("")||`<div class="col-12 text-center text-body-secondary py-5">\n    <i class="bi bi-bookmark" style="font-size:3rem"></i>\n    <div class="mt-2">${"No bookmarks yet."}</div>\n  </div>`}function _(){const t=m.all().filter(t=>t.starred);P.innerHTML=t.map(f).join("")||`<div class="col-12 text-center text-body-secondary py-5">\n    <i class="bi bi-star" style="font-size:3rem"></i>\n    <div class="mt-2">${"No starred documents yet."}</div>\n  </div>`}function Y(t){const e="You"===t.author;return`<div class="d-flex ${e?"justify-content-end":""}">\n    <div class="msg ${e?"me":"other"} p-2 mb-2" style="max-width: 80%">\n      <div class="small text-body-secondary mb-1">${u(t.author)} · ${p(t.ts)}</div>\n      <div>${u(t.text)}</div>\n    </div>\n  </div>`}function G(){const t=m.commentsFor(W);H.innerHTML=t.map(Y).join("")||'<div class="text-body-secondary">No comments yet. Start the discussion!</div>',H.scrollTop=H.scrollHeight}function X(t){t.preventDefault();const e=K.value.trim();e&&(m.addComment(W,e),K.value="",G())}function Z(){H=document.getElementById("thread"),J=document.getElementById("thread-meta"),K=document.getElementById("commentInput"),z=document.getElementById("commentForm"),z.addEventListener("submit",X),e("comments:open",({docId:t})=>function(t){W=t;const e=m.byId(t);J.innerHTML=`<strong>${u(e.title)}</strong> · ${e.tags.map(t=>`#${u(t)}`).join(" ")}`,G();const n=document.getElementById("commentsPanel");U=window.bootstrap.Offcanvas.getInstance(n)||new window.bootstrap.Offcanvas(n),U.show()}(t)),e("comments:changed",({docId:t})=>{t===W&&G()})}const tt={"doc:new":"bi-file-earmark-plus","doc:deleted":"bi-trash","doc:starred":"bi-star-fill","doc:unstarred":"bi-star","doc:bookmarked":"bi-bookmark-fill","doc:unbookmarked":"bi-bookmark","comment:new":"bi-chat-dots","doc:tags":"bi-tags"};function et(t){const e=tt[t.type]||"bi-activity",n=u(t.meta?.title||""),a=u(t.meta?.author||"");let o="";return"comment:new"===t.type&&(o=`${a} commented on <strong>${n}</strong>`),"doc:new"===t.type&&(o=`New document <strong>${n}</strong>`),"doc:deleted"===t.type&&(o=`Deleted <strong>${n}</strong>`),"doc:starred"===t.type&&(o=`Starred <strong>${n}</strong>`),"doc:unstarred"===t.type&&(o=`Unstarred <strong>${n}</strong>`),"doc:bookmarked"===t.type&&(o=`Bookmarked <strong>${n}</strong>`),"doc:unbookmarked"===t.type&&(o=`Removed bookmark on <strong>${n}</strong>`),"doc:tags"===t.type&&(o=`Updated tags on <strong>${n}</strong>`),`<div class="d-flex align-items-start gap-3">\n    <div class="rounded-circle bg-body-secondary d-flex align-items-center justify-content-center" style="width:38px;height:38px">\n      <i class="bi ${e}"></i>\n    </div>\n    <div class="flex-grow-1">\n      <div>${o}</div>\n      <div class="small text-body-secondary">${p(t.ts)}</div>\n    </div>\n  </div>`}function nt(){const t=m.activities();Q.innerHTML=t.map(et).join("")||'<div class="text-body-secondary">No activity yet.</div>'}const at="msaas-user-role",ot={getRole(){return localStorage.getItem(at)||"admin"},setRole(t="viewer"){localStorage.setItem(at,t)},isAdmin(){return"admin"===this.getRole()},canEdit(){return this.isAdmin()}};let st,it,lt,dt,rt;function ct(t){const e=(t.tags||[]).join(", ");return`\n    <li class="list-group-item p-0" draggable="true" data-id="${t.id}">\n      <div class="mf-row">\n        <span class="mf-handle bi bi-grip-vertical" title="Drag to reorder"></span>\n        <input class="form-check-input mf-check" type="checkbox" aria-label="Select ${t.name}">\n        <input class="form-control form-control-sm mf-input mf-name" value="${mt(t.name)}" />\n        <div class="small text-body-secondary mf-tags">${mt(e)}</div>\n        <button type="button" class="btn btn-sm btn-outline-danger mf-del-one" title="Delete"><i class="bi bi-trash"></i></button>\n      </div>\n    </li>`}function mt(t=""){return String(t).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;")}function ut(){const t=m.savedFilters();st.innerHTML=t.length?t.map(ct).join(""):'<li class="list-group-item text-body-secondary">No saved filters.</li>'}function bt(){if(!function(){const t=[...st.querySelectorAll(".mf-input")];let e=!0;const n=new Set;for(const a of t){const t=a.value.trim();a.classList.remove("is-invalid"),t||(a.classList.add("is-invalid"),e=!1),n.has(t)&&(a.classList.add("is-invalid"),e=!1),n.add(t)}return e}())return void y("Fix invalid/duplicate names","danger");const t=[...st.querySelectorAll('[draggable="true"]')];for(const e of t){const t=e.dataset.id,n=e.querySelector(".mf-name").value.trim();if(!m.renameFilter(t,n))return e.querySelector(".mf-name").classList.add("is-invalid"),void y(`Could not rename “${n}”`,"danger")}m.reorderFilters([...st.querySelectorAll('[draggable="true"]')].map(t=>t.dataset.id)),y("Filters updated","primary"),ut()}function gt(){const t=[...st.querySelectorAll(".mf-check:checked")].map(t=>t.closest('[draggable="true"]').dataset.id);0!==t.length?confirm(`Delete ${t.length} filter${1===t.length?"":"s"}? This cannot be undone.`)&&(m.removeFilters(t),y("Deleted","secondary"),ut()):y("No filters selected","secondary")}function pt(){rt=document.getElementById("btnManageFilters"),st=document.getElementById("mf-list"),it=document.getElementById("mf-select-all"),lt=document.getElementById("mf-save"),dt=document.getElementById("mf-delete"),rt&&st&&(rt.addEventListener("click",()=>{ut();const t=document.getElementById("manageFiltersModal");(window.bootstrap.Modal.getInstance(t)||new window.bootstrap.Modal(t)).show()}),lt.addEventListener("click",bt),dt.addEventListener("click",gt),st.addEventListener("click",t=>{const e=t.target.closest(".mf-del-one");if(!e)return;const n=e.closest('[draggable="true"]').dataset.id;m.removeFilters([n]),ut()}),it.addEventListener("change",()=>{st.querySelectorAll(".mf-check").forEach(t=>t.checked=it.checked)}),function(){let t=null;st.addEventListener("dragstart",e=>{t=e.target.closest('[draggable="true"]'),e.dataTransfer.effectAllowed="move"}),st.addEventListener("dragover",e=>{const n=e.target.closest('[draggable="true"]');if(!t||!n||n===t)return;e.preventDefault(),n.classList.add("drag-over");const a=n.getBoundingClientRect(),o=e.clientY-a.top<a.height/2;st.insertBefore(t,o?n:n.nextSibling)}),st.addEventListener("dragleave",t=>{t.target.closest('[draggable="true"]')?.classList.remove("drag-over")}),st.addEventListener("drop",e=>{e.preventDefault(),st.querySelectorAll(".drag-over").forEach(t=>t.classList.remove("drag-over")),t=null})}())}window.Auth=ot;const vt="msaas-docs-state-v1";function ft(){try{const t=localStorage.getItem(vt);return t?JSON.parse(t):{docs:[],comments:{},activities:[],savedFilters:[]}}catch(t){return{docs:[],comments:{},activities:[],savedFilters:[]}}}let yt,ht,kt,wt,St,xt,Et,It;function Bt(t=""){return String(t).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[t]))}function Lt(){const t=(wt?.value||"").trim().toLowerCase(),e=function(){const t=new Map,e=(e,n)=>{const a=String(e||"").trim();if(!a)return;const o=t.get(a)||{docs:0,filters:0};o[n]+=1,t.set(a,o)},n=m.all();for(const t of n){const n=new Set((t.tags||[]).filter(Boolean));for(const t of n)e(t,"docs")}const a=m.savedFilters();for(const t of a){const n=new Set((t.tags||[]).filter(Boolean));for(const t of n)e(t,"filters")}return[...t.entries()].sort((t,e)=>t[0].localeCompare(e[0]))}().filter(([e])=>!t||e.toLowerCase().includes(t)).map(([t,e])=>function(t,e){return`<tr data-name="${Bt(t)}"><td class="text-center" style="width:36px"><input class="form-check-input tag-check" type="checkbox" aria-label="Select ${Bt(t)}"></td><td><code>#${Bt(t)}</code></td><td class="text-end"><span class="badge bg-light text-body">Docs: ${e.docs}</span></td><td class="text-end"><span class="badge bg-light text-body">Filters: ${e.filters}</span></td><td class="text-end" style="width:40px"><button type="button" class="btn btn-sm btn-outline-secondary one-rename" title="Rename…"><i class="bi bi-pencil"></i></button></td></tr>`}(t,e)).join("");kt.innerHTML=e||'<tr><td colspan="5" class="text-body-secondary py-4 text-center">No tags found.</td></tr>'}function At(t,e=null){const n=[...kt.querySelectorAll(".tag-check:checked")].map(t=>t.closest("tr")?.dataset?.name).filter(Boolean);return t&&n.length<t||null!=e&&n.length!==e?(y(null!=e?`Select exactly ${e} tag${1===e?"":"s"}`:`Select at least ${t} tag${1===t?"":"s"}`,"warning"),null):n}function $t(t,e){const n=String(e||"").trim();if(!n)return void y("Enter a new tag name","warning");if(n===t)return void y("New name is the same","secondary");!1!==(m.renameTag?m.renameTag(t,n):null)?(Lt(),y(`Renamed #${t} → #${n}`,"primary")):y("Rename failed","danger")}function Tt(){wt.addEventListener("input",Lt),kt.addEventListener("click",t=>{const e=t.target.closest(".one-rename");if(!e)return;const n=e.closest("tr"),a=n?.dataset?.name;if(!a)return;const o=prompt(`Rename #${a} to:`);null!=o&&$t(a,o)}),St.addEventListener("click",()=>{const t=At(1,1);if(!t)return;const e=It.value.trim()||prompt(`Rename #${t[0]} to:`)||"";e&&($t(t[0],e),It.value="")}),xt.addEventListener("click",()=>{const t=At(2,null);if(!t)return;const e=It.value.trim()||prompt("Merge into (target tag):")||"";e&&(!function(t,e){const n=String(e||"").trim();if(n){if(m.mergeTags)m.mergeTags(t,n);else{if(!m.renameTag)return void y("Store API missing: renameTag/mergeTags","danger");{const e=new Set(t);for(const t of e)t!==n&&m.renameTag(t,n)}}Lt(),y(`Merged ${t.length} tag(s) into #${n}`,"primary")}else y("Enter a target tag name","warning")}(t,e),It.value="")}),Et.addEventListener("click",()=>{const t=At(1,null);t&&function(t){if(confirm(`Delete ${t.length} tag${1===t.length?"":"s"} from all docs and filters?`)){if(m.deleteTag)for(const e of t)m.deleteTag(e);else{const e=m.all();for(const n of e){const e=(n.tags||[]).filter(e=>!t.includes(e));e.length!==(n.tags||[]).length&&m.updateTags(n.id,e)}}Lt(),y("Deleted","secondary")}}(t)})}let Ft=null,Mt=null;function Ct(t){Mt&&Mt.classList.remove("kbd-active"),Mt=t,t?(t.classList.add("kbd-active"),Ft=t.getAttribute("data-id")||t.getAttribute("data-doc-id")):Ft=null}function Dt(){if(Ft)return Ft;const t=document.querySelector(".doc-card,[data-id],[data-doc-id]");return t&&Ct(t.closest("[data-id],[data-doc-id]")||t),Ft}function qt(t){if(!function(t){const e=t.target,n=(e.tagName||"").toLowerCase();return e.isContentEditable||"true"===e.getAttribute?.("contenteditable")||"input"===n||"textarea"===n||"select"===n}(t))return"/"===t.key&&!t.shiftKey||"k"===t.key&&t.ctrlKey?(t.preventDefault(),void function(){const t=["inputSearch","search","q"];for(const e of t){const t=document.getElementById(e);if(t)return t.focus(),void t.select?.()}const e=document.querySelector('input[type="search"], input[name*="search" i]');e&&(e.focus(),e.select?.())}()):"?"===t.key||"k"===t.key.toLowerCase()&&t.metaKey?(t.preventDefault(),void function(){const t=document.getElementById("shortcutsModal");if(!t)return;const e=window.bootstrap?.Modal?.getInstance(t)||new window.bootstrap.Modal(t);t.classList.contains("show")?e.hide():e.show()}()):"s"!==t.key.toLowerCase()||t.ctrlKey||t.metaKey||t.altKey?"b"!==t.key.toLowerCase()||t.ctrlKey||t.metaKey||t.altKey?"e"!==t.key.toLowerCase()||t.ctrlKey||t.metaKey||t.altKey?void 0:(t.preventDefault(),void function(){const t=Dt();if(!t)return y("Select a card first (click it)","secondary");const e=Mt,n=e?.querySelector?.('.btn-edit-tags,[data-action="edit-tags"]');if(n)return void n.click();const a=m.byId?.(t),o=(a?.tags||[]).join(", "),s=prompt("Edit tags (comma-separated):",o);if(null==s)return;const i=s.split(",").map(t=>t.trim()).filter(Boolean);m.updateTags?.(t,i),y("Tags updated","primary")}()):(t.preventDefault(),void function(){const t=Dt();if(!t)return y("Select a card first (click it)","secondary");m.toggleBookmark?.(t),y("Toggled bookmark","primary")}()):(t.preventDefault(),void function(){const t=Dt();if(!t)return y("Select a card first (click it)","secondary");m.toggleStar?.(t),y("Toggled star","primary")}())}let Ot=!1;const Nt=new Set;let jt,Rt,Pt,Ut,Ht,Jt,Kt,zt,Wt,Qt;function Vt(t,e){const n=document.querySelector(`[data-id],[data-doc-id],.doc-card[data-id="${t}"]`)||document.querySelector(`[data-id],[data-doc-id],.doc-card[data-doc-id="${t}"]`);n&&(n.classList.toggle("bulk-selected",e),n.setAttribute("aria-selected",e?"true":"false"))}function _t(){Rt&&(Rt.textContent=String(Nt.size)),jt&&jt.classList.toggle("d-none",!Ot)}function Yt(t){if(Ot=void 0===t?!Ot:!!t,document.body.classList.toggle("bulk-mode",Ot),!Ot){for(const t of Array.from(Nt))Vt(t,!1);Nt.clear()}_t()}function Gt(){return 0!==Nt.size||(y("No items selected","secondary"),!1)}function Xt(t){if(!Gt())return;let e=0;for(const n of Nt){const a=m.byId?.(n);if(!a)continue;const o=!!t;(a.starred||!1)!==o&&(m.toggleStar?.(n),e++)}y(`${t?"Starred":"Unstarred"} ${e} item(s)`,"primary")}function Zt(t){if(!Gt())return;let e=0;for(const n of Nt){const a=m.byId?.(n);if(!a)continue;const o=!!t;(a.bookmarked||!1)!==o&&(m.toggleBookmark?.(n),e++)}y(`${t?"Bookmarked":"Unbookmarked"} ${e} item(s)`,"primary")}function te(t,e=""){const n=prompt(t,e);if(null==n)return null;const a=String(n).trim();return a||(y("Tag cannot be empty","warning"),null)}function ee(){if(!Gt())return;const t=te("Add tag to selected:","");if(null==t)return;let e=0;for(const n of Nt){const a=m.byId?.(n);if(!a)continue;const o=Array.from(new Set([...a.tags||[],t]));o.length!==(a.tags||[]).length&&(m.updateTags?.(n,o),e++)}y(`Added #${t} to ${e} item(s)`,"primary")}function ne(){if(!Gt())return;const t=te("Remove which tag from selected?","");if(null==t)return;let e=0;for(const n of Nt){const a=m.byId?.(n);if(!a)continue;const o=a.tags||[],s=o.filter(e=>e!==t);s.length!==o.length&&(m.updateTags?.(n,s),e++)}y(`Removed #${t} from ${e} item(s)`,"secondary")}const ae="msaas-safe-mode";function oe(){return"1"===localStorage.getItem(ae)}function se(t){const e=oe();t?.classList.toggle("btn-outline-danger",e),t?.classList.toggle("btn-outline-secondary",!e),t?.setAttribute("aria-pressed",e?"true":"false");const n=t?.querySelector("i");n&&(n.className=e?"bi bi-shield-lock-fill":"bi bi-shield-lock");const a=t?.querySelector(".label");a&&(a.textContent=e?"Safe ON":"Safe OFF");const o=document.getElementById("safeBadge");o&&o.classList.toggle("d-none",!e)}window.addEventListener("DOMContentLoaded",()=>{!function(){const t="msaas-theme",e=document.documentElement,n=document.getElementById("btnTheme"),a=a=>{e.setAttribute("data-bs-theme",a),n.innerHTML=`<i class="bi ${"dark"===a?"bi-moon-stars":"bi-sun"}"></i>`,localStorage.setItem(t,a)},o=localStorage.getItem(t)||"light";a(o),n.addEventListener("click",()=>a("light"===e.getAttribute("data-bs-theme")?"dark":"light"))}(),document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(t=>new window.bootstrap.Tooltip(t)),function(){const t="msaas-brand",e=document.getElementById("btnPalette"),n=document.documentElement,a=["default","emerald","amber","ruby","indigo"],o=t=>"default"===t?"Default palette":t[0].toUpperCase()+t.slice(1),s=a=>{"default"===a?n.removeAttribute("data-brand"):n.setAttribute("data-brand",a),e.setAttribute("title",o(a)),e.innerHTML='<i class="bi bi-palette2"></i>',localStorage.setItem(t,a)};let i=localStorage.getItem(t)||"default";s(i),e.addEventListener("click",()=>{const t=a.indexOf(i);i=a[(t+1)%a.length],s(i),window.bootstrap?.Tooltip&&(window.bootstrap.Tooltip.getInstance(e)||new window.bootstrap.Tooltip(e)).setContent({".tooltip-inner":o(i)})})}(),function(){const t="msaas-density",e=document.getElementById("btnDensity"),n=document.body,a=a=>{n.classList.toggle("density-compact","compact"===a),e.innerHTML=`<i class="bi ${"compact"===a?"bi-arrows-collapse":"bi-arrows-expand"}"></i>`,e.setAttribute("title","compact"===a?"Compact density":"Comfy density"),localStorage.setItem(t,a)},o=localStorage.getItem(t)||"comfy";a(o),e.addEventListener("click",()=>a(n.classList.contains("density-compact")?"comfy":"compact"))}(),function(){const t="msaas-tab";document.getElementById("hubTabs").addEventListener("shown.bs.tab",e=>localStorage.setItem(t,e.target.id));const e=localStorage.getItem(t);if(e){const t=document.getElementById(e);t&&new window.bootstrap.Tab(t).show()}}();const t=document.getElementById("all-tags");t&&(t.innerHTML=m.getAllTags().map(t=>`<option value="${t}"></option>`).join("")),e("docs:changed",()=>{t&&(t.innerHTML=m.getAllTags().map(t=>`<option value="${t}"></option>`).join(""))}),j(),R=document.getElementById("grid-bookmarks"),V(),e("docs:changed",V),P=document.getElementById("grid-starred"),_(),e("docs:changed",_),Z(),Q=document.getElementById("list-feed"),nt(),e("activity:added",nt),e("docs:changed",h),h(),pt(),sessionStorage.getItem("msaas-welcomed")||(y("Welcome to DocHub!","primary"),sessionStorage.setItem("msaas-welcomed","1")),document.addEventListener("hide.bs.modal",function(t){try{const e=t.target,n=document.activeElement;e.hasAttribute("inert")||e.setAttribute("inert",""),n&&e.contains(n)&&(n.blur(),document.body.hasAttribute("tabindex")||document.body.setAttribute("tabindex","-1"),document.body.focus({preventScroll:!0}))}catch(t){}}),document.addEventListener("show.bs.modal",function(t){try{const e=t.target;if(!e)return;e.removeAttribute("aria-hidden"),e.removeAttribute("inert"),e.setAttribute("aria-modal","true")}catch(t){}})}),function(){const t=document.getElementById("btnBackupExport"),e=document.getElementById("btnBackupImport"),n=document.getElementById("importBackupModal"),a=document.getElementById("importBackupFile"),o=document.getElementById("importBackupJson"),s=document.getElementById("importBackupOverwrite"),i=document.getElementById("importBackupForm");t&&t.addEventListener("click",()=>{const t=ft(),e=JSON.stringify(t,null,2);!function(t,e){const n=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(n),o=document.createElement("a");o.href=a,o.download=t,document.body.appendChild(o),o.click(),o.remove(),URL.revokeObjectURL(a)}("dochub-backup-"+function(){const t=new Date,e=t=>String(t).padStart(2,"0");return t.getFullYear()+""+e(t.getMonth()+1)+e(t.getDate())+"-"+e(t.getHours())+e(t.getMinutes())+e(t.getSeconds())}()+".json",e),y("Backup downloaded","primary")}),e&&e.addEventListener("click",()=>{if(!n)return;const t=window.bootstrap?.Modal?.getInstance(n)||new window.bootstrap.Modal(n);a&&(a.value=""),o&&(o.value=""),s&&(s.checked=!0),t.show()}),a&&a.addEventListener("change",async()=>{const t=a.files&&a.files[0];t&&await async function(t){if(!t||!o)return;const e=await t.text();try{const t=JSON.parse(e);o.value=JSON.stringify(t,null,2)}catch(t){o.value=e}}(t)}),i&&i.addEventListener("submit",t=>{t.preventDefault();try{const t=(o?.value||"").trim(),e=JSON.parse(t),n=function(t){const e=[],n=(t,n)=>{t||e.push(n)};return n(t&&"object"==typeof t&&!Array.isArray(t),"Root must be an object"),n(Array.isArray(t.docs),"`docs` must be an array"),n(t.comments&&"object"==typeof t.comments&&!Array.isArray(t.comments),"`comments` must be an object"),n(Array.isArray(t.activities),"`activities` must be an array"),n(Array.isArray(t.savedFilters),"`savedFilters` must be an array"),{valid:0===e.length,errors:e}}(e);if(!n.valid)return void y("Import failed: "+n.errors.join("; "),"danger");if(s?.checked)localStorage.setItem(vt,JSON.stringify(e));else{const t=ft(),n={docs:[...t.docs||[],...e.docs||[]],comments:{...t.comments||{},...e.comments||{}},activities:[...t.activities||[],...e.activities||[]],savedFilters:[...t.savedFilters||[],...e.savedFilters||[]]};localStorage.setItem(vt,JSON.stringify(n))}y("Import complete — reloading…","primary"),setTimeout(()=>window.location.reload(),400)}catch(t){y("Invalid JSON","danger")}})}(),yt=document.getElementById("btnManageTags"),ht=document.getElementById("manageTagsModal"),kt=document.getElementById("tags-list"),wt=document.getElementById("tags-search"),St=document.getElementById("tags-rename"),xt=document.getElementById("tags-merge"),Et=document.getElementById("tags-delete"),It=document.getElementById("tags-target"),yt&&ht&&(yt.addEventListener("click",()=>{Lt(),(window.bootstrap?.Modal?.getInstance(ht)||new window.bootstrap.Modal(ht)).show()}),Tt()),function(){document.addEventListener("click",t=>{const e=t.target.closest?.("[data-id],[data-doc-id],.doc-card");e&&Ct(e.closest?.("[data-id],[data-doc-id]")||e)}),document.addEventListener("keydown",qt);const t=document.querySelector("[data-id],[data-doc-id],.doc-card");t&&Ct(t.closest?.("[data-id],[data-doc-id]")||t)}(),jt=document.getElementById("bulkBar"),Rt=document.getElementById("bulkCount"),Pt=document.getElementById("btnBulkSelect"),Ut=document.getElementById("bulkClear"),Ht=document.getElementById("bulkStar"),Jt=document.getElementById("bulkUnstar"),Kt=document.getElementById("bulkBookmark"),zt=document.getElementById("bulkUnbookmark"),Wt=document.getElementById("bulkAddTag"),Qt=document.getElementById("bulkRemoveTag"),Pt?.addEventListener("click",()=>{Yt(!Ot)}),document.addEventListener("click",t=>{Ot&&(t.target.closest?.("#bulkBar")||function(t){const e=function(t){const e=t.closest?.("[data-id],[data-doc-id],.doc-card");return e&&(e.getAttribute("data-id")||e.getAttribute("data-doc-id"))||null}(t.target);e&&Ot&&(t.preventDefault(),t.stopPropagation(),Nt.has(e)?(Nt.delete(e),Vt(e,!1)):(Nt.add(e),Vt(e,!0)),_t())}(t))}),Ut?.addEventListener("click",()=>Yt(!1)),Ht?.addEventListener("click",()=>Xt(!0)),Jt?.addEventListener("click",()=>Xt(!1)),Kt?.addEventListener("click",()=>Zt(!0)),zt?.addEventListener("click",()=>Zt(!1)),Wt?.addEventListener("click",ee),Qt?.addEventListener("click",ne),_t(),function(){const t=document.getElementById("qaForm"),e=document.getElementById("qaTitle"),n=document.getElementById("qaTags"),a=document.getElementById("qaClear");t&&e&&n&&(t.addEventListener("submit",t=>{t.preventDefault();const a=e.value.trim(),o=function(t=""){return String(t).split(",").map(t=>t.trim()).filter(Boolean)}(n.value);if(!a)return y("Please enter a title","warning"),void e.focus();const s=function(t,e){const n=String(t||"").trim();if(!n)return null;let a=null;const o=[()=>m.addDoc?.({title:n,tags:e}),()=>m.addDoc?.(n,{tags:e}),()=>m.addDoc?.(n)];for(const t of o)try{const e=t();if(null!=e){a=e;break}}catch(t){}if(!a&&m.all){const t=m.all()||[];for(let e=t.length-1;e>=0;e--)if(t[e]?.title===n){a=t[e].id;break}}if(a&&e?.length&&m.updateTags)try{const t=m.byId?.(a),n=t?.tags||[],o=Array.from(new Set([...n,...e]));o.length!==n.length&&m.updateTags(a,o)}catch(t){}return a}(a,o);s?(y("Document added","primary"),e.value="",n.value="",e.focus()):y("Could not add the document (check Store.addDoc)","danger")}),a?.addEventListener("click",()=>{e.value="",n.value="",e.focus()}))}(),function(){const t=document.getElementById("btnSafeMode"),e=document.getElementById("safeBadge");document.documentElement.classList.toggle("safe-mode",oe()),se(t),e&&oe()&&e.classList.remove("d-none"),t?.addEventListener("click",()=>{const e=!oe();!function(t){t?localStorage.setItem(ae,"1"):localStorage.removeItem(ae),document.documentElement.classList.toggle("safe-mode",!!t);const e=new CustomEvent("safe:changed",{detail:{on:!!t}});window.dispatchEvent(e)}(e),se(t),y(e?"Safe mode ON — writes disabled":"Safe mode OFF — writes enabled",e?"secondary":"primary")})}(),function(){function t(){const t=document.getElementById("btnAdminPanel"),e=document.getElementById("adminPanel");if(!t||!e)return;document.querySelectorAll("#adminAccordion").forEach(t=>{e.contains(t)||t.remove()}),document.querySelectorAll(".accordion-item").forEach(t=>{["sec-create-wrap","sec-safe-wrap","sec-filters-wrap","sec-tags-wrap","sec-data-wrap","sec-utils-wrap"].some(e=>t.querySelector("#"+e))&&!e.contains(t)&&t.remove()});const n=window.bootstrap?.Offcanvas?window.bootstrap.Offcanvas.getOrCreateInstance(e):null;function a(){const t=(t,e)=>{const n=document.getElementById(t),a=document.getElementById(e);n&&a&&(n.classList.remove("btn-sm"),n.classList.add("btn","btn-outline-secondary","w-100"),o(n),a.appendChild(n))},e=(t,e)=>{const n=document.getElementById(t),a=document.getElementById(e);n&&a&&(o(n),a.appendChild(n))};e("safeBadge","sec-safe"),t("btnSafeMode","sec-safe"),e("qaForm","sec-create"),t("btnQuickImport","sec-filters"),t("btnImportFilters","sec-filters"),t("btnExportFilters","sec-filters"),t("btnManageFilters","sec-filters"),t("btnManageTags","sec-tags"),t("btnBulkSelect","sec-tags"),t("btnBackupExport","sec-data"),t("btnBackupImport","sec-data"),t("btnShortcuts","sec-utils")}t.addEventListener("click",()=>n&&n.toggle());const o=t=>{t?.classList?.add("admin-tool"),t.dataset.adminLabel||(t.dataset.adminLabel=(t.innerText||"").trim().toLowerCase())};a();const s=document.getElementById("adminSearch");function i(t){const n=(t||"").trim().toLowerCase();e.querySelectorAll(".accordion-item").forEach(t=>{const e=t.querySelector(".accordion-body"),a=e?e.querySelectorAll(".admin-tool, form.quick-add"):[];let o=0;a.forEach(t=>{const e=t.dataset.adminLabel||(t.innerText||"").toLowerCase(),a=!n||e.includes(n);t.classList.toggle("d-none",!a),a&&o++}),t.classList.toggle("d-none",0===o)})}s?.addEventListener("input",()=>i(s.value)),e.addEventListener("shown.bs.offcanvas",()=>{s&&(s.value="",i(""),s.focus()),a()})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t,{once:!0}):t()}(),window.Auth=ot;try{!function(){const t="msaas-theme";function e(t){const e=document.documentElement;e.classList.remove("theme-dark","theme-light"),"dark"===t&&e.classList.add("theme-dark"),"light"===t&&e.classList.add("theme-light")}function n(t){const e=getComputedStyle(document.documentElement),n={auto:(e.getPropertyValue("--indicator-auto")||"").trim()||"#16a34a",light:(e.getPropertyValue("--indicator-light")||"").trim()||"#f59e0b",dark:(e.getPropertyValue("--indicator-dark")||"").trim()||"#3b82f6"};["btnThemeQuick","btnPalette"].forEach(e=>{const a=document.getElementById(e);if(!a)return;a.title=`Theme: ${t} (click to cycle)`;let o=a.querySelector(".theme-indicator");o||(o=document.createElement("span"),o.className="theme-indicator",a.appendChild(o)),o.style.background=n[t]||n.auto})}window.Theme=window.Theme||{},window.Theme.get=()=>localStorage.getItem(t)||"auto",window.Theme.set=a=>{localStorage.setItem(t,a),e(a),n(a)},window.Theme.cycle=()=>{const t=["auto","light","dark"],e=window.Theme.get(),n=t[(t.indexOf(e)+1)%t.length];window.Theme.set(n);try{window.showToast&&y("Theme: "+n,"secondary")}catch(t){}};const a=window.Theme.get();e(a),n(a);const o=document.getElementById("btnThemeQuick");o&&o.addEventListener("click",()=>window.Theme.cycle());const s=document.getElementById("btnPalette");s&&s.addEventListener("click",()=>window.Theme.cycle());const i=document.getElementById("themeAuto"),l=document.getElementById("themeLight"),d=document.getElementById("themeDark");i&&l&&d&&(({auto:i,light:l,dark:d}[a]||i).checked=!0,[i,l,d].forEach(t=>t.addEventListener("change",t=>{t.target.checked&&window.Theme.set(t.target.value)})))}()}catch(t){console.warn("Admin extensions init failed",t)}document.getElementById("app").innerHTML='\n\n  \x3c!-- Navbar --\x3e\n  <nav class="navbar navbar-expand-lg bg-body border-bottom sticky-top">\n    <div class="container-fluid">\n      <a class="navbar-brand fw-semibold" href="#">\n        <i class="bi bi-journals me-2"></i>DocHub\n      </a>\n\n      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#topNav"\n        aria-controls="topNav" aria-expanded="false" aria-label="Toggle navigation">\n        <span class="navbar-toggler-icon"></span>\n      </button>\n\n      <div class="collapse navbar-collapse" id="topNav">\n        <form class="d-flex ms-auto me-3" role="search" onsubmit="return false;">\n          <div class="input-group">\n            <span class="input-group-text bg-transparent border-end-0"><i class="bi bi-search"></i></span>\n            <input id="searchInput" class="form-control border-start-0" type="search"\n              placeholder="Search documents, tags…" aria-label="Search" />\n          </div>\n        </form>\n\n        <div class="d-flex gap-2">\n          <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addDocModal" id="addDocButton">\n            <i class="bi bi-plus-lg me-1"></i>New Document\n          </button>\n          <button id="btnPalette" class="btn btn-outline-secondary" type="button" title="Cycle brand palette"\n            data-bs-toggle="tooltip">\n            <i class="bi bi-palette2"></i>\n          </button>\n          <button id="btnDensity" class="btn btn-outline-secondary" type="button" title="Toggle density"\n            data-bs-toggle="tooltip">\n            <i class="bi bi-arrows-expand"></i>\n          </button>\n          <button id="btnTheme" class="btn btn-outline-secondary" type="button" title="Toggle theme"\n            data-bs-toggle="tooltip">\n            <i class="bi bi-sun"></i>\n          </button>\n        </div>\n      </div>\n    </div>\n  </nav>\n\n  \x3c!-- Tabs --\x3e\n  <div class="container-xxl py-3">\n    <ul class="nav nav-tabs" id="hubTabs" role="tablist">\n      <li class="nav-item" role="presentation">\n        <button class="nav-link active" id="tab-all" data-bs-toggle="tab" data-bs-target="#view-all" type="button"\n          role="tab" aria-controls="view-all" aria-selected="true">\n          <i class="bi bi-collection me-1"></i>All\n          <span class="badge text-bg-secondary align-middle ms-1" id="count-all">0</span>\n        </button>\n      </li>\n      <li class="nav-item" role="presentation">\n        <button class="nav-link" id="tab-bookmarks" data-bs-toggle="tab" data-bs-target="#view-bookmarks" type="button"\n          role="tab" aria-controls="view-bookmarks" aria-selected="false">\n          <i class="bi bi-bookmark me-1"></i>Bookmarks\n          <span class="badge text-bg-secondary align-middle ms-1" id="count-bookmarks">0</span>\n        </button>\n      </li>\n      <li class="nav-item" role="presentation">\n        <button class="nav-link" id="tab-starred" data-bs-toggle="tab" data-bs-target="#view-starred" type="button"\n          role="tab" aria-controls="view-starred" aria-selected="false">\n          <i class="bi bi-star me-1"></i>Starred\n          <span class="badge text-bg-secondary align-middle ms-1" id="count-starred">0</span>\n        </button>\n      </li>\n      <li class="nav-item" role="presentation">\n        <button class="nav-link" id="tab-feed" data-bs-toggle="tab" data-bs-target="#view-feed" type="button" role="tab"\n          aria-controls="view-feed" aria-selected="false">\n          <i class="bi bi-activity me-1"></i>Community\n        </button>\n      </li>\n    </ul>\n\n    <div id="filtersBar" class="pt-2 d-none">\n      <div class="d-flex flex-wrap align-items-center gap-2" id="active-tags"></div>\n      <div class="d-flex align-items-center flex-wrap gap-2 mt-2">\n        <button id="btnSaveFilter" type="button" class="btn btn-sm btn-outline-primary">\n          <i class="bi bi-bookmark-plus"></i> Save as Smart Filter\n        </button>\n        <div class="ms-auto d-flex flex-wrap gap-2">\n          <button id="btnQuickImport" type="button" class="btn btn-sm btn-outline-secondary"\n            title="Import starter filters">\n            <i class="bi bi-lightning-charge"></i> Quick Import\n          </button>\n          \x3c!-- Safe Mode toggle --\x3e\n          <span id="safeBadge" class="badge rounded-pill text-bg-warning d-none align-self-center me-2">SAFE</span>\n          \x3c!-- Admin toggle button (stays on top bar) --\x3e\n          <button id="btnAdminPanel" type="button" class="btn btn-sm btn-outline-secondary"\n            title="Open Administrator panel">\n            <i class="bi bi-sliders"></i> Admin\n          </button>\n          <button id="btnSafeMode" type="button" class="btn btn-sm btn-outline-secondary"\n            title="Toggle Safe / Demo mode">\n            <i class="bi bi-shield-lock"></i> <span class="label">Safe OFF</span>\n          </button>\n          <button id="btnManageFilters" type="button" class="btn btn-sm btn-outline-secondary"\n            title="Manage saved filters">\n            <i class="bi bi-sliders"></i> Manage\n          </button>\n          \x3c!-- Backup/Restore buttons --\x3e\n          <button id="btnBackupExport" type="button" class="btn btn-sm btn-outline-secondary"\n            title="Download full backup">\n            <i class="bi bi-save"></i> Backup\n          </button>\n          <button id="btnBackupImport" type="button" class="btn btn-sm btn-outline-secondary"\n            title="Restore from backup">\n            <i class="bi bi-upload"></i> Restore\n          </button>\n          <button id="btnManageTags" type="button" class="btn btn-sm btn-outline-secondary" title="Manage tags">\n            <i class="bi bi-hash"></i> Tags\n          </button>\n\n          <button id="btnBulkSelect" type="button" class="btn btn-sm btn-outline-secondary" title="Select multiple">\n            <i class="bi bi-check2-square"></i> Select\n          </button>\n        </div>\n        <div id="saved-filters" class="d-flex flex-wrap gap-2 w-100"></div>\n      </div>\n      <div class="d-flex flex-wrap align-items-center gap-2" id="active-tags"></div>\n    </div>\n\n    <div class="tab-content pt-4">\n      <div class="tab-pane fade show active" id="view-all" role="tabpanel" aria-labelledby="tab-all">\n        <div id="grid-all" class="row g-3"></div>\n      </div>\n      <div class="tab-pane fade" id="view-bookmarks" role="tabpanel" aria-labelledby="tab-bookmarks">\n        <div id="grid-bookmarks" class="row g-3"></div>\n      </div>\n      <div class="tab-pane fade" id="view-starred" role="tabpanel" aria-labelledby="tab-starred">\n        <div id="grid-starred" class="row g-3"></div>\n      </div>\n      <div class="tab-pane fade" id="view-feed" role="tabpanel" aria-labelledby="tab-feed">\n        <div id="list-feed" class="vstack gap-3"></div>\n      </div>\n    </div>\n  </div>\n\n  \x3c!-- Comments Offcanvas --\x3e\n  <div class="offcanvas offcanvas-end" tabindex="-1" id="commentsPanel" aria-labelledby="commentsPanelLabel">\n    <div class="offcanvas-header">\n      <h5 class="offcanvas-title" id="commentsPanelLabel"><i class="bi bi-chat-dots me-2"></i>Comments</h5>\n      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>\n    </div>\n    <div class="offcanvas-body d-flex flex-column">\n      <div id="thread-meta" class="small text-body-secondary mb-2"></div>\n      <div id="thread" class="flex-grow-1 overflow-auto pe-1"></div>\n      <form id="commentForm" class="mt-3" autocomplete="off">\n        <div class="input-group">\n          <input id="commentInput" type="text" class="form-control" placeholder="Write a comment…" />\n          <button class="btn btn-primary" type="submit"><i class="bi bi-send"></i></button>\n        </div>\n      </form>\n    </div>\n  </div>\n\n  \x3c!-- Add Document Modal --\x3e\n  <div class="modal fade" id="addDocModal" tabindex="-1" aria-hidden="true">\n    <div class="modal-dialog modal-dialog-centered">\n      <div class="modal-content">\n        <div class="modal-header">\n          <h5 class="modal-title"><i class="bi bi-file-earmark-plus me-2"></i>Add Document</h5>\n          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <form id="addDocForm" autocomplete="off">\n          <div class="modal-body">\n            <div class="mb-3">\n              <label class="form-label">Title</label>\n              <input name="title" class="form-control" required />\n            </div>\n            <div class="mb-3">\n              <label class="form-label">Description</label>\n              <textarea name="description" class="form-control" rows="3" placeholder="What is this document about?"\n                required></textarea>\n            </div>\n            <div class="mb-3">\n              <label class="form-label">Tags (comma separated)</label>\n              <input name="tags" class="form-control" placeholder="e.g. product, roadmap" list="all-tags" />\n            </div>\n            <div class="mb-2">\n              <label class="form-label">Link (optional)</label>\n              <input name="url" type="url" class="form-control" placeholder="https://…" />\n            </div>\n\n            <div class="row g-2 align-items-end mt-2">\n              <div class="col-sm-4">\n                <label class="form-label form-label-sm mb-1">Owner</label>\n                <input type="text" class="form-control form-control-sm" name="owner" placeholder="Owner name">\n              </div>\n              <div class="col-sm-4">\n                <label class="form-label form-label-sm mb-1">Status</label>\n                <select class="form-select form-select-sm" name="status">\n                  <option value="">—</option>\n                  <option>Draft</option>\n                  <option>In Review</option>\n                  <option>Published</option>\n                  <option>Archived</option>\n                </select>\n              </div>\n              <div class="col-sm-2">\n                <label class="form-label form-label-sm mb-1">Icon</label>\n                <input type="text" class="form-control form-control-sm" name="icon" placeholder="😀">\n              </div>\n              <div class="col-sm-2">\n                <label class="form-label form-label-sm mb-1">Color</label>\n                <input type="color" class="form-control form-control-color form-control-sm" name="color" value="#2563eb"\n                  title="Pick a color">\n              </div>\n            </div>\n          </div>\n          <div class="modal-footer">\n            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>\n            <button type="submit" class="btn btn-primary">Add</button>\n          </div>\n        </form>\n      </div>\n    </div>\n  </div>\n\n  \x3c!-- Edit Document Modal --\x3e\n  <div class="modal fade" id="editDocModal" tabindex="-1" aria-hidden="true">\n    <div class="modal-dialog modal-dialog-centered">\n      <div class="modal-content">\n        <div class="modal-header">\n          <h5 class="modal-title"><i class="bi bi-file-earmark-plus me-2"></i>Edit Document</h5>\n          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <form id="editDocForm" autocomplete="off">\n          <div class="modal-body">\n            <div class="mb-3">\n              <label class="form-label">Title</label>\n              <input name="title" class="form-control" required />\n            </div>\n            <div class="mb-3">\n              <label class="form-label">Description</label>\n              <textarea name="description" class="form-control" rows="3" placeholder="What is this document about?"\n                required></textarea>\n            </div>\n            <div class="mb-3">\n              <label class="form-label">Tags (comma separated)</label>\n              <input name="tags" class="form-control" placeholder="e.g. product, roadmap" list="all-tags" />\n            </div>\n            <div class="mb-2">\n              <label class="form-label">Link (optional)</label>\n              <input name="url" type="url" class="form-control" placeholder="https://…" />\n            </div>\n\n            <div class="row g-2 align-items-end mt-2">\n              <div class="col-sm-4">\n                <label class="form-label form-label-sm mb-1">Owner</label>\n                <input type="text" class="form-control form-control-sm" name="owner" placeholder="Owner name">\n              </div>\n              <div class="col-sm-4">\n                <label class="form-label form-label-sm mb-1">Status</label>\n                <select class="form-select form-select-sm" name="status">\n                  <option value="">—</option>\n                  <option>Draft</option>\n                  <option>In Review</option>\n                  <option>Published</option>\n                  <option>Archived</option>\n                </select>\n              </div>\n              <div class="col-sm-2">\n                <label class="form-label form-label-sm mb-1">Icon</label>\n                <input type="text" class="form-control form-control-sm" name="icon" placeholder="😀">\n              </div>\n              <div class="col-sm-2">\n                <label class="form-label form-label-sm mb-1">Color</label>\n                <input type="color" class="form-control form-control-color form-control-sm" name="color" value="#2563eb"\n                  title="Pick a color">\n              </div>\n            </div>            \n          </div>\n          <div class="modal-footer">\n            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>\n            <button type="submit" class="btn btn-primary">Save</button>\n          </div>\n        </form>\n      </div>\n    </div>\n  </div>\n\n  \x3c!-- Save Smart Filter Modal --\x3e\n  <div class="modal fade" id="saveFilterModal" tabindex="-1" aria-hidden="true">\n    <div class="modal-dialog modal-dialog-centered modal-sm">\n      <div class="modal-content">\n        <div class="modal-header">\n          <h5 class="modal-title"><i class="bi bi-bookmark-plus me-2"></i>Save Smart Filter</h5>\n          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <form id="saveFilterForm" autocomplete="off">\n          <div class="modal-body">\n            <label class="form-label">Filter name</label>\n            <input id="saveFilterName" class="form-control" placeholder="e.g. Strategy docs" required />\n            <div class="form-text">Saves current text search and selected tags.</div>\n          </div>\n          <div class="modal-footer">\n            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>\n            <button type="submit" class="btn btn-primary">Save</button>\n          </div>\n        </form>\n      </div>\n    </div>\n  </div>\n\n  \x3c!-- Import Filters Modal --\x3e\n  <div class="modal fade" id="importFiltersModal" tabindex="-1" aria-hidden="true">\n    <div class="modal-dialog modal-dialog-centered">\n      <div class="modal-content">\n        <div class="modal-header">\n          <h5 class="modal-title"><i class="bi bi-upload me-2"></i>Import Filters JSON</h5>\n          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <form id="importFiltersForm" autocomplete="off">\n          <div class="modal-body">\n            <textarea id="importFiltersJson" class="form-control" rows="8"\n              placeholder=\'[{"name":"Onboarding","tags":["onboarding"]}]\' required></textarea>\n            <div class="form-text">Paste an array of filters with <code>name</code>, optional <code>query</code>, and\n              <code>tags</code>.</div>\n          </div>\n          <div class="modal-footer">\n            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>\n            <button type="submit" class="btn btn-primary">Import</button>\n          </div>\n        </form>\n      </div>\n    </div>\n  </div>\n\n  \x3c!-- Manage Filters Modal --\x3e\n  <div class="modal fade" id="manageFiltersModal" tabindex="-1" aria-hidden="true">\n    <div class="modal-dialog modal-dialog-centered modal-lg">\n      <div class="modal-content">\n        <div class="modal-header">\n          <h5 class="modal-title"><i class="bi bi-sliders me-2"></i>Manage Filters</h5>\n          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n\n        <div class="modal-body">\n          <div class="d-flex align-items-center justify-content-between mb-2">\n            <div class="form-check">\n              <input class="form-check-input" type="checkbox" id="mf-select-all">\n              <label class="form-check-label" for="mf-select-all">Select all</label>\n            </div>\n            <div class="small text-body-secondary">Drag rows by the handle to reorder</div>\n          </div>\n\n          <ul id="mf-list" class="list-group list-group-flush border rounded">\n            \x3c!-- rows injected by JS --\x3e\n          </ul>\n        </div>\n\n        <div class="modal-footer">\n          <button id="mf-delete" type="button" class="btn btn-outline-danger">\n            <i class="bi bi-trash"></i> Delete selected\n          </button>\n          <button id="mf-save" type="button" class="btn btn-primary">\n            <i class="bi bi-check2"></i> Save changes\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  \x3c!-- Shared datalist for tag autocomplete --\x3e\n  <datalist id="all-tags"></datalist>\n\n  \x3c!-- Toasts --\x3e\n  <div id="toast-holder" class="toast-container position-fixed top-0 end-0 p-3"></div>\n\n\n  \x3c!-- Restore Backup Modal --\x3e\n  <div class="modal fade" id="importBackupModal" tabindex="-1" aria-hidden="true">\n    <div class="modal-dialog modal-dialog-centered">\n      <div class="modal-content">\n        <div class="modal-header">\n          <h5 class="modal-title"><i class="bi bi-upload me-2"></i>Restore from Backup</h5>\n          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <form id="importBackupForm" autocomplete="off">\n          <div class="modal-body">\n            <div class="mb-2">\n              <label class="form-label">Upload backup .json (optional)</label>\n              <input id="importBackupFile" type="file" accept="application/json,application/*+json,.json"\n                class="form-control" />\n              <div class="form-text">Choose a file OR paste JSON below.</div>\n            </div>\n            <div class="mb-2">\n              <label class="form-label">Or paste JSON</label>\n              <textarea id="importBackupJson" class="form-control" rows="8"\n                placeholder=\'{"docs":[...],"comments":{},"activities":[],"savedFilters":[...]}\'></textarea>\n            </div>\n            <div class="form-check">\n              <input class="form-check-input" type="checkbox" id="importBackupOverwrite" checked>\n              <label class="form-check-label" for="importBackupOverwrite">Overwrite existing data (recommended)</label>\n            </div>\n            <div class="small text-body-secondary mt-2">Import will reload the page.</div>\n          </div>\n          <div class="modal-footer">\n            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>\n            <button type="submit" class="btn btn-primary">Import</button>\n          </div>\n        </form>\n      </div>\n    </div>\n  </div>\n\n  \x3c!-- Manage Tags Modal --\x3e\n  <div class="modal fade" id="manageTagsModal" tabindex="-1" aria-hidden="true">\n    <div class="modal-dialog modal-dialog-centered modal-lg">\n      <div class="modal-content">\n        <div class="modal-header">\n          <h5 class="modal-title"><i class="bi bi-hash me-2"></i>Manage Tags</h5>\n          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <div class="modal-body">\n          <div class="row g-2 mb-2">\n            <div class="col-md-6">\n              <input id="tags-search" class="form-control" placeholder="Search tags…" />\n            </div>\n            <div class="col-md-6 d-flex gap-2">\n              <input id="tags-target" class="form-control" placeholder="Target name (for Rename/Merge)" />\n              <button id="tags-rename" type="button" class="btn btn-outline-primary">Rename</button>\n              <button id="tags-merge" type="button" class="btn btn-outline-primary">Merge</button>\n              <button id="tags-delete" type="button" class="btn btn-outline-danger ms-auto">Delete</button>\n            </div>\n          </div>\n          <div class="table-responsive border rounded">\n            <table class="table align-middle mb-0">\n              <thead class="table-light">\n                <tr>\n                  <th class="text-center" style="width:36px"></th>\n                  <th>Tag</th>\n                  <th class="text-end">Docs</th>\n                  <th class="text-end">Filters</th>\n                  <th class="text-end" style="width:40px"></th>\n                </tr>\n              </thead>\n              <tbody id="tags-list">\n                <tr>\n                  <td colspan="5" class="py-4 text-center text-body-secondary">Loading…</td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class="modal fade" id="shortcutsModal" tabindex="-1" aria-hidden="true">\n    <div class="modal-dialog">\n      <div class="modal-content">\n        <div class="modal-header">\n          <h5 class="modal-title"><i class="bi bi-keyboard me-2"></i>Keyboard Shortcuts</h5>\n          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <div class="modal-body">\n          <ul class="list-unstyled small mb-0">\n            <li><kbd>/</kbd> or <kbd>Ctrl</kbd>+<kbd>K</kbd> – Focus search</li>\n            <li><kbd>?</kbd> or <kbd>Cmd</kbd>+<kbd>K</kbd> – Toggle this cheatsheet</li>\n            <li><kbd>S</kbd> – Star / unstar active card</li>\n            <li><kbd>B</kbd> – Bookmark / unbookmark active card</li>\n            <li><kbd>E</kbd> – Edit tags (inline if available, else quick prompt)</li>\n            <li class="text-body-secondary mt-2">Tip: click a card to make it active. The active card is outlined.</li>\n          </ul>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  \x3c!-- Bulk actions bar (appears in select mode) --\x3e\n  <div id="bulkBar" class="bulkbar d-none fixed-bottom">\n    <div class="container-lg">\n      <div class="d-flex gap-2 align-items-center bg-body border rounded shadow-sm p-2 my-2">\n        <span class="fw-medium">Selected: <span id="bulkCount">0</span></span>\n        <div class="vr mx-1"></div>\n        <button id="bulkStar" class="btn btn-sm btn-outline-primary" type="button" title="Star"><i\n            class="bi bi-star"></i></button>\n        <button id="bulkUnstar" class="btn btn-sm btn-outline-primary" type="button" title="Unstar"><i\n            class="bi bi-star-fill"></i></button>\n        <button id="bulkBookmark" class="btn btn-sm btn-outline-primary" type="button" title="Bookmark"><i\n            class="bi bi-bookmark"></i></button>\n        <button id="bulkUnbookmark" class="btn btn-sm btn-outline-primary" type="button" title="Unbookmark"><i\n            class="bi bi-bookmark-fill"></i></button>\n        <button id="bulkAddTag" class="btn btn-sm btn-outline-secondary" type="button" title="Add tag">+ Tag</button>\n        <button id="bulkRemoveTag" class="btn btn-sm btn-outline-secondary" type="button" title="Remove tag">−\n          Tag</button>\n        <div class="ms-auto"></div>\n        <button id="bulkClear" class="btn btn-sm btn-outline-danger" type="button"\n          title="Exit select mode">Done</button>\n      </div>\n    </div>\n  </div>\n\n  \x3c!-- Offcanvas Admin Panel (right side) --\x3e\n  <div class="offcanvas offcanvas-end admin-offcanvas" tabindex="-1" id="adminPanel" aria-labelledby="adminPanelLabel">\n    <div class="offcanvas-header border-bottom">\n      <h5 class="offcanvas-title" id="adminPanelLabel"><i class="bi bi-sliders me-2"></i>Administrator</h5>\n      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>\n    </div>\n    <div class="offcanvas-body">\n      <div class="input-group input-group-sm mb-3">\n        <span class="input-group-text"><i class="bi bi-search"></i></span>\n        <input id="adminSearch" class="form-control" placeholder="Search tools…" />\n      </div>\n\n      <div class="accordion" id="adminAccordion">\n        <div class="accordion-item">\n          <h2 class="accordion-header">\n            <button class="accordion-button collapsed small" data-bs-toggle="collapse" data-bs-target="#sec-safe-wrap">\n              <i class="bi bi-shield-lock me-2"></i> Safety\n            </button>\n          </h2>\n          <div id="sec-safe-wrap" class="accordion-collapse collapse" data-bs-parent="#adminAccordion">\n            <div id="sec-safe" class="accordion-body d-grid gap-2">\n              <div class="input-group input-group-sm">\n                <span class="input-group-text"><i class="bi bi-person-gear"></i></span>\n                <select id="roleSelect" class="form-select form-select-sm">\n                  <option value="admin">Admin</option>\n                  <option value="viewer">Viewer</option>\n                </select>\n              </div>\n            </div>\n          </div>\n        </div>\n\n\n        <div class="accordion-item">\n          <h2 class="accordion-header" id="headingTheme">\n            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"\n              data-bs-target="#collapseTheme" aria-expanded="false" aria-controls="collapseTheme">\n              <i class="bi bi-palette me-2"></i> Theme\n            </button>\n          </h2>\n          <div id="collapseTheme" class="accordion-collapse collapse" aria-labelledby="headingTheme"\n            data-bs-parent="#adminAccordion">\n            <div id="sec-theme" class="accordion-body">\n              <div class="btn-group" role="group" aria-label="Theme">\n                <input type="radio" class="btn-check" name="themeOptions" id="themeAuto" autocomplete="off"\n                  value="auto">\n                <label class="btn btn-outline-secondary btn-sm" for="themeAuto"><i class="bi bi-phone"></i> Auto</label>\n                <input type="radio" class="btn-check" name="themeOptions" id="themeLight" autocomplete="off"\n                  value="light">\n                <label class="btn btn-outline-secondary btn-sm" for="themeLight"><i class="bi bi-brightness-high"></i>\n                  Light</label>\n                <input type="radio" class="btn-check" name="themeOptions" id="themeDark" autocomplete="off"\n                  value="dark">\n                <label class="btn btn-outline-secondary btn-sm" for="themeDark"><i class="bi bi-moon"></i> Dark</label>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class="accordion-item">\n          <h2 class="accordion-header">\n            <button class="accordion-button collapsed small" data-bs-toggle="collapse"\n              data-bs-target="#sec-filters-wrap">\n              <i class="bi bi-funnel me-2"></i> Filters\n            </button>\n          </h2>\n          <div id="sec-filters-wrap" class="accordion-collapse collapse" data-bs-parent="#adminAccordion">\n            <div id="sec-filters" class="accordion-body d-grid gap-2"></div>\n            <div class="small text-body-secondary border-top pt-2 mt-2">\n              <div class="d-flex align-items-center gap-3 flex-wrap">\n                <span><i class="bi bi-circle-fill me-1" style="color:#6c757d;font-size:.6rem"></i> Draft</span>\n                <span><i class="bi bi-circle-fill me-1" style="color:#f59e0b;font-size:.6rem"></i> In Review</span>\n                <span><i class="bi bi-circle-fill me-1" style="color:#16a34a;font-size:.6rem"></i> Published</span>\n                <span><i class="bi bi-circle-fill me-1" style="color:#64748b;font-size:.6rem"></i> Archived</span>\n              </div>\n            </div>\n\n          </div>\n        </div>\n\n        <div class="accordion-item">\n          <h2 class="accordion-header">\n            <button class="accordion-button collapsed small" data-bs-toggle="collapse" data-bs-target="#sec-tags-wrap">\n              <i class="bi bi-hash me-2"></i> Tags &amp; Bulk\n            </button>\n          </h2>\n          <div id="sec-tags-wrap" class="accordion-collapse collapse" data-bs-parent="#adminAccordion">\n            <div id="sec-tags" class="accordion-body d-grid gap-2">\n            </div>\n          </div>\n        </div>\n\n        <div class="accordion-item">\n          <h2 class="accordion-header">\n            <button class="accordion-button collapsed small" data-bs-toggle="collapse" data-bs-target="#sec-data-wrap">\n              <i class="bi bi-hdd-network me-2"></i> Data\n            </button>\n          </h2>\n          <div id="sec-data-wrap" class="accordion-collapse collapse" data-bs-parent="#adminAccordion">\n            <div id="sec-data" class="accordion-body d-grid gap-2"></div>\n          </div>\n        </div>\n\n        <div class="accordion-item">\n          <h2 class="accordion-header">\n            <button class="accordion-button collapsed small" data-bs-toggle="collapse" data-bs-target="#sec-utils-wrap">\n              <i class="bi bi-tools me-2"></i> Utilities\n            </button>\n          </h2>\n          <div id="sec-utils-wrap" class="accordion-collapse collapse" data-bs-parent="#adminAccordion">\n            <div id="sec-utils" class="accordion-body d-grid gap-2"></div>\n          </div>\n        </div>\n\n      </div>\n    </div>\n  </div>\n\n'}},function(t){var e;e=114,t(t.s=e)}]);
//# sourceMappingURL=main.d52cde5398d01d5c47c3.js.map