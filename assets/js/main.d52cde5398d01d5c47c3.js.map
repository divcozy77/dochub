{"version":3,"file":"assets/js/main.d52cde5398d01d5c47c3.js","mappings":"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","sources":["webpack://vanilla-webpack-app/./src/js/core/eventBus.js","webpack://vanilla-webpack-app/./src/js/core/store.js","webpack://vanilla-webpack-app/./src/js/ui/components.js","webpack://vanilla-webpack-app/./src/js/modules/documents.js","webpack://vanilla-webpack-app/./src/js/modules/bookmarks.js","webpack://vanilla-webpack-app/./src/js/modules/starred.js","webpack://vanilla-webpack-app/./src/js/modules/comments.js","webpack://vanilla-webpack-app/./src/js/modules/community.js","webpack://vanilla-webpack-app/./src/js/core/auth.js","webpack://vanilla-webpack-app/./src/js/modules/filters-admin.js","webpack://vanilla-webpack-app/./src/js/modules/backup.js","webpack://vanilla-webpack-app/./src/js/modules/tags-admin.js","webpack://vanilla-webpack-app/./src/js/modules/shortcuts.js","webpack://vanilla-webpack-app/./src/js/modules/bulk-actions.js","webpack://vanilla-webpack-app/./src/js/modules/safe-mode.js","webpack://vanilla-webpack-app/./src/main.js","webpack://vanilla-webpack-app/./src/js/modules/quick-add.js","webpack://vanilla-webpack-app/./src/js/modules/admin-sidebar.js","webpack://vanilla-webpack-app/./src/js/modules/admin-extensions.js"],"sourcesContent":["// Simple pub/sub event bus (no deps)\nconst listeners = new Map();\n\nexport function on(event, handler) {\n  if (!listeners.has(event)) listeners.set(event, new Set());\n  listeners.get(event).add(handler);\n  return () => off(event, handler);\n}\n\nexport function off(event, handler) {\n  const set = listeners.get(event);\n  if (set) set.delete(handler);\n}\n\nexport function emit(event, payload) {\n  const set = listeners.get(event);\n  if (!set) return;\n  for (const fn of set) {\n    try { fn(payload); } catch (err) { console.error(`[bus:${event}]`, err); }\n  }\n}\n","import { emit } from './eventBus.js';\n\nconst KEY = 'msaas-docs-state-v1';\n\n\nconst SAFE_KEY = 'msaas-safe-mode';\nconst now = () => new Date().toISOString();\nconst uid = () => (crypto?.randomUUID ? crypto.randomUUID() : Math.random().toString(36).slice(2));\n\nconst initial = () => ({\n  docs: [\n    { id: uid(), title: 'Product Vision 2025', description: 'North-star doc covering strategy, themes, and bets.', tags: ['strategy','vision'], url: '', createdAt: now(), updatedAt: now(), bookmarked: true, starred: true },\n    { id: uid(), title: 'Onboarding Guide', description: 'How we ship fast, safely: workflows, rituals, tools.', tags: ['onboarding','playbook'], url: '', createdAt: now(), updatedAt: now(), bookmarked: false, starred: false },\n    { id: uid(), title: 'API Reference', description: 'Public endpoints, quotas, examples and gotchas.', tags: ['api','docs'], url: '', createdAt: now(), updatedAt: now(), bookmarked: true, starred: false },\n    { id: uid(), title: 'Security Review Template', description: 'Checklist for new features before launch.', tags: ['security','template'], url: '', createdAt: now(), updatedAt: now(), bookmarked: false, starred: false }\n  ],\n  comments: {},\n  activities: [],\n  savedFilters: []\n});\n\nfunction load() {\n  try {\n    const raw = localStorage.getItem(KEY);\n    if (!raw) return initial();\n    const parsed = JSON.parse(raw);\n    if (!parsed.savedFilters) parsed.savedFilters = [];\n    if (!parsed.activities) parsed.activities = [];\n    if (!parsed.comments) parsed.comments = {};\n    if (!parsed.docs) parsed.docs = [];\n    return parsed;\n  } catch {\n    return initial();\n  }\n}\n\nlet state = load();\n\nfunction save() {\n  if (localStorage.getItem(SAFE_KEY) === '1') { return; }\n  localStorage.setItem(KEY, JSON.stringify(state));\n}\n\nfunction activity(type, meta) {\n  const entry = { id: uid(), type, ts: now(), meta };\n  state.activities.unshift(entry);\n  emit('activity:added', entry);\n}\n\nexport const Store = {\n  all() { return [...state.docs].sort((a,b) => new Date(b.updatedAt) - new Date(a.updatedAt)); },\n  byId(id) { return state.docs.find(d => d.id === id); },\n\n  search(query) {\n    const q = query.trim().toLowerCase();\n    if (!q) return this.all();\n    return this.all().filter(d =>\n      d.title.toLowerCase().includes(q) ||\n      d.description.toLowerCase().includes(q) ||\n      (d.tags||[]).some(t => t.toLowerCase().includes(q))\n    );\n  },\n\n  getAllTags() {\n    const s = new Set();\n    for (const d of state.docs) for (const t of (d.tags||[])) s.add(t);\n    return Array.from(s).sort((a,b)=>a.localeCompare(b));\n  },\n\n  addDoc({ title, description, tags = [], url = '' }) {\n    const doc = { id: uid(), title, description, tags, url, createdAt: now(), updatedAt: now(), bookmarked: false, starred: false };\n    state.docs.unshift(doc);\n    save();\n    emit('docs:changed');\n    activity('doc:new', { id: doc.id, title: doc.title });\n    return doc;\n  },\n\n  toggleBookmark(id) {\n    const d = this.byId(id); if (!d) return;\n    d.bookmarked = !d.bookmarked; d.updatedAt = now();\n    save();\n    emit('docs:changed');\n    activity(d.bookmarked ? 'doc:bookmarked' : 'doc:unbookmarked', { id, title: d.title });\n  },\n\n  toggleStar(id) {\n    const d = this.byId(id); if (!d) return;\n    d.starred = !d.starred; d.updatedAt = now();\n    save();\n    emit('docs:changed');\n    activity(d.starred ? 'doc:starred' : 'doc:unstarred', { id, title: d.title });\n  },\n\n  updateTags(id, tags = []) {\n    const d = this.byId(id); if (!d) return;\n    d.tags = tags; d.updatedAt = now();\n    save();\n    emit('docs:changed');\n    activity('doc:tags', { id, title: d.title, tags });\n  },\n\n  \n  updateTitle(id, title = '') {\n    const d = this.byId(id); if (!d) return;\n    const t = String(title || '').trim(); if (!t) return;\n    d.title = t; d.updatedAt = now();\n    save(); emit('docs:changed'); activity('doc:title', { id, title: d.title });\n  },\n\n  updateDoc(id, patch = {}) {\n    const d = this.byId(id); if (!d) return;\n    if (patch.title       !== undefined) d.title       = String(patch.title || '').trim();\n    if (patch.description !== undefined) d.description = String(patch.description || '').trim();\n    if (patch.tags        !== undefined) d.tags        = Array.isArray(patch.tags) ? patch.tags : [];\n    if (patch.url         !== undefined) d.url         = String(patch.url || '').trim();\n    if (patch.owner       !== undefined) d.owner       = String(patch.owner || '').trim();\n    if (patch.status      !== undefined) d.status      = String(patch.status || '').trim();\n    if (patch.icon        !== undefined) d.icon        = String(patch.icon || '').trim();\n    if (patch.color       !== undefined) d.color       = String(patch.color || '').trim();\n    d.updatedAt = now();\n    save(); emit('docs:changed'); activity('doc:update', { id, title: d.title, tags: d.tags });\n  },\nremove(id) {\n    const d = this.byId(id); if (!d) return;\n    state.docs = state.docs.filter(x => x.id !== id);\n    delete state.comments[id];\n    save();\n    emit('docs:changed');\n    activity('doc:deleted', { id, title: d.title });\n  },\n\n  commentsFor(id) {\n    return state.comments[id] ? [...state.comments[id]] : [];\n  },\n\n  addComment(id, text, author = 'You') {\n    if (!state.comments[id]) state.comments[id] = [];\n    const msg = { id: uid(), text, author, ts: now() };\n    state.comments[id].push(msg);\n    save();\n    emit('comments:changed', { docId: id, msg });\n    const d = this.byId(id);\n    activity('comment:new', { docId: id, title: d?.title || 'Unknown', author });\n    return msg;\n  },\n\n  activities() { return [...state.activities]; },\n\n  counts() {\n    const all = state.docs.length;\n    const bookmarks = state.docs.filter(d => d.bookmarked).length;\n    const starred = state.docs.filter(d => d.starred).length;\n    return { all, bookmarks, starred };\n  },\n\n  // Smart filters\n  savedFilters() { return [...state.savedFilters]; },\n  addFilter({ name, query = '', tags = [] }) {\n    const f = { id: uid(), name, query, tags };\n    state.savedFilters.push(f);\n    save();\n    emit('filters:changed');\n    return f;\n  },\n  removeFilter(id) {\n    state.savedFilters = state.savedFilters.filter(f => f.id !== id);\n    save();\n    emit('filters:changed');\n  },\n  exportFilters() {\n    return state.savedFilters.map(({ name, query = '', tags = [] }) => ({ name, query, tags }));\n  },\n  importFilters(filters = [], { overwriteByName = false } = {}) {\n    const arr = Array.isArray(filters) ? filters : JSON.parse(filters);\n    let added = 0;\n    for (const f of arr) {\n      const name = String(f.name||'').trim();\n      if (!name) continue;\n      const query = String(f.query||'');\n      const tags = Array.isArray(f.tags) ? f.tags.map(t=>String(t).trim()).filter(Boolean) : [];\n      if (overwriteByName) {\n        state.savedFilters = state.savedFilters.filter(x => x.name != name);\n      } else if (state.savedFilters.some(x => x.name === name)) {\n        continue;\n      }\n      state.savedFilters.push({ id: uid(), name, query, tags });\n      added++;\n    }\n    save();\n    emit('filters:changed');\n    return added;\n  },\n  quickImportStarters() {\n    const starters = [\n      { name: 'Onboarding', tags: ['onboarding'] },\n      { name: 'API', tags: ['api'] },\n      { name: 'Security', tags: ['security'] },\n      { name: 'Vision & Strategy', tags: ['vision','strategy'] }\n    ];\n    return this.importFilters(starters);\n  },\n\n  // Add inside export const Store = { ... }\n  renameFilter(id, newName) {\n    const f = state.savedFilters.find(x => x.id === id);\n    if (!f) return false;\n    const name = String(newName || '').trim();\n    if (!name) return false;\n    // prevent duplicate names\n    if (state.savedFilters.some(x => x.id !== id && x.name === name)) return false;\n    f.name = name;\n    save();\n    emit('filters:changed');\n    return true;\n  },\n\n  reorderFilters(orderIds = []) {\n    const map = new Map(state.savedFilters.map(f => [f.id, f]));\n    const next = [];\n    for (const id of orderIds) if (map.has(id)) next.push(map.get(id));\n    // append any missing (safety)\n    for (const f of state.savedFilters) if (!orderIds.includes(f.id)) next.push(f);\n    state.savedFilters = next;\n    save();\n    emit('filters:changed');\n  },\n\n  removeFilters(ids = []) {\n    const set = new Set(ids);\n    state.savedFilters = state.savedFilters.filter(f => !set.has(f.id));\n    save();\n    emit('filters:changed');\n  },\n  // --- Tag admin APIs (added) ---\n  renameTag(oldName, newName) {\n    const from = String(oldName || '').trim();\n    const to   = String(newName || '').trim();\n    if (!from || !to || from === to) return false;\n    let changed = 0;\n    state.docs.forEach(d => {\n      const before = d.tags || [];\n      const next = [];\n      let touched = false;\n      const seen = new Set();\n      for (const t of before) {\n        const repl = (t === from) ? to : t;\n        if (!seen.has(repl)) next.push(repl);\n        seen.add(repl);\n        if (repl !== t) touched = true;\n      }\n      if (touched) { d.tags = next; changed++; }\n    });\n    state.savedFilters.forEach(f => {\n      const before = f.tags || [];\n      const next = [];\n      let touched = false;\n      const seen = new Set();\n      for (const t of before) {\n        const repl = (t === from) ? to : t;\n        if (!seen.has(repl)) next.push(repl);\n        seen.add(repl);\n        if (repl !== t) touched = true;\n      }\n      if (touched) { f.tags = next; changed++; }\n    });\n    save();\n    emit('docs:changed'); emit('filters:changed');\n    return changed;\n  },\n\n  deleteTag(tagName) {\n    const name = String(tagName || '').trim();\n    if (!name) return false;\n    let changed = 0;\n    state.docs.forEach(d => {\n      const before = d.tags || [];\n      const next = before.filter(t => t !== name);\n      if (next.length !== before.length) { d.tags = next; changed++; }\n    });\n    state.savedFilters.forEach(f => {\n      const before = f.tags || [];\n      const next = before.filter(t => t !== name);\n      if (next.length !== before.length) { f.tags = next; changed++; }\n    });\n    save();\n    emit('docs:changed'); emit('filters:changed');\n    return changed;\n  },\n\n  mergeTags(sourceNames = [], targetName) {\n    const target = String(targetName || '').trim();\n    if (!target || !Array.isArray(sourceNames) || sourceNames.length === 0) return false;\n    const set = new Set(sourceNames.map(s => String(s || '').trim()).filter(Boolean));\n    set.delete(target);\n    let total = 0;\n    for (const s of set) total += this.renameTag(s, target) || 0;\n    return total;\n  },\n  // --- Safe Mode helpers ---\n  isSafeMode() { return localStorage.getItem(SAFE_KEY) === '1'; },\n  setSafeMode(on) { if (on) localStorage.setItem(SAFE_KEY, '1'); else localStorage.removeItem(SAFE_KEY); },\n\n};\n","import { Store } from '../core/store.js';\n\nexport function escapeHtml(s='') { \n  return s.replace(/[&<>\"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;'}[c]));\n}\n\nexport function tagBadges(tags=[]) {\n  return (tags||[]).map(t => `\n    <button type=\"button\" class=\"badge badge-elevated me-1 tag-badge tag-badge-link\" \n            data-action=\"filter-tag\" data-tag=\"${escapeHtml(t)}\" title=\"Filter by #${escapeHtml(t)}\">#${escapeHtml(t)}</button>`\n  ).join('');\n}\n\nfunction statusCls(s='') { s=(s||'').toLowerCase();\n  if(s.includes('publish')) return 'text-success-emphasis bg-success-subtle';\n  if(s.includes('review'))  return 'text-warning-emphasis bg-warning-subtle';\n  if(s.includes('draft'))   return 'text-secondary-emphasis bg-secondary-subtle';\n  if(s.includes('archive')) return 'text-body-secondary bg-body-secondary-subtle';\n  return 'text-secondary-emphasis bg-secondary-subtle';\n}\n\nexport function timeAgo(iso) {\n  const d = new Date(iso); \n  const s = Math.floor((Date.now()-d)/1000);\n  const r = (n,u) => `${n} ${u}${n>1?'s':''} ago`;\n  if (s<60) return r(s,'sec');\n  const m=Math.floor(s/60); if(m<60) return r(m,'min');\n  const h=Math.floor(m/60); if(h<24) return r(h,'hr');\n  const dd=Math.floor(h/24); if(dd<30) return r(dd,'day');\n  const mo=Math.floor(dd/30); if(mo<12) return r(mo,'mo');\n  const y=Math.floor(mo/12); return r(y,'yr');\n}\n\nexport function docCard(doc) {\n  const urlBtn = doc.url ? `<a href=\"${doc.url}\" target=\"_blank\" rel=\"noopener\" class=\"btn btn-outline-secondary\"><i class=\"bi bi-box-arrow-up-right\"></i></a>` : '';\n  return `\n  <div class=\"col-12 col-sm-6 col-xl-4\" data-id=\"${doc.id}\">\n    <div class=\"card doc h-100\" ${doc.color?`style=\"border-left:4px solid ${escapeHtml(doc.color)}\"`:\"\"}>\n      <div class=\"card-body d-flex flex-column\">\n        <div class=\"d-flex justify-content-between align-items-start mb-2\">\n          <h5 class=\"card-title me-2\">${escapeHtml(doc.title)}</h5>\n          <div class=\"btn-group doc-actions\" role=\"group\">\n            ${urlBtn}\n            <button class=\"btn btn-outline-secondary\" data-action=\"comment\" title=\"Comments\"><i class=\"bi bi-chat\"></i></button>\n            <button class=\"btn ${doc.bookmarked?'btn-secondary':'btn-outline-secondary'}\" data-action=\"bookmark\" title=\"Bookmark\"><i class=\"bi bi-bookmark${doc.bookmarked?'-fill':''}\"></i></button>\n            <button class=\"btn ${doc.starred?'btn-warning':'btn-outline-warning'}\" data-action=\"star\" title=\"Star\"><i class=\"bi bi-star${doc.starred?'-fill':''}\"></i></button>\n            ${(window.Auth?.canEdit?.() ? `<button class=\"btn btn-outline-secondary\" data-action=\"edit-doc\" title=\"Edit\"><i class=\"bi bi-pencil-square\"></i></button>` : ``)}\n            <button class=\"btn btn-outline-secondary\" data-action=\"edit-tags\" title=\"Edit tags\"><i class=\"bi bi-tags\"></i></button>\n            <button class=\"btn btn-outline-danger\" data-action=\"delete\" title=\"Delete\"><i class=\"bi bi-trash\"></i></button>\n          </div>\n        </div>\n        ${(doc.owner||doc.status||doc.icon||doc.color)?`\n        <div class=\"doc-meta d-flex align-items-center gap-2 mb-2 text-body-secondary\">\n          ${doc.icon?`<span class=\"doc-icon\">${escapeHtml(doc.icon)}</span>`:\"\"}\n          ${doc.color?`<span class=\"doc-color-dot\" style=\"background:${escapeHtml(doc.color)}\"></span>`:\"\"}\n          ${doc.owner?`<span class=\"doc-owner\">By ${escapeHtml(doc.owner)}</span>`:\"\"}\n          ${doc.status?`<button type=\"button\" class=\"badge rounded-pill ms-auto ${statusCls(doc.status)}\" data-action=\"filter-status\" data-status=\"${escapeHtml(doc.status)}\" title=\"Filter by status\">${escapeHtml(doc.status)}</button>`:\"\"}\n        </div>`:``}\n        <p class=\"card-text flex-grow-1\">${escapeHtml(doc.description)}</p>\n\n        <div class=\"d-flex justify-content-between align-items-center\">\n          <div class=\"d-flex flex-wrap gap-1\" style=\"max-width:60%\">${tagBadges(doc.tags)}</div>\n          <small class=\"text-body-secondary\">Updated ${timeAgo(doc.updatedAt)}</small>\n        </div>\n\n        <div class=\"tag-editor d-none mt-2\">\n          <div class=\"input-group input-group-sm\">\n            <input type=\"text\" class=\"form-control\" placeholder=\"tag1, tag2\" value=\"${escapeHtml((doc.tags||[]).join(', '))}\" list=\"all-tags\">\n            <button class=\"btn btn-primary\" data-action=\"save-tags\">Save</button>\n            <button class=\"btn btn-outline-secondary\" data-action=\"cancel-tags\">Cancel</button>\n          </div>\n          <div class=\"form-text\">Separate tags with commas.</div>\n        </div>\n\n      </div>\n    </div>\n  </div>`;\n}\n\nexport function docCard2(doc) {\n  const urlBtn = doc.url ? `<a href=\"${doc.url}\" target=\"_blank\" rel=\"noopener\" class=\"btn btn-outline-secondary\"><i class=\"bi bi-box-arrow-up-right\"></i></a>` : '';\n  return `\n  <div class=\"col-12 col-sm-6 col-xl-4\" data-id=\"${doc.id}\">\n    <div class=\"card doc h-100\" ${doc.color?`style=\"border-left:4px solid ${escapeHtml(doc.color)}\"`:\"\"}>\n      <div class=\"card-body d-flex flex-column\">\n        <div class=\"d-flex justify-content-between align-items-start mb-2\">\n          <h5 class=\"card-title me-2\">${escapeHtml(doc.title)}</h5>\n          <div class=\"btn-group doc-actions\" role=\"group\">\n            ${urlBtn}\n            <button class=\"btn btn-outline-secondary\" data-action=\"comment\" title=\"Comments\"><i class=\"bi bi-chat\"></i></button>\n          </div>\n        </div>\n        ${(doc.owner||doc.status||doc.icon||doc.color)?`\n        <div class=\"doc-meta d-flex align-items-center gap-2 mb-2 text-body-secondary\">\n          ${doc.icon?`<span class=\"doc-icon\">${escapeHtml(doc.icon)}</span>`:\"\"}\n          ${doc.color?`<span class=\"doc-color-dot\" style=\"background:${escapeHtml(doc.color)}\"></span>`:\"\"}\n          ${doc.owner?`<span class=\"doc-owner\">By ${escapeHtml(doc.owner)}</span>`:\"\"}\n          ${doc.status?`<button type=\"button\" class=\"badge rounded-pill ms-auto ${statusCls(doc.status)}\" data-action=\"filter-status\" data-status=\"${escapeHtml(doc.status)}\" title=\"Filter by status\">${escapeHtml(doc.status)}</button>`:\"\"}\n        </div>`:``}\n        <p class=\"card-text flex-grow-1\">${escapeHtml(doc.description)}</p>\n\n        <div class=\"d-flex justify-content-between align-items-center\">\n          <div class=\"d-flex flex-wrap gap-1\" style=\"max-width:60%\">${tagBadges(doc.tags)}</div>\n          <small class=\"text-body-secondary\">Updated ${timeAgo(doc.updatedAt)}</small>\n        </div>\n\n        <div class=\"tag-editor d-none mt-2\">\n          <div class=\"input-group input-group-sm\">\n            <input type=\"text\" class=\"form-control\" placeholder=\"tag1, tag2\" value=\"${escapeHtml((doc.tags||[]).join(', '))}\" list=\"all-tags\">\n            <button class=\"btn btn-primary\" data-action=\"save-tags\">Save</button>\n            <button class=\"btn btn-outline-secondary\" data-action=\"cancel-tags\">Cancel</button>\n          </div>\n          <div class=\"form-text\">Separate tags with commas.</div>\n        </div>\n\n      </div>\n    </div>\n  </div>`;\n}\n\nexport function showToast(message, variant='primary') {\n  const holder = document.getElementById('toast-holder');\n  const el = document.createElement('div');\n  el.className = `toast align-items-center text-bg-${variant} border-0`;\n  el.role = 'status'; el.ariaLive = 'polite'; el.ariaAtomic = 'true';\n  el.innerHTML = `\n    <div class=\"d-flex\">\n      <div class=\"toast-body\">${message}</div>\n      <button type=\"button\" class=\"btn-close btn-close-white me-2 m-auto\" data-bs-dismiss=\"toast\" aria-label=\"Close\"></button>\n    </div>`;\n  holder.appendChild(el);\n  const t = new window.bootstrap.Toast(el, { delay: 2200 });\n  t.show();\n  el.addEventListener('hidden.bs.toast', () => el.remove());\n}\n\nexport function updateCounts() {\n  const c = Store.counts();\n  document.getElementById('count-all').textContent = c.all;\n  document.getElementById('count-bookmarks').textContent = c.bookmarks;\n  document.getElementById('count-starred').textContent = c.starred;\n}\n","import { Store } from '../core/store.js';\nimport { on, emit } from '../core/eventBus.js';\nimport { docCard, showToast, updateCounts } from '../ui/components.js';\n\nlet gridAll, searchInput, activeTagsEl, filtersBarEl, savedFiltersEl, btnSaveFilter, addDocButton;\nlet btnQuickImport;\nconst selectedTags = new Set();\n\nfunction emptyState(text) {\n  return `\n  <div class=\"col-12\">\n    <div class=\"text-center text-body-secondary py-5\">\n      <i class=\"bi bi-folder2-open\" style=\"font-size:3rem\"></i>\n      <div class=\"mt-2\">${text}</div>\n    </div>\n  </div>`;\n}\n\nfunction applyFilters(list) {\n  const textFiltered = list;\n  if (selectedTags.size === 0) return textFiltered;\n  return textFiltered.filter(d => {\n    const statusTokens = Array.from(selectedTags).filter(x => String(x).toLowerCase().startsWith('status:')).map(x => String(x).toLowerCase().slice(7));\n    const tags = new Set((d.tags||[]).map(t => t.toLowerCase()));\n    for (const t of selectedTags) {\n      const tl = String(t).toLowerCase();\n      if (tl.startsWith('status:')) continue; // handled below\n      if (!tags.has(tl)) return false;\n    }\n    if (statusTokens.length) {\n      const ds = String(d.status||'').toLowerCase();\n      if (!statusTokens.includes(ds)) return false;\n    }\n    return true;\n  });\n}\n\nfunction render(list) {\n  const base = searchInput.value ? Store.search(searchInput.value) : Store.all();\n  const final = applyFilters(base);\n  gridAll.innerHTML = final.length ? final.map(docCard).join('') : emptyState('No documents match your filters.');\n  updateCounts();\n  renderActiveFilters();\n}\n\n\n// local HTML escape for chip labels\nfunction escapeHtml(s=''){\n  return String(s)\n    .replaceAll('&','&amp;')\n    .replaceAll('<','&lt;')\n    .replaceAll('>','&gt;')\n    .replaceAll('\"','&quot;')\n    .replaceAll(\"'\",'&#39;');\n}\n\nfunction prettyChipLabel(token=''){\n\n  const s = String(token);\n  if (s.toLowerCase().startsWith('status:')) {\n    const v = s.slice(7);\n    // Capitalize first letter only, keep rest as is if user typed\n    const label = v ? (v.charAt(0).toUpperCase() + v.slice(1)) : '';\n    return `Status: ${escapeHtml(label)}`;\n  }\n  return `#${escapeHtml(s)}`;\n}\n\nfunction statusIcon(status=''){\n  const s = String(status || '').toLowerCase();\n  // Simple dot using Bootstrap Icons (falls back to emoji circle if BI not present)\n  const dot = (hex) => `<i class=\"bi bi-circle-fill me-1\" style=\"font-size:.6rem;color:${hex}\"></i>`;\n  if (s.includes('publish')) return dot('#16a34a'); // green\n  if (s.includes('review'))  return dot('#f59e0b'); // amber\n  if (s.includes('draft'))   return dot('#6c757d'); // gray\n  if (s.includes('archive')) return dot('#64748b'); // slate\n  return dot('#6c757d');\n}\n\nfunction renderActiveFilters() {\n  if (selectedTags.size === 0) {\n    filtersBarEl.classList.add('d-none');\n    activeTagsEl.innerHTML = '';\n  } else {\n    filtersBarEl.classList.remove('d-none');\n    const chips = Array.from(selectedTags).map(t => `\n      <span class=\"filter-chip\" data-chip=\"${t}\">${(String(t).toLowerCase().startsWith(\"status:\")? statusIcon(String(t).slice(7)) : \"\")}${prettyChipLabel(t)}\n        <button class=\"remove\" type=\"button\" data-action=\"remove-chip\" aria-label=\"Remove tag ${t}\"><i class=\"bi bi-x-lg\"></i></button>\n      </span>`).join('');\n    const clear = `<button type=\"button\" class=\"btn btn-sm btn-outline-secondary filter-clear\" data-action=\"clear-chips\"><i class=\"bi bi-x-circle\"></i> Clear</button>`;\n    activeTagsEl.innerHTML = chips + clear;\n  }\n  renderSavedFilters();\n}\n\n\nfunction renderSavedFilters() {\n  const items = Store.savedFilters();\n  savedFiltersEl.innerHTML = items.length ? items.map(f => `\n    <span class=\"smart-chip d-inline-flex flex-column align-items-start\" data-id=\"${f.id}\">\n      <div class=\"w-100 d-flex align-items-center gap-1\">\n        <button class=\"apply\" type=\"button\" data-action=\"apply-saved\" title=\"Apply filter\">${f.name}</button>\n        <button class=\"remove\" type=\"button\" data-action=\"remove-saved\" title=\"Remove saved filter ${f.name}\"><i class=\"bi bi-x-circle\"></i></button>\n      </div>\n      ${Array.isArray(f.tags) && f.tags.length ? `\n        <div class=\"saved-preview small mt-1\">\n          ${f.tags.map(t => `<span class=\"badge bg-body-tertiary border me-1\">${(String(t).toLowerCase().startsWith('status:')? statusIcon(String(t).slice(7)) : '')}${prettyChipLabel(t)}</span>`).join('')}\n        </div>` : ``}\n    </span>`).join('') : '<span class=\"text-body-secondary small\">No saved filters yet.</span>';\n}\n\nfunction toggleEditor(card, show=true) {\n  const ed = card.querySelector('.tag-editor');\n  if (!ed) return;\n  ed.classList.toggle('d-none', !show);\n  if (show) ed.querySelector('input')?.focus();\n}\n\nfunction handleGridClicks(e) {\n  const btn = e.target.closest('button');\n  if (!btn) return;\n  const wrap = e.target.closest('[data-id]');\n  const id = wrap?.dataset?.id; if (!id) return;\n  const action = btn.dataset.action;\n  \n  if (action === 'bookmark') { Store.toggleBookmark(id); showToast('Bookmark toggled','secondary'); }\n  if (action === 'star') { Store.toggleStar(id); showToast('Star toggled','warning'); }\n  if (action === 'delete') {\n    const title = wrap.querySelector('.doc-title,.card-title')?.textContent?.trim();\n    const msg = `Delete ${title ? `\"${title}\"` : 'this document'}?\\nThis action cannot be undone.`;\n    niceConfirm(msg, { okText: 'Delete', cancelText: 'Cancel', variant: 'danger' }).then((ok) => {\n      if (!ok) return; // user canceled\n      if (typeof Store.deleteDoc === 'function') Store.deleteDoc(id, { confirmed: true });\n      else if (typeof Store.remove === 'function') Store.remove(id);\n      else if (typeof Store.del === 'function') Store.del(id);\n      showToast('Document deleted', 'danger');\n      render(Store.all());\n    });\n    return; // prevent fall-through render when awaiting confirm\n  }\n  if (action === 'comment') { emit('comments:open', { docId: id }); }\n\n  if (action === 'filter-status') {\n    const s = (btn.dataset.status||'').toLowerCase();\n    const tok = 'status:'+s;\n    if (selectedTags.has(tok)) selectedTags.delete(tok); else selectedTags.add(tok);\n    render(Store.all());\n    return;\n  }\n\n  if (action === 'filter-tag') {\n    const tag = btn.dataset.tag || '';\n    if (selectedTags.has(tag)) selectedTags.delete(tag); else selectedTags.add(tag);\n    render(Store.all());\n    return;\n  }\n\n  if (action === 'edit-doc') { openEditDoc(id); return; }\n\n  if (action === 'edit-tags') {\n    const card = btn.closest('.card');\n    const open = card.querySelector('.tag-editor')?.classList.contains('d-none') === false;\n    gridAll.querySelectorAll('.tag-editor').forEach(el => el.classList.add('d-none'));\n    toggleEditor(card, !open);\n    return;\n  }\n\n  if (action === 'save-tags') {\n    const card = btn.closest('.card');\n    const input = card.querySelector('.tag-editor input');\n    const tags = (input?.value || '').split(',').map(s=>s.trim()).filter(Boolean);\n    Store.updateTags(id, tags);\n    showToast('Tags updated','primary');\n    render(Store.all());\n    return;\n  }\n\n  if (action === 'cancel-tags') {\n    const card = btn.closest('.card');\n    toggleEditor(card, false);\n    return;\n  }\n\n  render(Store.all());\n}\n\nfunction handleFiltersBarClick(e) {\n  const rm = e.target.closest('[data-action=\"remove-chip\"]');\n  const clr = e.target.closest('[data-action=\"clear-chips\"]');\n  const applySaved = e.target.closest('[data-action=\"apply-saved\"]');\n  const removeSaved = e.target.closest('[data-action=\"remove-saved\"]');\n\n  if (rm) {\n    const chip = rm.closest('[data-chip]')?.dataset?.chip;\n    if (chip) selectedTags.delete(chip);\n    render(Store.all());\n    return;\n  }\n  if (clr) { selectedTags.clear(); render(Store.all()); return; }\n\n  if (applySaved) {\n    const id = applySaved.closest('[data-id]')?.dataset?.id;\n    const f = Store.savedFilters().find(x => x.id === id);\n    if (f) {\n      selectedTags.clear();\n      for (const t of (f.tags||[])) selectedTags.add(t);\n      searchInput.value = f.query || '';\n      render(Store.all());\n    }\n    return;\n  }\n  if (removeSaved) {\n    const id = removeSaved.closest('[data-id]')?.dataset?.id;\n    Store.removeFilter(id);\n    renderSavedFilters();\n    showToast('Saved filter removed','secondary');\n  }\n}\n\nfunction openEditDoc(id) {\n  const safeSet = (form, name, val) => { const el = form?.querySelector(`[name=\"${name}\"]`); if (el) el.value = val ?? ''; };\n  const d = Store.byId(id); if (!d) return;\n  const form = document.getElementById('editDocForm');\n  form.dataset.mode = 'edit';\n  form.dataset.id = id;\n  form.querySelector('[name=\"title\"]').value = d.title || '';\n  form.querySelector('[name=\"description\"]').value = d.description || '';\n  form.querySelector('[name=\"tags\"]').value = (d.tags||[]).join(', ');\n  safeSet(form,'url', d.url || '');\n  safeSet(form,'owner', d.owner || '');\n  safeSet(form,'status', d.status || '');\n  safeSet(form,'icon', d.icon || '');\n  safeSet(form,'color', d.color || '#2563eb');\n\n  const modalEl = document.getElementById('editDocModal');\n  const titleEl = modalEl.querySelector('.modal-title');\n  const submitBtn = form.querySelector('button[type=\"submit\"]');\n  if (titleEl) titleEl.textContent = 'Edit Document';\n  if (submitBtn) submitBtn.textContent = 'Save';\n\n  // Remove inert when showing\n  modalEl.addEventListener('show.bs.modal', function handlerShow() {\n    modalEl.removeAttribute('inert');\n    modalEl.removeEventListener('show.bs.modal', handlerShow);\n  });\n\n  const modal = window.bootstrap.Modal.getInstance(modalEl) || new window.bootstrap.Modal(modalEl);\n  modal.show();\n}\n\nfunction handleAddDocModal() {\n  openModalById('addDocModal');\n}\n\nfunction wireAddDocForm() {\n  const modalEl = document.getElementById('addDocModal');\n  const form = document.getElementById('addDocForm');\n\n  form.addEventListener('submit', (e) => {\n    e.preventDefault();\n    const fd = new FormData(form);\n    const title = fd.get('title')?.toString().trim();\n    const description = fd.get('description')?.toString().trim();\n    const tags = (fd.get('tags')?.toString()||'').split(',').map(s=>s.trim()).filter(Boolean);\n    const url = fd.get('url')?.toString().trim();\n    const owner = fd.get('owner')?.toString().trim() || '';\n    const status = fd.get('status')?.toString().trim() || '';\n    const icon = fd.get('icon')?.toString().trim() || '';\n    const color = fd.get('color')?.toString().trim() || '';\n    if (!title || !description) return;\n\n    Store.addDoc({ title, description, tags, url, owner, status, icon, color });\n    showToast(`Added ${title}`,'primary');\n\n    form.reset();\n    form.dataset.mode='';\n    form.dataset.id='';\n    const modal = window.bootstrap.Modal.getInstance(modalEl) || new window.bootstrap.Modal(modalEl);\n    modal.hide();\n    \n    render(Store.all());\n  });\n}\n\nfunction wireEditDocForm() {\n  const form = document.getElementById('editDocForm');\n\n  form.addEventListener('submit', (e) => {\n    e.preventDefault();\n    const fd = new FormData(form);\n    const title = fd.get('title')?.toString().trim();\n    const description = fd.get('description')?.toString().trim();\n    const tags = (fd.get('tags')?.toString()||'').split(',').map(s=>s.trim()).filter(Boolean);\n    const url = fd.get('url')?.toString().trim();\n    const owner = fd.get('owner')?.toString().trim() || '';\n    const status = fd.get('status')?.toString().trim() || '';\n    const icon = fd.get('icon')?.toString().trim() || '';\n    const color = fd.get('color')?.toString().trim() || '';\n    if (!title || !description) return;\n\n    const id = form.dataset.id;\n    Store.updateDoc(id, { title, description, tags, url, owner, status, icon, color });\n    showToast('Saved changes','primary');\n\n    form.reset();\n    form.dataset.mode='';\n    form.dataset.id='';\n    const modalEl = document.getElementById('editDocModal');\n    const modal = window.bootstrap.Modal.getInstance(modalEl) || new window.bootstrap.Modal(modalEl);\n    modal.hide();\n\n    render(Store.all());\n  });\n}\n\nfunction wireSaveFilter() {\n  btnSaveFilter.addEventListener('click', () => {\n    const modalEl = document.getElementById('saveFilterModal');\n    const modal = window.bootstrap.Modal.getInstance(modalEl) || new window.bootstrap.Modal(modalEl);\n    document.getElementById('saveFilterName').value = '';\n    modal.show();\n  });\n\n  const form = document.getElementById('saveFilterForm');\n  form.addEventListener('submit', (e) => {\n    e.preventDefault();\n    const name = document.getElementById('saveFilterName').value.trim();\n    const query = searchInput.value.trim();\n    const tags = Array.from(selectedTags);\n    if (!name) return;\n    if (!query && tags.length === 0) { showToast('Nothing to save  add text or tag filters first','warning'); return; }\n    Store.addFilter({ name, query, tags });\n    showToast('Saved filter','primary');\n    renderSavedFilters();\n    const modalEl = document.getElementById('saveFilterModal');\n    const modal = window.bootstrap.Modal.getInstance(modalEl);\n    modal.hide();\n  });\n\n  on('filters:changed', renderSavedFilters);\n}\n\nfunction wireImportExport() {\n  btnQuickImport.addEventListener('click', () => {\n    const added = Store.quickImportStarters();\n    renderSavedFilters();\n    showToast(`${added} starter filter${added===1?'':'s'} added`, added? 'primary':'secondary');\n  });\n\n  const form = document.getElementById('importFiltersForm');\n  form.addEventListener('submit', (e) => {\n    e.preventDefault();\n    try {\n      const raw = document.getElementById('importFiltersJson').value.trim();\n      const added = Store.importFilters(JSON.parse(raw));\n      showToast(`${added} filter${added===1?'':'s'} imported`, 'primary');\n      renderSavedFilters();\n      const modalEl = document.getElementById('importFiltersModal');\n      const modal = window.bootstrap.Modal.getInstance(modalEl);\n      modal.hide();\n    } catch (err) {\n      showToast('Invalid JSON', 'danger');\n    }\n  });\n}\n\nfunction openModalById(id) {\n  const el = document.getElementById(id);\n  if (!el) return;\n  // Ensure correct ARIA before showing\n  el.removeAttribute('aria-hidden');\n  el.removeAttribute('inert');\n  el.setAttribute('aria-modal', 'true');\n\n  // JS options override data-bs-focus=\"false\"\n  let inst = bootstrap.Modal.getInstance(el);\n  if (!inst) inst = new bootstrap.Modal(el, { focus: true, backdrop: true, keyboard: true });\n  inst.show();\n}\n\nexport function initDocuments() {\n  gridAll = document.getElementById('grid-all');\n  searchInput = document.getElementById('searchInput');\n  activeTagsEl = document.getElementById('active-tags');\n  filtersBarEl = document.getElementById('filtersBar');\n  savedFiltersEl = document.getElementById('saved-filters');\n  btnSaveFilter = document.getElementById('btnSaveFilter');\n  btnQuickImport = document.getElementById('btnQuickImport');\n  addDocButton = document.getElementById('addDocButton');\n\n  gridAll.addEventListener('click', handleGridClicks);\n  activeTagsEl.addEventListener('click', handleFiltersBarClick);\n  savedFiltersEl.addEventListener('click', handleFiltersBarClick);\n  addDocButton.addEventListener('click', handleAddDocModal);\n\n  wireAddDocForm();\n  wireEditDocForm();\n  wireSaveFilter();\n  wireImportExport();\n\n  render(Store.all());\n\n  searchInput.addEventListener('input', () => render(Store.search(searchInput.value)));\n\n  on('docs:changed', () => { render(Store.all()); });\n  document.addEventListener('force:rerender', () => { render(Store.all()); });\n}\n","import { Store } from '../core/store.js';\nimport { on } from '../core/eventBus.js';\nimport { docCard2 } from '../ui/components.js';\n\nlet grid;\n\nfunction render() {\n  const list = Store.all().filter(d => d.bookmarked);\n  grid.innerHTML = list.map(docCard2).join('') || empty('No bookmarks yet.');\n}\n\nfunction empty(text) {\n  return `<div class=\"col-12 text-center text-body-secondary py-5\">\n    <i class=\"bi bi-bookmark\" style=\"font-size:3rem\"></i>\n    <div class=\"mt-2\">${text}</div>\n  </div>`;\n}\n\nexport function initBookmarks() {\n  grid = document.getElementById('grid-bookmarks');\n  render();\n  on('docs:changed', render);\n}\n","import { Store } from '../core/store.js';\nimport { on } from '../core/eventBus.js';\nimport { docCard2 } from '../ui/components.js';\n\nlet grid;\n\nfunction render() {\n  const list = Store.all().filter(d => d.starred);\n  grid.innerHTML = list.map(docCard2).join('') || empty('No starred documents yet.');\n}\n\nfunction empty(text) {\n  return `<div class=\"col-12 text-center text-body-secondary py-5\">\n    <i class=\"bi bi-star\" style=\"font-size:3rem\"></i>\n    <div class=\"mt-2\">${text}</div>\n  </div>`;\n}\n\nexport function initStarred() {\n  grid = document.getElementById('grid-starred');\n  render();\n  on('docs:changed', render);\n}\n","import { Store } from '../core/store.js';\nimport { on } from '../core/eventBus.js';\nimport { escapeHtml, timeAgo } from '../ui/components.js';\n\nlet offcanvas, threadEl, metaEl, inputEl, formEl, currentDocId;\n\nfunction hMsg(m) {\n  const mine = m.author === 'You';\n  return `<div class=\"d-flex ${mine?'justify-content-end':''}\">\n    <div class=\"msg ${mine?'me':'other'} p-2 mb-2\" style=\"max-width: 80%\">\n      <div class=\"small text-body-secondary mb-1\">${escapeHtml(m.author)}  ${timeAgo(m.ts)}</div>\n      <div>${escapeHtml(m.text)}</div>\n    </div>\n  </div>`;\n}\n\nfunction renderThread() {\n  const msgs = Store.commentsFor(currentDocId);\n  threadEl.innerHTML = msgs.map(hMsg).join('') || `<div class=\"text-body-secondary\">No comments yet. Start the discussion!</div>`;\n  threadEl.scrollTop = threadEl.scrollHeight;\n}\n\nfunction openFor(docId) {\n  currentDocId = docId;\n  const d = Store.byId(docId);\n  metaEl.innerHTML = `<strong>${escapeHtml(d.title)}</strong>  ${d.tags.map(t=>`#${escapeHtml(t)}`).join(' ')}`;\n  renderThread();\n  const el = document.getElementById('commentsPanel');\n  offcanvas = window.bootstrap.Offcanvas.getInstance(el) || new window.bootstrap.Offcanvas(el);\n  offcanvas.show();\n}\n\nfunction onSubmit(e) {\n  e.preventDefault();\n  const text = inputEl.value.trim();\n  if (!text) return;\n  Store.addComment(currentDocId, text);\n  inputEl.value = '';\n  renderThread();\n}\n\nexport function initComments() {\n  threadEl = document.getElementById('thread');\n  metaEl = document.getElementById('thread-meta');\n  inputEl = document.getElementById('commentInput');\n  formEl = document.getElementById('commentForm');\n  formEl.addEventListener('submit', onSubmit);\n\n  on('comments:open', ({ docId }) => openFor(docId));\n  on('comments:changed', ({ docId }) => { if (docId === currentDocId) renderThread(); });\n}\n","import { Store } from '../core/store.js';\nimport { on } from '../core/eventBus.js';\nimport { escapeHtml, timeAgo } from '../ui/components.js';\n\nlet listEl;\n\nconst ICON = {\n  'doc:new': 'bi-file-earmark-plus',\n  'doc:deleted': 'bi-trash',\n  'doc:starred': 'bi-star-fill',\n  'doc:unstarred': 'bi-star',\n  'doc:bookmarked': 'bi-bookmark-fill',\n  'doc:unbookmarked': 'bi-bookmark',\n  'comment:new': 'bi-chat-dots',\n  'doc:tags': 'bi-tags'\n};\n\nfunction item(a) {\n  const i = ICON[a.type] || 'bi-activity';\n  const title = escapeHtml(a.meta?.title || '');\n  const who = escapeHtml(a.meta?.author || '');\n  let text = '';\n  if (a.type === 'comment:new') text = `${who} commented on <strong>${title}</strong>`;\n  if (a.type === 'doc:new') text = `New document <strong>${title}</strong>`;\n  if (a.type === 'doc:deleted') text = `Deleted <strong>${title}</strong>`;\n  if (a.type === 'doc:starred') text = `Starred <strong>${title}</strong>`;\n  if (a.type === 'doc:unstarred') text = `Unstarred <strong>${title}</strong>`;\n  if (a.type === 'doc:bookmarked') text = `Bookmarked <strong>${title}</strong>`;\n  if (a.type === 'doc:unbookmarked') text = `Removed bookmark on <strong>${title}</strong>`;\n  if (a.type === 'doc:tags') text = `Updated tags on <strong>${title}</strong>`;\n\n  return `<div class=\"d-flex align-items-start gap-3\">\n    <div class=\"rounded-circle bg-body-secondary d-flex align-items-center justify-content-center\" style=\"width:38px;height:38px\">\n      <i class=\"bi ${i}\"></i>\n    </div>\n    <div class=\"flex-grow-1\">\n      <div>${text}</div>\n      <div class=\"small text-body-secondary\">${timeAgo(a.ts)}</div>\n    </div>\n  </div>`;\n}\n\nfunction render() {\n  const feed = Store.activities();\n  listEl.innerHTML = feed.map(item).join('') || `<div class=\"text-body-secondary\">No activity yet.</div>`;\n}\n\nexport function initCommunity() {\n  listEl = document.getElementById('list-feed');\n  render();\n  on('activity:added', render);\n}\n","// assets/js/core/auth.js\nconst ROLE_KEY = 'msaas-user-role';\nexport const Auth = {\n  getRole() { return localStorage.getItem(ROLE_KEY) || 'admin'; },\n  setRole(role='viewer') { localStorage.setItem(ROLE_KEY, role); },\n  isAdmin() { return this.getRole() === 'admin'; },\n  canEdit() { return this.isAdmin(); }\n};\nwindow.Auth = Auth;","// assets/js/modules/filters-admin.js\r\nimport { Store } from '../core/store.js';\r\nimport { showToast } from '../ui/components.js';\r\n\r\nlet listEl, selectAllEl, btnSave, btnDelete, btnOpen;\r\n\r\nfunction rowTpl(f) {\r\n  const tags = (f.tags || []).join(', ');\r\n  return `\r\n    <li class=\"list-group-item p-0\" draggable=\"true\" data-id=\"${f.id}\">\r\n      <div class=\"mf-row\">\r\n        <span class=\"mf-handle bi bi-grip-vertical\" title=\"Drag to reorder\"></span>\r\n        <input class=\"form-check-input mf-check\" type=\"checkbox\" aria-label=\"Select ${f.name}\">\r\n        <input class=\"form-control form-control-sm mf-input mf-name\" value=\"${escapeHtml(f.name)}\" />\r\n        <div class=\"small text-body-secondary mf-tags\">${escapeHtml(tags)}</div>\r\n        <button type=\"button\" class=\"btn btn-sm btn-outline-danger mf-del-one\" title=\"Delete\"><i class=\"bi bi-trash\"></i></button>\r\n      </div>\r\n    </li>`;\r\n}\r\n\r\nfunction escapeHtml(s='') {\r\n  return String(s)\r\n    .replaceAll('&','&amp;')\r\n    .replaceAll('<','&lt;')\r\n    .replaceAll('>','&gt;')\r\n    .replaceAll('\"','&quot;')\r\n    .replaceAll(\"'\",\"&#39;\");\r\n}\r\n\r\nfunction render() {\r\n  const items = Store.savedFilters();\r\n  listEl.innerHTML = items.length ? items.map(rowTpl).join('') :\r\n    `<li class=\"list-group-item text-body-secondary\">No saved filters.</li>`;\r\n}\r\n\r\nfunction initDrag() {\r\n  let draggingEl = null;\r\n\r\n  listEl.addEventListener('dragstart', (e) => {\r\n    draggingEl = e.target.closest('[draggable=\"true\"]');\r\n    e.dataTransfer.effectAllowed = 'move';\r\n  });\r\n\r\n  listEl.addEventListener('dragover', (e) => {\r\n    const over = e.target.closest('[draggable=\"true\"]');\r\n    if (!draggingEl || !over || over === draggingEl) return;\r\n    e.preventDefault();\r\n    // visual hint\r\n    over.classList.add('drag-over');\r\n    // position insert\r\n    const rect = over.getBoundingClientRect();\r\n    const before = (e.clientY - rect.top) < rect.height / 2;\r\n    listEl.insertBefore(draggingEl, before ? over : over.nextSibling);\r\n  });\r\n\r\n  listEl.addEventListener('dragleave', (e) => {\r\n    e.target.closest('[draggable=\"true\"]')?.classList.remove('drag-over');\r\n  });\r\n\r\n  listEl.addEventListener('drop', (e) => {\r\n    e.preventDefault();\r\n    listEl.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));\r\n    draggingEl = null;\r\n  });\r\n}\r\n\r\nfunction idsFromDOM() {\r\n  return [...listEl.querySelectorAll('[draggable=\"true\"]')].map(li => li.dataset.id);\r\n}\r\n\r\nfunction validateNames() {\r\n  const inputs = [...listEl.querySelectorAll('.mf-input')];\r\n  let ok = true;\r\n  const seen = new Set();\r\n  for (const inp of inputs) {\r\n    const name = inp.value.trim();\r\n    inp.classList.remove('is-invalid');\r\n    if (!name) { inp.classList.add('is-invalid'); ok = false; }\r\n    if (seen.has(name)) { inp.classList.add('is-invalid'); ok = false; }\r\n    seen.add(name);\r\n  }\r\n  return ok;\r\n}\r\n\r\nfunction saveChanges() {\r\n  if (!validateNames()) { showToast('Fix invalid/duplicate names', 'danger'); return; }\r\n\r\n  // rename pass\r\n  const rows = [...listEl.querySelectorAll('[draggable=\"true\"]')];\r\n  for (const li of rows) {\r\n    const id = li.dataset.id;\r\n    const name = li.querySelector('.mf-name').value.trim();\r\n    if (!Store.renameFilter(id, name)) {\r\n      li.querySelector('.mf-name').classList.add('is-invalid');\r\n      showToast(`Could not rename ${name}`, 'danger');\r\n      return;\r\n    }\r\n  }\r\n  // reorder pass\r\n  Store.reorderFilters(idsFromDOM());\r\n\r\n  showToast('Filters updated', 'primary');\r\n  render(); // reflect sanitized state\r\n}\r\n\r\nfunction bulkDelete() {\r\n  const ids = [...listEl.querySelectorAll('.mf-check:checked')].map(c => c.closest('[draggable=\"true\"]').dataset.id);\r\n  if (ids.length === 0) { showToast('No filters selected', 'secondary'); return; }\r\n  if (!confirm(`Delete ${ids.length} filter${ids.length===1?'':'s'}? This cannot be undone.`)) return;\r\n  Store.removeFilters(ids);\r\n  showToast('Deleted', 'secondary');\r\n  render();\r\n}\r\n\r\nfunction listHandlers() {\r\n  // per-row delete\r\n  listEl.addEventListener('click', (e) => {\r\n    const btn = e.target.closest('.mf-del-one');\r\n    if (!btn) return;\r\n    const id = btn.closest('[draggable=\"true\"]').dataset.id;\r\n    Store.removeFilters([id]);\r\n    render();\r\n  });\r\n\r\n  // select all\r\n  selectAllEl.addEventListener('change', () => {\r\n    listEl.querySelectorAll('.mf-check').forEach(c => c.checked = selectAllEl.checked);\r\n  });\r\n}\r\n\r\nexport function initFiltersAdmin() {\r\n  btnOpen     = document.getElementById('btnManageFilters');\r\n  listEl      = document.getElementById('mf-list');\r\n  selectAllEl = document.getElementById('mf-select-all');\r\n  btnSave     = document.getElementById('mf-save');\r\n  btnDelete   = document.getElementById('mf-delete');\r\n\r\n  if (!btnOpen || !listEl) return; // modal not present\r\n\r\n  btnOpen.addEventListener('click', () => {\r\n    render();\r\n    const modalEl = document.getElementById('manageFiltersModal');\r\n    const modal = window.bootstrap.Modal.getInstance(modalEl) || new window.bootstrap.Modal(modalEl);\r\n    modal.show();\r\n  });\r\n\r\n  btnSave.addEventListener('click', saveChanges);\r\n  btnDelete.addEventListener('click', bulkDelete);\r\n\r\n  listHandlers();\r\n  initDrag();\r\n}\r\n","// assets/js/modules/backup.js\nimport { showToast } from '../ui/components.js';\n\nconst KEY = 'msaas-docs-state-v1';\n\nfunction readState() {\n  try {\n    const raw = localStorage.getItem(KEY);\n    return raw ? JSON.parse(raw) : { docs: [], comments: {}, activities: [], savedFilters: [] };\n  } catch (e) {\n    return { docs: [], comments: {}, activities: [], savedFilters: [] };\n  }\n}\n\nfunction validateState(obj) {\n  const errors = [];\n  const ok = (cond, msg) => { if (!cond) errors.push(msg); };\n\n  ok(obj && typeof obj === 'object' && !Array.isArray(obj), 'Root must be an object');\n  ok(Array.isArray(obj.docs), '`docs` must be an array');\n  ok(obj.comments && typeof obj.comments === 'object' && !Array.isArray(obj.comments), '`comments` must be an object');\n  ok(Array.isArray(obj.activities), '`activities` must be an array');\n  ok(Array.isArray(obj.savedFilters), '`savedFilters` must be an array');\n\n  return { valid: errors.length === 0, errors };\n}\n\nfunction download(filename, text) {\n  const blob = new Blob([text], { type: 'application/json' });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url; a.download = filename;\n  document.body.appendChild(a);\n  a.click();\n  a.remove();\n  URL.revokeObjectURL(url);\n}\n\nfunction ts() {\n  const d = new Date();\n  const pad = (n) => String(n).padStart(2, '0');\n  return d.getFullYear()\n    + '' + pad(d.getMonth() + 1)\n    + '' + pad(d.getDate())\n    + '-' + pad(d.getHours()) + pad(d.getMinutes()) + pad(d.getSeconds());\n}\n\nexport function initBackupUI() {\n  const btnExport = document.getElementById('btnBackupExport');\n  const btnImport = document.getElementById('btnBackupImport');\n  const modalEl   = document.getElementById('importBackupModal');\n  const fileEl    = document.getElementById('importBackupFile');\n  const textEl    = document.getElementById('importBackupJson');\n  const overwriteEl = document.getElementById('importBackupOverwrite');\n  const form      = document.getElementById('importBackupForm');\n\n  if (btnExport) {\n    btnExport.addEventListener('click', () => {\n      const state = readState();\n      const pretty = JSON.stringify(state, null, 2);\n      download('dochub-backup-' + ts() + '.json', pretty);\n      showToast('Backup downloaded', 'primary');\n    });\n  }\n\n  if (btnImport) {\n    btnImport.addEventListener('click', () => {\n      if (!modalEl) return;\n      const modal = window.bootstrap?.Modal?.getInstance(modalEl) || new window.bootstrap.Modal(modalEl);\n      if (fileEl) fileEl.value = '';\n      if (textEl) textEl.value = '';\n      if (overwriteEl) overwriteEl.checked = true;\n      modal.show();\n    });\n  }\n\n  async function loadFileToTextarea(file) {\n    if (!file || !textEl) return;\n    const txt = await file.text();\n    try {\n      const parsed = JSON.parse(txt);\n      textEl.value = JSON.stringify(parsed, null, 2);\n    } catch (e) {\n      textEl.value = txt; // let user fix\n    }\n  }\n\n  if (fileEl) {\n    fileEl.addEventListener('change', async () => {\n      const f = fileEl.files && fileEl.files[0];\n      if (f) await loadFileToTextarea(f);\n    });\n  }\n\n  if (form) {\n    form.addEventListener('submit', (e) => {\n      e.preventDefault();\n      try {\n        const raw = (textEl?.value || '').trim();\n        const parsed = JSON.parse(raw);\n        const v = validateState(parsed);\n        if (!v.valid) {\n          showToast('Import failed: ' + v.errors.join('; '), 'danger');\n          return;\n        }\n        if (overwriteEl?.checked) {\n          localStorage.setItem(KEY, JSON.stringify(parsed));\n        } else {\n          // shallow merge\n          const cur = readState();\n          const merged = {\n            docs: [...(cur.docs || []), ...(parsed.docs || [])],\n            comments: { ...(cur.comments || {}), ...(parsed.comments || {}) },\n            activities: [...(cur.activities || []), ...(parsed.activities || [])],\n            savedFilters: [...(cur.savedFilters || []), ...(parsed.savedFilters || [])]\n          };\n          localStorage.setItem(KEY, JSON.stringify(merged));\n        }\n        showToast('Import complete  reloading', 'primary');\n        setTimeout(() => window.location.reload(), 400);\n      } catch (err) {\n        showToast('Invalid JSON', 'danger');\n      }\n    });\n  }\n}\n","// assets/js/modules/tags-admin.js\nimport { Store } from '../core/store.js';\nimport { showToast } from '../ui/components.js';\nlet btnOpen, modalRoot, listEl, searchEl, btnRename, btnMerge, btnDelete, targetInput;\nfunction getTagStats(){const counts=new Map();const bump=(name,key)=>{const n=String(name||'').trim();if(!n)return;const v=counts.get(n)||{docs:0,filters:0};v[key]+=1;counts.set(n,v)};const docs=Store.all();for(const d of docs){const uniq=new Set((d.tags||[]).filter(Boolean));for(const t of uniq)bump(t,'docs')}const filters=Store.savedFilters();for(const f of filters){const uniq=new Set((f.tags||[]).filter(Boolean));for(const t of uniq)bump(t,'filters')}return[...counts.entries()].sort((a,b)=>a[0].localeCompare(b[0]))}\nfunction escapeHtml(s=''){return String(s).replace(/[&<>\"']/g,(ch)=>({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',\"'\":'&#39;'}[ch]))}\nfunction rowTpl(name,meta){return`<tr data-name=\"${escapeHtml(name)}\"><td class=\"text-center\" style=\"width:36px\"><input class=\"form-check-input tag-check\" type=\"checkbox\" aria-label=\"Select ${escapeHtml(name)}\"></td><td><code>#${escapeHtml(name)}</code></td><td class=\"text-end\"><span class=\"badge bg-light text-body\">Docs: ${meta.docs}</span></td><td class=\"text-end\"><span class=\"badge bg-light text-body\">Filters: ${meta.filters}</span></td><td class=\"text-end\" style=\"width:40px\"><button type=\"button\" class=\"btn btn-sm btn-outline-secondary one-rename\" title=\"Rename\"><i class=\"bi bi-pencil\"></i></button></td></tr>`}\nfunction render(){const q=(searchEl?.value||'').trim().toLowerCase();const rows=getTagStats().filter(([name])=>q?name.toLowerCase().includes(q):true).map(([name,meta])=>rowTpl(name,meta)).join('');listEl.innerHTML=rows||`<tr><td colspan=\"5\" class=\"text-body-secondary py-4 text-center\">No tags found.</td></tr>`}\nfunction selectedTags(){return[...listEl.querySelectorAll('.tag-check:checked')].map(cb=>cb.closest('tr')?.dataset?.name).filter(Boolean)}\nfunction requireSelection(min,exact=null){const sel=selectedTags();if((min&&sel.length<min)||(exact!=null&&sel.length!==exact)){showToast(exact!=null?`Select exactly ${exact} tag${exact===1?'':'s'}`:`Select at least ${min} tag${min===1?'':'s'}`,'warning');return null}return sel}\nfunction doRename(oldName,newName){const n=String(newName||'').trim();if(!n){showToast('Enter a new tag name','warning');return}if(n===oldName){showToast('New name is the same','secondary');return}const res=Store.renameTag?Store.renameTag(oldName,n):null;if(res===false){showToast('Rename failed','danger');return}render();showToast(`Renamed #${oldName}  #${n}`,'primary')}\nfunction doMerge(names,target){const t=String(target||'').trim();if(!t){showToast('Enter a target tag name','warning');return}if(Store.mergeTags){Store.mergeTags(names,t)}else if(Store.renameTag){const uniq=new Set(names);for(const name of uniq)if(name!==t)Store.renameTag(name,t)}else{showToast('Store API missing: renameTag/mergeTags','danger');return}render();showToast(`Merged ${names.length} tag(s) into #${t}`,'primary')}\nfunction doDelete(names){if(!confirm(`Delete ${names.length} tag${names.length===1?'':'s'} from all docs and filters?`))return;if(Store.deleteTag){for(const n of names)Store.deleteTag(n)}else{const docs=Store.all();for(const d of docs){const next=(d.tags||[]).filter(t=>!names.includes(t));if(next.length!==(d.tags||[]).length)Store.updateTags(d.id,next)}}render();showToast('Deleted','secondary')}\nfunction wireModal(){searchEl.addEventListener('input',render);listEl.addEventListener('click',e=>{const btn=e.target.closest('.one-rename');if(!btn)return;const tr=btn.closest('tr');const oldName=tr?.dataset?.name;if(!oldName)return;const val=prompt(`Rename #${oldName} to:`);if(val!=null)doRename(oldName,val)});btnRename.addEventListener('click',()=>{const sel=requireSelection(1,1);if(!sel)return;const val=targetInput.value.trim()||prompt(`Rename #${sel[0]} to:`)||'';if(!val)return;doRename(sel[0],val);targetInput.value=''});btnMerge.addEventListener('click',()=>{const sel=requireSelection(2,null);if(!sel)return;const val=targetInput.value.trim()||prompt('Merge into (target tag):')||'';if(!val)return;doMerge(sel,val);targetInput.value=''});btnDelete.addEventListener('click',()=>{const sel=requireSelection(1,null);if(!sel)return;doDelete(sel)})}\nexport function initTagsAdmin(){btnOpen=document.getElementById('btnManageTags');modalRoot=document.getElementById('manageTagsModal');listEl=document.getElementById('tags-list');searchEl=document.getElementById('tags-search');btnRename=document.getElementById('tags-rename');btnMerge=document.getElementById('tags-merge');btnDelete=document.getElementById('tags-delete');targetInput=document.getElementById('tags-target');if(!btnOpen||!modalRoot)return;btnOpen.addEventListener('click',()=>{render();const modal=window.bootstrap?.Modal?.getInstance(modalRoot)||new window.bootstrap.Modal(modalRoot);modal.show()});wireModal()}\n","// assets/js/modules/shortcuts.js\nimport { Store } from '../core/store.js';\nimport { showToast } from '../ui/components.js';\nlet activeId=null,lastActiveEl=null;\nfunction setActiveCard(el){if(lastActiveEl)lastActiveEl.classList.remove('kbd-active');lastActiveEl=el;if(el){el.classList.add('kbd-active');activeId=el.getAttribute('data-id')||el.getAttribute('data-doc-id')}else{activeId=null}}\nfunction getActiveId(){if(activeId)return activeId;const el=document.querySelector('.doc-card,[data-id],[data-doc-id]');if(el)setActiveCard(el.closest('[data-id],[data-doc-id]')||el);return activeId}\nfunction toggleStar(){const id=getActiveId();if(!id)return showToast('Select a card first (click it)','secondary');Store.toggleStar?.(id);showToast('Toggled star','primary')}\nfunction toggleBookmark(){const id=getActiveId();if(!id)return showToast('Select a card first (click it)','secondary');Store.toggleBookmark?.(id);showToast('Toggled bookmark','primary')}\nfunction editTagsQuick(){const id=getActiveId();if(!id)return showToast('Select a card first (click it)','secondary');const el=lastActiveEl;const btn=el?.querySelector?.('.btn-edit-tags,[data-action=\"edit-tags\"]');if(btn){btn.click();return}const doc=Store.byId?.(id);const current=(doc?.tags||[]).join(', ');const val=prompt('Edit tags (comma-separated):',current);if(val==null)return;const tags=val.split(',').map(s=>s.trim()).filter(Boolean);Store.updateTags?.(id,tags);showToast('Tags updated','primary')}\nfunction focusSearch(){const ids=['inputSearch','search','q'];for(const id of ids){const el=document.getElementById(id);if(el){el.focus();el.select?.();return}}const el=document.querySelector('input[type=\"search\"], input[name*=\"search\" i]');if(el){el.focus();el.select?.()}}\nfunction toggleCheatsheet(){const modalEl=document.getElementById('shortcutsModal');if(!modalEl)return;const modal=window.bootstrap?.Modal?.getInstance(modalEl)||new window.bootstrap.Modal(modalEl);if(modalEl.classList.contains('show'))modal.hide();else modal.show()}\nfunction isTypingInField(e){const t=e.target;const tag=(t.tagName||'').toLowerCase();const editable=t.isContentEditable||t.getAttribute?.('contenteditable')==='true';return editable||tag==='input'||tag==='textarea'||tag==='select'}\nfunction handleKeydown(e){if(isTypingInField(e))return;if((e.key==='/'&&!e.shiftKey)||(e.key==='k'&&e.ctrlKey)){e.preventDefault();focusSearch();return}if(e.key==='?'||(e.key.toLowerCase()==='k'&&e.metaKey)){e.preventDefault();toggleCheatsheet();return}if(e.key.toLowerCase()==='s'&&!e.ctrlKey&&!e.metaKey&&!e.altKey){e.preventDefault();toggleStar();return}if(e.key.toLowerCase()==='b'&&!e.ctrlKey&&!e.metaKey&&!e.altKey){e.preventDefault();toggleBookmark();return}if(e.key.toLowerCase()==='e'&&!e.ctrlKey&&!e.metaKey&&!e.altKey){e.preventDefault();editTagsQuick();return}}\nfunction trackActiveCard(){document.addEventListener('click',e=>{const card=e.target.closest?.('[data-id],[data-doc-id],.doc-card');if(card)setActiveCard(card.closest?.('[data-id],[data-doc-id]')||card)})}\nexport function initShortcuts(){trackActiveCard();document.addEventListener('keydown',handleKeydown);const first=document.querySelector('[data-id],[data-doc-id],.doc-card');if(first)setActiveCard(first.closest?.('[data-id],[data-doc-id]')||first)}\n","// assets/js/modules/bulk-actions.js\n// Bulk select + batch actions (star, bookmark, add/remove tag).\nimport { Store } from '../core/store.js';\nimport { showToast } from '../ui/components.js';\n\nlet mode = false;\nconst selected = new Set();\nlet bar, countEl, btnSelect, btnClear, btnStar, btnUnstar, btnBm, btnUnbm, btnAddTag, btnRemoveTag;\n\nfunction cardSelector() {\n  return '[data-id],[data-doc-id],.doc-card';\n}\n\nfunction getId(el) {\n  const card = el.closest?.(cardSelector());\n  if (!card) return null;\n  return card.getAttribute('data-id') || card.getAttribute('data-doc-id') || null;\n}\n\nfunction setSelectedVisual(id, on) {\n  const card = document.querySelector(`${cardSelector()}[data-id=\"${id}\"]`) ||\n               document.querySelector(`${cardSelector()}[data-doc-id=\"${id}\"]`);\n  if (card) {\n    card.classList.toggle('bulk-selected', on);\n    card.setAttribute('aria-selected', on ? 'true' : 'false');\n  }\n}\n\nfunction refreshCount() {\n  if (countEl) countEl.textContent = String(selected.size);\n  if (bar) bar.classList.toggle('d-none', !mode);\n}\n\nfunction toggleMode(on) {\n  mode = (on === undefined) ? !mode : !!on;\n  document.body.classList.toggle('bulk-mode', mode);\n  if (!mode) {\n    for (const id of Array.from(selected)) setSelectedVisual(id, false);\n    selected.clear();\n  }\n  refreshCount();\n}\n\nfunction toggleSelFromEvent(e) {\n  const id = getId(e.target);\n  if (!id) return;\n  if (!mode) return; // ignore if not in bulk mode\n  e.preventDefault();\n  e.stopPropagation();\n  if (selected.has(id)) {\n    selected.delete(id);\n    setSelectedVisual(id, false);\n  } else {\n    selected.add(id);\n    setSelectedVisual(id, true);\n  }\n  refreshCount();\n}\n\nfunction ensureSomethingSelected() {\n  if (selected.size === 0) {\n    showToast('No items selected', 'secondary');\n    return false;\n  }\n  return true;\n}\n\nfunction bulkStar(shouldStar) {\n  if (!ensureSomethingSelected()) return;\n  let changed = 0;\n  for (const id of selected) {\n    const d = Store.byId?.(id);\n    if (!d) continue;\n    const want = !!shouldStar;\n    if ((d.starred || false) !== want) {\n      Store.toggleStar?.(id);\n      changed++;\n    }\n  }\n  showToast(`${shouldStar ? 'Starred' : 'Unstarred'} ${changed} item(s)`, 'primary');\n}\n\nfunction bulkBookmark(shouldBm) {\n  if (!ensureSomethingSelected()) return;\n  let changed = 0;\n  for (const id of selected) {\n    const d = Store.byId?.(id);\n    if (!d) continue;\n    const want = !!shouldBm;\n    if ((d.bookmarked || false) !== want) {\n      Store.toggleBookmark?.(id);\n      changed++;\n    }\n  }\n  showToast(`${shouldBm ? 'Bookmarked' : 'Unbookmarked'} ${changed} item(s)`, 'primary');\n}\n\nfunction promptTag(title, initial='') {\n  const val = prompt(title, initial);\n  if (val == null) return null;\n  const tag = String(val).trim();\n  if (!tag) { showToast('Tag cannot be empty', 'warning'); return null; }\n  return tag;\n}\n\nfunction bulkAddTag() {\n  if (!ensureSomethingSelected()) return;\n  const tag = promptTag('Add tag to selected:', '');\n  if (tag == null) return;\n  let changed = 0;\n  for (const id of selected) {\n    const d = Store.byId?.(id);\n    if (!d) continue;\n    const tags = Array.from(new Set([...(d.tags || []), tag]));\n    if (tags.length !== (d.tags || []).length) {\n      Store.updateTags?.(id, tags);\n      changed++;\n    }\n  }\n  showToast(`Added #${tag} to ${changed} item(s)`, 'primary');\n}\n\nfunction bulkRemoveTag() {\n  if (!ensureSomethingSelected()) return;\n  const tag = promptTag('Remove which tag from selected?', '');\n  if (tag == null) return;\n  let changed = 0;\n  for (const id of selected) {\n    const d = Store.byId?.(id);\n    if (!d) continue;\n    const before = d.tags || [];\n    const next = before.filter(t => t !== tag);\n    if (next.length !== before.length) {\n      Store.updateTags?.(id, next);\n      changed++;\n    }\n  }\n  showToast(`Removed #${tag} from ${changed} item(s)`, 'secondary');\n}\n\nfunction wireBarButtons() {\n  btnClear?.addEventListener('click', () => toggleMode(false));\n  btnStar?.addEventListener('click', () => bulkStar(true));\n  btnUnstar?.addEventListener('click', () => bulkStar(false));\n  btnBm?.addEventListener('click', () => bulkBookmark(true));\n  btnUnbm?.addEventListener('click', () => bulkBookmark(false));\n  btnAddTag?.addEventListener('click', bulkAddTag);\n  btnRemoveTag?.addEventListener('click', bulkRemoveTag);\n}\n\nexport function initBulkActions() {\n  bar = document.getElementById('bulkBar');\n  countEl = document.getElementById('bulkCount');\n  btnSelect = document.getElementById('btnBulkSelect');\n  btnClear = document.getElementById('bulkClear');\n  btnStar = document.getElementById('bulkStar');\n  btnUnstar = document.getElementById('bulkUnstar');\n  btnBm = document.getElementById('bulkBookmark');\n  btnUnbm = document.getElementById('bulkUnbookmark');\n  btnAddTag = document.getElementById('bulkAddTag');\n  btnRemoveTag = document.getElementById('bulkRemoveTag');\n\n  // Button to enter/exit select mode\n  btnSelect?.addEventListener('click', () => {\n    toggleMode(!mode);\n  });\n\n  // Listen on document for card clicks in bulk mode\n  document.addEventListener('click', (e) => {\n    if (!mode) return;\n    if (e.target.closest?.('#bulkBar')) return; // ignore clicks inside bar\n    toggleSelFromEvent(e);\n  });\n\n  wireBarButtons();\n  refreshCount();\n}\n","// assets/js/modules/safe-mode.js\n// UI toggle for Safe Mode (demo mode). When ON, writes are blocked in Store.save().\n\nimport { showToast } from '../ui/components.js';\n\nconst SAFE_KEY = 'msaas-safe-mode';\n\nfunction isSafe() {\n  return localStorage.getItem(SAFE_KEY) === '1';\n}\nfunction setSafe(on) {\n  if (on) localStorage.setItem(SAFE_KEY, '1'); else localStorage.removeItem(SAFE_KEY);\n  document.documentElement.classList.toggle('safe-mode', !!on);\n  // Inform listeners if they care\n  const evt = new CustomEvent('safe:changed', { detail: { on: !!on } });\n  window.dispatchEvent(evt);\n}\n\nfunction updateButton(btn) {\n  const on = isSafe();\n  btn?.classList.toggle('btn-outline-danger', on);\n  btn?.classList.toggle('btn-outline-secondary', !on);\n  btn?.setAttribute('aria-pressed', on ? 'true' : 'false');\n  const icon = btn?.querySelector('i');\n  if (icon) icon.className = on ? 'bi bi-shield-lock-fill' : 'bi bi-shield-lock';\n  const text = btn?.querySelector('.label');\n  if (text) text.textContent = on ? 'Safe ON' : 'Safe OFF';\n  const badge = document.getElementById('safeBadge');\n  if (badge) badge.classList.toggle('d-none', !on);\n}\n\nexport function initSafeMode() {\n  const btn = document.getElementById('btnSafeMode');\n  const badge = document.getElementById('safeBadge');\n  // initial render\n  document.documentElement.classList.toggle('safe-mode', isSafe());\n  updateButton(btn);\n  if (badge && isSafe()) badge.classList.remove('d-none');\n\n  btn?.addEventListener('click', () => {\n    const on = !isSafe();\n    setSafe(on);\n    updateButton(btn);\n    showToast(on ? 'Safe mode ON  writes disabled' : 'Safe mode OFF  writes enabled', on ? 'secondary' : 'primary');\n  });\n}\n","import { initDocuments } from './js/modules/documents.js';\nimport { initBookmarks } from './js/modules/bookmarks.js';\nimport { initStarred } from './js/modules/starred.js';\nimport { initComments } from './js/modules/comments.js';\nimport { initCommunity } from './js/modules/community.js';\nimport { updateCounts, showToast } from './js/ui/components.js';\nimport { on } from './js/core/eventBus.js';\nimport { Store } from './js/core/store.js';\nimport { Auth } from './js/core/auth.js';\nimport { initFiltersAdmin } from './js/modules/filters-admin.js';\nimport { initBackupUI } from './js/modules/backup.js';\nimport { initTagsAdmin } from './js/modules/tags-admin.js';\nimport { initShortcuts } from './js/modules/shortcuts.js';\nimport { initBulkActions } from './js/modules/bulk-actions.js';\nimport { initQuickAdd } from './js/modules/quick-add.js';\nimport { initSafeMode } from './js/modules/safe-mode.js';\nimport { initAdminSidebar } from './js/modules/admin-sidebar.js';\nimport { initAdminExtensions } from './js/modules/admin-extensions.js';\n\nfunction initTheme() {\n  const key = 'msaas-theme';\n  const html = document.documentElement;\n  const btn = document.getElementById('btnTheme');\n  const apply = (mode) => {\n    html.setAttribute('data-bs-theme', mode);\n    btn.innerHTML = `<i class=\"bi ${mode==='dark'?'bi-moon-stars':'bi-sun'}\"></i>`;\n    localStorage.setItem(key, mode);\n  };\n  const stored = localStorage.getItem(key) || 'light';\n  apply(stored);\n  btn.addEventListener('click', () => apply(html.getAttribute('data-bs-theme')==='light'?'dark':'light'));\n}\n\nfunction rememberActiveTab() {\n  const key = 'msaas-tab';\n  const tabs = document.getElementById('hubTabs');\n  tabs.addEventListener('shown.bs.tab', (e) => localStorage.setItem(key, e.target.id));\n  const saved = localStorage.getItem(key);\n  if (saved) {\n    const trigger = document.getElementById(saved);\n    if (trigger) new window.bootstrap.Tab(trigger).show();\n  }\n}\n\nfunction initDensity() {\n  const key = 'msaas-density';\n  const btn = document.getElementById('btnDensity');\n  const html = document.body;\n  const apply = (mode) => {\n    html.classList.toggle('density-compact', mode === 'compact');\n    btn.innerHTML = `<i class=\"bi ${mode==='compact'?'bi-arrows-collapse':'bi-arrows-expand'}\"></i>`;\n    btn.setAttribute('title', mode==='compact' ? 'Compact density' : 'Comfy density');\n    localStorage.setItem(key, mode);\n  };\n  const stored = localStorage.getItem(key) || 'comfy';\n  apply(stored);\n  btn.addEventListener('click', () => apply(html.classList.contains('density-compact') ? 'comfy' : 'compact'));\n}\n\nfunction initPalette() {\n  const key = 'msaas-brand';\n  const btn = document.getElementById('btnPalette');\n  const html = document.documentElement;\n  const palettes = [ 'default', 'emerald', 'amber', 'ruby', 'indigo' ];\n  const label = (p) => p === 'default' ? 'Default palette' : p[0].toUpperCase() + p.slice(1);\n  const apply = (p) => {\n    if (p === 'default') html.removeAttribute('data-brand');\n    else html.setAttribute('data-brand', p);\n    btn.setAttribute('title', label(p));\n    btn.innerHTML = `<i class=\"bi bi-palette2\"></i>`;\n    localStorage.setItem(key, p);\n  };\n  let current = localStorage.getItem(key) || 'default';\n  apply(current);\n  btn.addEventListener('click', () => {\n    const idx = palettes.indexOf(current);\n    current = palettes[(idx + 1) % palettes.length];\n    apply(current);\n    // refresh tooltips in case title changed\n    if (window.bootstrap?.Tooltip) {\n      const t = window.bootstrap.Tooltip.getInstance(btn) || new window.bootstrap.Tooltip(btn);\n      t.setContent({ '.tooltip-inner': label(current) });\n    }\n  });\n}\n\nfunction initTooltips() {\n  document.querySelectorAll('[data-bs-toggle=\"tooltip\"]').forEach(el => new window.bootstrap.Tooltip(el));\n}\n\n// Keep counts consistent across views\nfunction wireCounts() {\n  on('docs:changed', updateCounts);\n  updateCounts();\n}\n\nfunction openModalById(id) {\n  const el = document.getElementById(id);\n  if (!el) return;\n  // Ensure correct ARIA before showing\n  el.removeAttribute('aria-hidden');\n  el.removeAttribute('inert');\n  el.setAttribute('aria-modal', 'true');\n\n  // JS options override data-bs-focus=\"false\"\n  let inst = bootstrap.Modal.getInstance(el);\n  if (!inst) inst = new bootstrap.Modal(el, { focus: true, backdrop: true, keyboard: true });\n  inst.show();\n}\n\nfunction safeHideModal(modalId, onHidden) {\n  const el = document.getElementById(modalId);\n  if (!el) { if (typeof onHidden === 'function') onHidden(); return; }\n  // Blur any focused element inside the modal to avoid a11y warnings\n  if (el.contains(document.activeElement)) {\n    try { document.activeElement.blur(); } catch (_) { }\n  }\n  const inst = bootstrap.Modal.getInstance(el) || new bootstrap.Modal(el);\n  // Ensure focus cannot remain in a hidden modal\n  el.addEventListener('hidden.bs.modal', function handler() {\n    el.setAttribute('inert', '');\n    el.removeEventListener('hidden.bs.modal', handler);\n    if (typeof onHidden === 'function') onHidden();\n  });\n  // Remove inert when showing\n  el.addEventListener('show.bs.modal', function handlerShow() {\n    el.removeAttribute('inert');\n    el.removeEventListener('show.bs.modal', handlerShow);\n  });\n  inst.hide();\n}\n  \nwindow.addEventListener('DOMContentLoaded', () => {\n  initTheme();\n  initTooltips();\n  initPalette();\n  initDensity();\n  rememberActiveTab();\n\n  // Tag datalist\n  const list = document.getElementById('all-tags');\n  if (list) { list.innerHTML = Store.getAllTags().map(t=>`<option value=\"${t}\"></option>`).join(''); }\n  on('docs:changed', () => { if (list) list.innerHTML = Store.getAllTags().map(t=>`<option value=\"${t}\"></option>`).join(''); });\n\n  initDocuments();\n  initBookmarks();\n  initStarred();\n  initComments();\n  initCommunity();\n\n  wireCounts();\n  initFiltersAdmin();\n\n  // Subtle welcome toast on first load\n  if (!sessionStorage.getItem('msaas-welcomed')) {\n    showToast('Welcome to DocHub!', 'primary');\n    sessionStorage.setItem('msaas-welcomed', '1');\n  }\n\n  //Modals issue tweaks\n  document.addEventListener('hide.bs.modal', function (e) {\n    try {\n      const modalEl = e.target;\n      const active = document.activeElement;\n\n      if (!modalEl.hasAttribute('inert')) \n        modalEl.setAttribute('inert', '');\n\n      if (active && modalEl.contains(active)) {\n        active.blur();\n        \n        // Move focus to body (ensure focusable)\n        if (!document.body.hasAttribute('tabindex')) document.body.setAttribute('tabindex', '-1');\n        document.body.focus({ preventScroll: true });\n      }\n    } catch (_) {}\n  });\n  document.addEventListener('show.bs.modal', function (e) {\n    try {\n      const el = e.target;\n      if (!el) return;\n\n      // Ensure correct ARIA before showing\n      el.removeAttribute('aria-hidden');\n      el.removeAttribute('inert');\n      el.setAttribute('aria-modal', 'true');\n    } catch (_) {}\n  });\n});\n\ninitBackupUI();\n\ninitTagsAdmin();\n\ninitShortcuts();\n\ninitBulkActions();\n\ninitQuickAdd();\n\ninitSafeMode();\n\ninitAdminSidebar();\n\n// Expose Auth globally for templates\nwindow.Auth = Auth;\n\ntry { initAdminExtensions(); } catch(e) { console.warn('Admin extensions init failed', e); }\n\n\n\nconst app = document.getElementById('app');\napp.innerHTML = `\n\n  <!-- Navbar -->\n  <nav class=\"navbar navbar-expand-lg bg-body border-bottom sticky-top\">\n    <div class=\"container-fluid\">\n      <a class=\"navbar-brand fw-semibold\" href=\"#\">\n        <i class=\"bi bi-journals me-2\"></i>DocHub\n      </a>\n\n      <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#topNav\"\n        aria-controls=\"topNav\" aria-expanded=\"false\" aria-label=\"Toggle navigation\">\n        <span class=\"navbar-toggler-icon\"></span>\n      </button>\n\n      <div class=\"collapse navbar-collapse\" id=\"topNav\">\n        <form class=\"d-flex ms-auto me-3\" role=\"search\" onsubmit=\"return false;\">\n          <div class=\"input-group\">\n            <span class=\"input-group-text bg-transparent border-end-0\"><i class=\"bi bi-search\"></i></span>\n            <input id=\"searchInput\" class=\"form-control border-start-0\" type=\"search\"\n              placeholder=\"Search documents, tags\" aria-label=\"Search\" />\n          </div>\n        </form>\n\n        <div class=\"d-flex gap-2\">\n          <button class=\"btn btn-primary\" data-bs-toggle=\"modal\" data-bs-target=\"#addDocModal\" id=\"addDocButton\">\n            <i class=\"bi bi-plus-lg me-1\"></i>New Document\n          </button>\n          <button id=\"btnPalette\" class=\"btn btn-outline-secondary\" type=\"button\" title=\"Cycle brand palette\"\n            data-bs-toggle=\"tooltip\">\n            <i class=\"bi bi-palette2\"></i>\n          </button>\n          <button id=\"btnDensity\" class=\"btn btn-outline-secondary\" type=\"button\" title=\"Toggle density\"\n            data-bs-toggle=\"tooltip\">\n            <i class=\"bi bi-arrows-expand\"></i>\n          </button>\n          <button id=\"btnTheme\" class=\"btn btn-outline-secondary\" type=\"button\" title=\"Toggle theme\"\n            data-bs-toggle=\"tooltip\">\n            <i class=\"bi bi-sun\"></i>\n          </button>\n        </div>\n      </div>\n    </div>\n  </nav>\n\n  <!-- Tabs -->\n  <div class=\"container-xxl py-3\">\n    <ul class=\"nav nav-tabs\" id=\"hubTabs\" role=\"tablist\">\n      <li class=\"nav-item\" role=\"presentation\">\n        <button class=\"nav-link active\" id=\"tab-all\" data-bs-toggle=\"tab\" data-bs-target=\"#view-all\" type=\"button\"\n          role=\"tab\" aria-controls=\"view-all\" aria-selected=\"true\">\n          <i class=\"bi bi-collection me-1\"></i>All\n          <span class=\"badge text-bg-secondary align-middle ms-1\" id=\"count-all\">0</span>\n        </button>\n      </li>\n      <li class=\"nav-item\" role=\"presentation\">\n        <button class=\"nav-link\" id=\"tab-bookmarks\" data-bs-toggle=\"tab\" data-bs-target=\"#view-bookmarks\" type=\"button\"\n          role=\"tab\" aria-controls=\"view-bookmarks\" aria-selected=\"false\">\n          <i class=\"bi bi-bookmark me-1\"></i>Bookmarks\n          <span class=\"badge text-bg-secondary align-middle ms-1\" id=\"count-bookmarks\">0</span>\n        </button>\n      </li>\n      <li class=\"nav-item\" role=\"presentation\">\n        <button class=\"nav-link\" id=\"tab-starred\" data-bs-toggle=\"tab\" data-bs-target=\"#view-starred\" type=\"button\"\n          role=\"tab\" aria-controls=\"view-starred\" aria-selected=\"false\">\n          <i class=\"bi bi-star me-1\"></i>Starred\n          <span class=\"badge text-bg-secondary align-middle ms-1\" id=\"count-starred\">0</span>\n        </button>\n      </li>\n      <li class=\"nav-item\" role=\"presentation\">\n        <button class=\"nav-link\" id=\"tab-feed\" data-bs-toggle=\"tab\" data-bs-target=\"#view-feed\" type=\"button\" role=\"tab\"\n          aria-controls=\"view-feed\" aria-selected=\"false\">\n          <i class=\"bi bi-activity me-1\"></i>Community\n        </button>\n      </li>\n    </ul>\n\n    <div id=\"filtersBar\" class=\"pt-2 d-none\">\n      <div class=\"d-flex flex-wrap align-items-center gap-2\" id=\"active-tags\"></div>\n      <div class=\"d-flex align-items-center flex-wrap gap-2 mt-2\">\n        <button id=\"btnSaveFilter\" type=\"button\" class=\"btn btn-sm btn-outline-primary\">\n          <i class=\"bi bi-bookmark-plus\"></i> Save as Smart Filter\n        </button>\n        <div class=\"ms-auto d-flex flex-wrap gap-2\">\n          <button id=\"btnQuickImport\" type=\"button\" class=\"btn btn-sm btn-outline-secondary\"\n            title=\"Import starter filters\">\n            <i class=\"bi bi-lightning-charge\"></i> Quick Import\n          </button>\n          <!-- Safe Mode toggle -->\n          <span id=\"safeBadge\" class=\"badge rounded-pill text-bg-warning d-none align-self-center me-2\">SAFE</span>\n          <!-- Admin toggle button (stays on top bar) -->\n          <button id=\"btnAdminPanel\" type=\"button\" class=\"btn btn-sm btn-outline-secondary\"\n            title=\"Open Administrator panel\">\n            <i class=\"bi bi-sliders\"></i> Admin\n          </button>\n          <button id=\"btnSafeMode\" type=\"button\" class=\"btn btn-sm btn-outline-secondary\"\n            title=\"Toggle Safe / Demo mode\">\n            <i class=\"bi bi-shield-lock\"></i> <span class=\"label\">Safe OFF</span>\n          </button>\n          <button id=\"btnManageFilters\" type=\"button\" class=\"btn btn-sm btn-outline-secondary\"\n            title=\"Manage saved filters\">\n            <i class=\"bi bi-sliders\"></i> Manage\n          </button>\n          <!-- Backup/Restore buttons -->\n          <button id=\"btnBackupExport\" type=\"button\" class=\"btn btn-sm btn-outline-secondary\"\n            title=\"Download full backup\">\n            <i class=\"bi bi-save\"></i> Backup\n          </button>\n          <button id=\"btnBackupImport\" type=\"button\" class=\"btn btn-sm btn-outline-secondary\"\n            title=\"Restore from backup\">\n            <i class=\"bi bi-upload\"></i> Restore\n          </button>\n          <button id=\"btnManageTags\" type=\"button\" class=\"btn btn-sm btn-outline-secondary\" title=\"Manage tags\">\n            <i class=\"bi bi-hash\"></i> Tags\n          </button>\n\n          <button id=\"btnBulkSelect\" type=\"button\" class=\"btn btn-sm btn-outline-secondary\" title=\"Select multiple\">\n            <i class=\"bi bi-check2-square\"></i> Select\n          </button>\n        </div>\n        <div id=\"saved-filters\" class=\"d-flex flex-wrap gap-2 w-100\"></div>\n      </div>\n      <div class=\"d-flex flex-wrap align-items-center gap-2\" id=\"active-tags\"></div>\n    </div>\n\n    <div class=\"tab-content pt-4\">\n      <div class=\"tab-pane fade show active\" id=\"view-all\" role=\"tabpanel\" aria-labelledby=\"tab-all\">\n        <div id=\"grid-all\" class=\"row g-3\"></div>\n      </div>\n      <div class=\"tab-pane fade\" id=\"view-bookmarks\" role=\"tabpanel\" aria-labelledby=\"tab-bookmarks\">\n        <div id=\"grid-bookmarks\" class=\"row g-3\"></div>\n      </div>\n      <div class=\"tab-pane fade\" id=\"view-starred\" role=\"tabpanel\" aria-labelledby=\"tab-starred\">\n        <div id=\"grid-starred\" class=\"row g-3\"></div>\n      </div>\n      <div class=\"tab-pane fade\" id=\"view-feed\" role=\"tabpanel\" aria-labelledby=\"tab-feed\">\n        <div id=\"list-feed\" class=\"vstack gap-3\"></div>\n      </div>\n    </div>\n  </div>\n\n  <!-- Comments Offcanvas -->\n  <div class=\"offcanvas offcanvas-end\" tabindex=\"-1\" id=\"commentsPanel\" aria-labelledby=\"commentsPanelLabel\">\n    <div class=\"offcanvas-header\">\n      <h5 class=\"offcanvas-title\" id=\"commentsPanelLabel\"><i class=\"bi bi-chat-dots me-2\"></i>Comments</h5>\n      <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"offcanvas\" aria-label=\"Close\"></button>\n    </div>\n    <div class=\"offcanvas-body d-flex flex-column\">\n      <div id=\"thread-meta\" class=\"small text-body-secondary mb-2\"></div>\n      <div id=\"thread\" class=\"flex-grow-1 overflow-auto pe-1\"></div>\n      <form id=\"commentForm\" class=\"mt-3\" autocomplete=\"off\">\n        <div class=\"input-group\">\n          <input id=\"commentInput\" type=\"text\" class=\"form-control\" placeholder=\"Write a comment\" />\n          <button class=\"btn btn-primary\" type=\"submit\"><i class=\"bi bi-send\"></i></button>\n        </div>\n      </form>\n    </div>\n  </div>\n\n  <!-- Add Document Modal -->\n  <div class=\"modal fade\" id=\"addDocModal\" tabindex=\"-1\" aria-hidden=\"true\">\n    <div class=\"modal-dialog modal-dialog-centered\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <h5 class=\"modal-title\"><i class=\"bi bi-file-earmark-plus me-2\"></i>Add Document</h5>\n          <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\n        </div>\n        <form id=\"addDocForm\" autocomplete=\"off\">\n          <div class=\"modal-body\">\n            <div class=\"mb-3\">\n              <label class=\"form-label\">Title</label>\n              <input name=\"title\" class=\"form-control\" required />\n            </div>\n            <div class=\"mb-3\">\n              <label class=\"form-label\">Description</label>\n              <textarea name=\"description\" class=\"form-control\" rows=\"3\" placeholder=\"What is this document about?\"\n                required></textarea>\n            </div>\n            <div class=\"mb-3\">\n              <label class=\"form-label\">Tags (comma separated)</label>\n              <input name=\"tags\" class=\"form-control\" placeholder=\"e.g. product, roadmap\" list=\"all-tags\" />\n            </div>\n            <div class=\"mb-2\">\n              <label class=\"form-label\">Link (optional)</label>\n              <input name=\"url\" type=\"url\" class=\"form-control\" placeholder=\"https://\" />\n            </div>\n\n            <div class=\"row g-2 align-items-end mt-2\">\n              <div class=\"col-sm-4\">\n                <label class=\"form-label form-label-sm mb-1\">Owner</label>\n                <input type=\"text\" class=\"form-control form-control-sm\" name=\"owner\" placeholder=\"Owner name\">\n              </div>\n              <div class=\"col-sm-4\">\n                <label class=\"form-label form-label-sm mb-1\">Status</label>\n                <select class=\"form-select form-select-sm\" name=\"status\">\n                  <option value=\"\"></option>\n                  <option>Draft</option>\n                  <option>In Review</option>\n                  <option>Published</option>\n                  <option>Archived</option>\n                </select>\n              </div>\n              <div class=\"col-sm-2\">\n                <label class=\"form-label form-label-sm mb-1\">Icon</label>\n                <input type=\"text\" class=\"form-control form-control-sm\" name=\"icon\" placeholder=\"\">\n              </div>\n              <div class=\"col-sm-2\">\n                <label class=\"form-label form-label-sm mb-1\">Color</label>\n                <input type=\"color\" class=\"form-control form-control-color form-control-sm\" name=\"color\" value=\"#2563eb\"\n                  title=\"Pick a color\">\n              </div>\n            </div>\n          </div>\n          <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn btn-outline-secondary\" data-bs-dismiss=\"modal\">Cancel</button>\n            <button type=\"submit\" class=\"btn btn-primary\">Add</button>\n          </div>\n        </form>\n      </div>\n    </div>\n  </div>\n\n  <!-- Edit Document Modal -->\n  <div class=\"modal fade\" id=\"editDocModal\" tabindex=\"-1\" aria-hidden=\"true\">\n    <div class=\"modal-dialog modal-dialog-centered\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <h5 class=\"modal-title\"><i class=\"bi bi-file-earmark-plus me-2\"></i>Edit Document</h5>\n          <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\n        </div>\n        <form id=\"editDocForm\" autocomplete=\"off\">\n          <div class=\"modal-body\">\n            <div class=\"mb-3\">\n              <label class=\"form-label\">Title</label>\n              <input name=\"title\" class=\"form-control\" required />\n            </div>\n            <div class=\"mb-3\">\n              <label class=\"form-label\">Description</label>\n              <textarea name=\"description\" class=\"form-control\" rows=\"3\" placeholder=\"What is this document about?\"\n                required></textarea>\n            </div>\n            <div class=\"mb-3\">\n              <label class=\"form-label\">Tags (comma separated)</label>\n              <input name=\"tags\" class=\"form-control\" placeholder=\"e.g. product, roadmap\" list=\"all-tags\" />\n            </div>\n            <div class=\"mb-2\">\n              <label class=\"form-label\">Link (optional)</label>\n              <input name=\"url\" type=\"url\" class=\"form-control\" placeholder=\"https://\" />\n            </div>\n\n            <div class=\"row g-2 align-items-end mt-2\">\n              <div class=\"col-sm-4\">\n                <label class=\"form-label form-label-sm mb-1\">Owner</label>\n                <input type=\"text\" class=\"form-control form-control-sm\" name=\"owner\" placeholder=\"Owner name\">\n              </div>\n              <div class=\"col-sm-4\">\n                <label class=\"form-label form-label-sm mb-1\">Status</label>\n                <select class=\"form-select form-select-sm\" name=\"status\">\n                  <option value=\"\"></option>\n                  <option>Draft</option>\n                  <option>In Review</option>\n                  <option>Published</option>\n                  <option>Archived</option>\n                </select>\n              </div>\n              <div class=\"col-sm-2\">\n                <label class=\"form-label form-label-sm mb-1\">Icon</label>\n                <input type=\"text\" class=\"form-control form-control-sm\" name=\"icon\" placeholder=\"\">\n              </div>\n              <div class=\"col-sm-2\">\n                <label class=\"form-label form-label-sm mb-1\">Color</label>\n                <input type=\"color\" class=\"form-control form-control-color form-control-sm\" name=\"color\" value=\"#2563eb\"\n                  title=\"Pick a color\">\n              </div>\n            </div>            \n          </div>\n          <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn btn-outline-secondary\" data-bs-dismiss=\"modal\">Cancel</button>\n            <button type=\"submit\" class=\"btn btn-primary\">Save</button>\n          </div>\n        </form>\n      </div>\n    </div>\n  </div>\n\n  <!-- Save Smart Filter Modal -->\n  <div class=\"modal fade\" id=\"saveFilterModal\" tabindex=\"-1\" aria-hidden=\"true\">\n    <div class=\"modal-dialog modal-dialog-centered modal-sm\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <h5 class=\"modal-title\"><i class=\"bi bi-bookmark-plus me-2\"></i>Save Smart Filter</h5>\n          <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\n        </div>\n        <form id=\"saveFilterForm\" autocomplete=\"off\">\n          <div class=\"modal-body\">\n            <label class=\"form-label\">Filter name</label>\n            <input id=\"saveFilterName\" class=\"form-control\" placeholder=\"e.g. Strategy docs\" required />\n            <div class=\"form-text\">Saves current text search and selected tags.</div>\n          </div>\n          <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn btn-outline-secondary\" data-bs-dismiss=\"modal\">Cancel</button>\n            <button type=\"submit\" class=\"btn btn-primary\">Save</button>\n          </div>\n        </form>\n      </div>\n    </div>\n  </div>\n\n  <!-- Import Filters Modal -->\n  <div class=\"modal fade\" id=\"importFiltersModal\" tabindex=\"-1\" aria-hidden=\"true\">\n    <div class=\"modal-dialog modal-dialog-centered\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <h5 class=\"modal-title\"><i class=\"bi bi-upload me-2\"></i>Import Filters JSON</h5>\n          <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\n        </div>\n        <form id=\"importFiltersForm\" autocomplete=\"off\">\n          <div class=\"modal-body\">\n            <textarea id=\"importFiltersJson\" class=\"form-control\" rows=\"8\"\n              placeholder='[{\"name\":\"Onboarding\",\"tags\":[\"onboarding\"]}]' required></textarea>\n            <div class=\"form-text\">Paste an array of filters with <code>name</code>, optional <code>query</code>, and\n              <code>tags</code>.</div>\n          </div>\n          <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn btn-outline-secondary\" data-bs-dismiss=\"modal\">Cancel</button>\n            <button type=\"submit\" class=\"btn btn-primary\">Import</button>\n          </div>\n        </form>\n      </div>\n    </div>\n  </div>\n\n  <!-- Manage Filters Modal -->\n  <div class=\"modal fade\" id=\"manageFiltersModal\" tabindex=\"-1\" aria-hidden=\"true\">\n    <div class=\"modal-dialog modal-dialog-centered modal-lg\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <h5 class=\"modal-title\"><i class=\"bi bi-sliders me-2\"></i>Manage Filters</h5>\n          <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\n        </div>\n\n        <div class=\"modal-body\">\n          <div class=\"d-flex align-items-center justify-content-between mb-2\">\n            <div class=\"form-check\">\n              <input class=\"form-check-input\" type=\"checkbox\" id=\"mf-select-all\">\n              <label class=\"form-check-label\" for=\"mf-select-all\">Select all</label>\n            </div>\n            <div class=\"small text-body-secondary\">Drag rows by the handle to reorder</div>\n          </div>\n\n          <ul id=\"mf-list\" class=\"list-group list-group-flush border rounded\">\n            <!-- rows injected by JS -->\n          </ul>\n        </div>\n\n        <div class=\"modal-footer\">\n          <button id=\"mf-delete\" type=\"button\" class=\"btn btn-outline-danger\">\n            <i class=\"bi bi-trash\"></i> Delete selected\n          </button>\n          <button id=\"mf-save\" type=\"button\" class=\"btn btn-primary\">\n            <i class=\"bi bi-check2\"></i> Save changes\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <!-- Shared datalist for tag autocomplete -->\n  <datalist id=\"all-tags\"></datalist>\n\n  <!-- Toasts -->\n  <div id=\"toast-holder\" class=\"toast-container position-fixed top-0 end-0 p-3\"></div>\n\n\n  <!-- Restore Backup Modal -->\n  <div class=\"modal fade\" id=\"importBackupModal\" tabindex=\"-1\" aria-hidden=\"true\">\n    <div class=\"modal-dialog modal-dialog-centered\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <h5 class=\"modal-title\"><i class=\"bi bi-upload me-2\"></i>Restore from Backup</h5>\n          <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\n        </div>\n        <form id=\"importBackupForm\" autocomplete=\"off\">\n          <div class=\"modal-body\">\n            <div class=\"mb-2\">\n              <label class=\"form-label\">Upload backup .json (optional)</label>\n              <input id=\"importBackupFile\" type=\"file\" accept=\"application/json,application/*+json,.json\"\n                class=\"form-control\" />\n              <div class=\"form-text\">Choose a file OR paste JSON below.</div>\n            </div>\n            <div class=\"mb-2\">\n              <label class=\"form-label\">Or paste JSON</label>\n              <textarea id=\"importBackupJson\" class=\"form-control\" rows=\"8\"\n                placeholder='{\"docs\":[...],\"comments\":{},\"activities\":[],\"savedFilters\":[...]}'></textarea>\n            </div>\n            <div class=\"form-check\">\n              <input class=\"form-check-input\" type=\"checkbox\" id=\"importBackupOverwrite\" checked>\n              <label class=\"form-check-label\" for=\"importBackupOverwrite\">Overwrite existing data (recommended)</label>\n            </div>\n            <div class=\"small text-body-secondary mt-2\">Import will reload the page.</div>\n          </div>\n          <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn btn-outline-secondary\" data-bs-dismiss=\"modal\">Cancel</button>\n            <button type=\"submit\" class=\"btn btn-primary\">Import</button>\n          </div>\n        </form>\n      </div>\n    </div>\n  </div>\n\n  <!-- Manage Tags Modal -->\n  <div class=\"modal fade\" id=\"manageTagsModal\" tabindex=\"-1\" aria-hidden=\"true\">\n    <div class=\"modal-dialog modal-dialog-centered modal-lg\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <h5 class=\"modal-title\"><i class=\"bi bi-hash me-2\"></i>Manage Tags</h5>\n          <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\n        </div>\n        <div class=\"modal-body\">\n          <div class=\"row g-2 mb-2\">\n            <div class=\"col-md-6\">\n              <input id=\"tags-search\" class=\"form-control\" placeholder=\"Search tags\" />\n            </div>\n            <div class=\"col-md-6 d-flex gap-2\">\n              <input id=\"tags-target\" class=\"form-control\" placeholder=\"Target name (for Rename/Merge)\" />\n              <button id=\"tags-rename\" type=\"button\" class=\"btn btn-outline-primary\">Rename</button>\n              <button id=\"tags-merge\" type=\"button\" class=\"btn btn-outline-primary\">Merge</button>\n              <button id=\"tags-delete\" type=\"button\" class=\"btn btn-outline-danger ms-auto\">Delete</button>\n            </div>\n          </div>\n          <div class=\"table-responsive border rounded\">\n            <table class=\"table align-middle mb-0\">\n              <thead class=\"table-light\">\n                <tr>\n                  <th class=\"text-center\" style=\"width:36px\"></th>\n                  <th>Tag</th>\n                  <th class=\"text-end\">Docs</th>\n                  <th class=\"text-end\">Filters</th>\n                  <th class=\"text-end\" style=\"width:40px\"></th>\n                </tr>\n              </thead>\n              <tbody id=\"tags-list\">\n                <tr>\n                  <td colspan=\"5\" class=\"py-4 text-center text-body-secondary\">Loading</td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>\n        <div class=\"modal-footer\">\n          <button type=\"button\" class=\"btn btn-outline-secondary\" data-bs-dismiss=\"modal\">Close</button>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"modal fade\" id=\"shortcutsModal\" tabindex=\"-1\" aria-hidden=\"true\">\n    <div class=\"modal-dialog\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <h5 class=\"modal-title\"><i class=\"bi bi-keyboard me-2\"></i>Keyboard Shortcuts</h5>\n          <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\n        </div>\n        <div class=\"modal-body\">\n          <ul class=\"list-unstyled small mb-0\">\n            <li><kbd>/</kbd> or <kbd>Ctrl</kbd>+<kbd>K</kbd>  Focus search</li>\n            <li><kbd>?</kbd> or <kbd>Cmd</kbd>+<kbd>K</kbd>  Toggle this cheatsheet</li>\n            <li><kbd>S</kbd>  Star / unstar active card</li>\n            <li><kbd>B</kbd>  Bookmark / unbookmark active card</li>\n            <li><kbd>E</kbd>  Edit tags (inline if available, else quick prompt)</li>\n            <li class=\"text-body-secondary mt-2\">Tip: click a card to make it active. The active card is outlined.</li>\n          </ul>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <!-- Bulk actions bar (appears in select mode) -->\n  <div id=\"bulkBar\" class=\"bulkbar d-none fixed-bottom\">\n    <div class=\"container-lg\">\n      <div class=\"d-flex gap-2 align-items-center bg-body border rounded shadow-sm p-2 my-2\">\n        <span class=\"fw-medium\">Selected: <span id=\"bulkCount\">0</span></span>\n        <div class=\"vr mx-1\"></div>\n        <button id=\"bulkStar\" class=\"btn btn-sm btn-outline-primary\" type=\"button\" title=\"Star\"><i\n            class=\"bi bi-star\"></i></button>\n        <button id=\"bulkUnstar\" class=\"btn btn-sm btn-outline-primary\" type=\"button\" title=\"Unstar\"><i\n            class=\"bi bi-star-fill\"></i></button>\n        <button id=\"bulkBookmark\" class=\"btn btn-sm btn-outline-primary\" type=\"button\" title=\"Bookmark\"><i\n            class=\"bi bi-bookmark\"></i></button>\n        <button id=\"bulkUnbookmark\" class=\"btn btn-sm btn-outline-primary\" type=\"button\" title=\"Unbookmark\"><i\n            class=\"bi bi-bookmark-fill\"></i></button>\n        <button id=\"bulkAddTag\" class=\"btn btn-sm btn-outline-secondary\" type=\"button\" title=\"Add tag\">+ Tag</button>\n        <button id=\"bulkRemoveTag\" class=\"btn btn-sm btn-outline-secondary\" type=\"button\" title=\"Remove tag\">\n          Tag</button>\n        <div class=\"ms-auto\"></div>\n        <button id=\"bulkClear\" class=\"btn btn-sm btn-outline-danger\" type=\"button\"\n          title=\"Exit select mode\">Done</button>\n      </div>\n    </div>\n  </div>\n\n  <!-- Offcanvas Admin Panel (right side) -->\n  <div class=\"offcanvas offcanvas-end admin-offcanvas\" tabindex=\"-1\" id=\"adminPanel\" aria-labelledby=\"adminPanelLabel\">\n    <div class=\"offcanvas-header border-bottom\">\n      <h5 class=\"offcanvas-title\" id=\"adminPanelLabel\"><i class=\"bi bi-sliders me-2\"></i>Administrator</h5>\n      <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"offcanvas\" aria-label=\"Close\"></button>\n    </div>\n    <div class=\"offcanvas-body\">\n      <div class=\"input-group input-group-sm mb-3\">\n        <span class=\"input-group-text\"><i class=\"bi bi-search\"></i></span>\n        <input id=\"adminSearch\" class=\"form-control\" placeholder=\"Search tools\" />\n      </div>\n\n      <div class=\"accordion\" id=\"adminAccordion\">\n        <div class=\"accordion-item\">\n          <h2 class=\"accordion-header\">\n            <button class=\"accordion-button collapsed small\" data-bs-toggle=\"collapse\" data-bs-target=\"#sec-safe-wrap\">\n              <i class=\"bi bi-shield-lock me-2\"></i> Safety\n            </button>\n          </h2>\n          <div id=\"sec-safe-wrap\" class=\"accordion-collapse collapse\" data-bs-parent=\"#adminAccordion\">\n            <div id=\"sec-safe\" class=\"accordion-body d-grid gap-2\">\n              <div class=\"input-group input-group-sm\">\n                <span class=\"input-group-text\"><i class=\"bi bi-person-gear\"></i></span>\n                <select id=\"roleSelect\" class=\"form-select form-select-sm\">\n                  <option value=\"admin\">Admin</option>\n                  <option value=\"viewer\">Viewer</option>\n                </select>\n              </div>\n            </div>\n          </div>\n        </div>\n\n\n        <div class=\"accordion-item\">\n          <h2 class=\"accordion-header\" id=\"headingTheme\">\n            <button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\"\n              data-bs-target=\"#collapseTheme\" aria-expanded=\"false\" aria-controls=\"collapseTheme\">\n              <i class=\"bi bi-palette me-2\"></i> Theme\n            </button>\n          </h2>\n          <div id=\"collapseTheme\" class=\"accordion-collapse collapse\" aria-labelledby=\"headingTheme\"\n            data-bs-parent=\"#adminAccordion\">\n            <div id=\"sec-theme\" class=\"accordion-body\">\n              <div class=\"btn-group\" role=\"group\" aria-label=\"Theme\">\n                <input type=\"radio\" class=\"btn-check\" name=\"themeOptions\" id=\"themeAuto\" autocomplete=\"off\"\n                  value=\"auto\">\n                <label class=\"btn btn-outline-secondary btn-sm\" for=\"themeAuto\"><i class=\"bi bi-phone\"></i> Auto</label>\n                <input type=\"radio\" class=\"btn-check\" name=\"themeOptions\" id=\"themeLight\" autocomplete=\"off\"\n                  value=\"light\">\n                <label class=\"btn btn-outline-secondary btn-sm\" for=\"themeLight\"><i class=\"bi bi-brightness-high\"></i>\n                  Light</label>\n                <input type=\"radio\" class=\"btn-check\" name=\"themeOptions\" id=\"themeDark\" autocomplete=\"off\"\n                  value=\"dark\">\n                <label class=\"btn btn-outline-secondary btn-sm\" for=\"themeDark\"><i class=\"bi bi-moon\"></i> Dark</label>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class=\"accordion-item\">\n          <h2 class=\"accordion-header\">\n            <button class=\"accordion-button collapsed small\" data-bs-toggle=\"collapse\"\n              data-bs-target=\"#sec-filters-wrap\">\n              <i class=\"bi bi-funnel me-2\"></i> Filters\n            </button>\n          </h2>\n          <div id=\"sec-filters-wrap\" class=\"accordion-collapse collapse\" data-bs-parent=\"#adminAccordion\">\n            <div id=\"sec-filters\" class=\"accordion-body d-grid gap-2\"></div>\n            <div class=\"small text-body-secondary border-top pt-2 mt-2\">\n              <div class=\"d-flex align-items-center gap-3 flex-wrap\">\n                <span><i class=\"bi bi-circle-fill me-1\" style=\"color:#6c757d;font-size:.6rem\"></i> Draft</span>\n                <span><i class=\"bi bi-circle-fill me-1\" style=\"color:#f59e0b;font-size:.6rem\"></i> In Review</span>\n                <span><i class=\"bi bi-circle-fill me-1\" style=\"color:#16a34a;font-size:.6rem\"></i> Published</span>\n                <span><i class=\"bi bi-circle-fill me-1\" style=\"color:#64748b;font-size:.6rem\"></i> Archived</span>\n              </div>\n            </div>\n\n          </div>\n        </div>\n\n        <div class=\"accordion-item\">\n          <h2 class=\"accordion-header\">\n            <button class=\"accordion-button collapsed small\" data-bs-toggle=\"collapse\" data-bs-target=\"#sec-tags-wrap\">\n              <i class=\"bi bi-hash me-2\"></i> Tags &amp; Bulk\n            </button>\n          </h2>\n          <div id=\"sec-tags-wrap\" class=\"accordion-collapse collapse\" data-bs-parent=\"#adminAccordion\">\n            <div id=\"sec-tags\" class=\"accordion-body d-grid gap-2\">\n            </div>\n          </div>\n        </div>\n\n        <div class=\"accordion-item\">\n          <h2 class=\"accordion-header\">\n            <button class=\"accordion-button collapsed small\" data-bs-toggle=\"collapse\" data-bs-target=\"#sec-data-wrap\">\n              <i class=\"bi bi-hdd-network me-2\"></i> Data\n            </button>\n          </h2>\n          <div id=\"sec-data-wrap\" class=\"accordion-collapse collapse\" data-bs-parent=\"#adminAccordion\">\n            <div id=\"sec-data\" class=\"accordion-body d-grid gap-2\"></div>\n          </div>\n        </div>\n\n        <div class=\"accordion-item\">\n          <h2 class=\"accordion-header\">\n            <button class=\"accordion-button collapsed small\" data-bs-toggle=\"collapse\" data-bs-target=\"#sec-utils-wrap\">\n              <i class=\"bi bi-tools me-2\"></i> Utilities\n            </button>\n          </h2>\n          <div id=\"sec-utils-wrap\" class=\"accordion-collapse collapse\" data-bs-parent=\"#adminAccordion\">\n            <div id=\"sec-utils\" class=\"accordion-body d-grid gap-2\"></div>\n          </div>\n        </div>\n\n      </div>\n    </div>\n  </div>\n\n`;\n","\n// assets/js/modules/quick-add.js\n// Compact \"Add doc\" form (title + tags) that calls Store.addDoc and optionally Store.updateTags.\n// Safe: tries multiple call signatures and falls back gracefully.\n\nimport { Store } from '../core/store.js';\nimport { showToast } from '../ui/components.js';\n\nfunction parseTags(raw='') {\n  return String(raw)\n    .split(',')\n    .map(s => s.trim())\n    .filter(Boolean);\n}\n\nfunction createDocViaStore(title, tags) {\n  const t = String(title || '').trim();\n  if (!t) return null;\n\n  let newId = null;\n  const tryFns = [\n    () => Store.addDoc?.({ title: t, tags }),       // common: object payload\n    () => Store.addDoc?.(t, { tags }),              // fallback: (title, opts)\n    () => Store.addDoc?.(t)                         // fallback: (title)\n  ];\n\n  for (const f of tryFns) {\n    try {\n      const r = f();\n      if (r !== undefined && r !== null) { newId = r; break; }\n    } catch (e) { /* ignore and try next */ }\n  }\n\n  // If Store.addDoc returns nothing, try to locate by title (latest)\n  if (!newId && Store.all) {\n    const all = Store.all() || [];\n    for (let i = all.length - 1; i >= 0; i--) {\n      if (all[i]?.title === t) { newId = all[i].id; break; }\n    }\n  }\n\n  // Apply tags if we have an id and tags provided\n  if (newId && tags?.length && Store.updateTags) {\n    try {\n      const d = Store.byId?.(newId);\n      const before = d?.tags || [];\n      const next = Array.from(new Set([ ...before, ...tags ]));\n      if (next.length !== before.length) Store.updateTags(newId, next);\n    } catch (e) { /* non-fatal */ }\n  }\n\n  return newId;\n}\n\nexport function initQuickAdd() {\n  const form = document.getElementById('qaForm');\n  const inputTitle = document.getElementById('qaTitle');\n  const inputTags  = document.getElementById('qaTags');\n  const btnClear   = document.getElementById('qaClear');\n\n  if (!form || !inputTitle || !inputTags) return;\n\n  // Submit creates the doc\n  form.addEventListener('submit', (e) => {\n    e.preventDefault();\n    const title = inputTitle.value.trim();\n    const tags = parseTags(inputTags.value);\n    if (!title) {\n      showToast('Please enter a title', 'warning');\n      inputTitle.focus();\n      return;\n    }\n    const id = createDocViaStore(title, tags);\n    if (id) {\n      showToast('Document added', 'primary');\n      inputTitle.value = '';\n      inputTags.value = '';\n      inputTitle.focus();\n    } else {\n      showToast('Could not add the document (check Store.addDoc)', 'danger');\n    }\n  });\n\n  // Clear button\n  btnClear?.addEventListener('click', () => {\n    inputTitle.value = '';\n    inputTags.value = '';\n    inputTitle.focus();\n  });\n}\n","// assets/js/modules/admin-sidebar.js\nexport function initAdminSidebar() {\n  function doAdminSidebarInit() {\n    const toggleBtn = document.getElementById('btnAdminPanel');\n    const panelEl = document.getElementById('adminPanel');\n    if (!toggleBtn || !panelEl) return;\n    document.querySelectorAll('#adminAccordion').forEach(el => {\n      if (!panelEl.contains(el)) el.remove();\n    });\n    document.querySelectorAll('.accordion-item').forEach(item => {\n      const ids = ['sec-create-wrap', 'sec-safe-wrap', 'sec-filters-wrap', 'sec-tags-wrap', 'sec-data-wrap', 'sec-utils-wrap'];\n      const hasAdminSection = ids.some(id => item.querySelector('#' + id));\n      if (hasAdminSection && !panelEl.contains(item)) item.remove();\n    });\n    const offcanvas = window.bootstrap?.Offcanvas ? (window.bootstrap.Offcanvas.getOrCreateInstance(panelEl)) : null;\n    toggleBtn.addEventListener('click', () => offcanvas && offcanvas.toggle());\n    \n    function reLocateTools() {\n      const move = (id, containerId) => { const el = document.getElementById(id); const slot = document.getElementById(containerId); if (el && slot) { el.classList.remove('btn-sm'); el.classList.add('btn', 'btn-outline-secondary', 'w-100'); mark(el); slot.appendChild(el); } };\n      const moveInline = (id, containerId) => { const el = document.getElementById(id); const slot = document.getElementById(containerId); if (el && slot) { mark(el); slot.appendChild(el); } };\n      moveInline('safeBadge', 'sec-safe'); move('btnSafeMode', 'sec-safe');\n      moveInline('qaForm', 'sec-create');\n      move('btnQuickImport', 'sec-filters'); move('btnImportFilters', 'sec-filters'); move('btnExportFilters', 'sec-filters'); move('btnManageFilters', 'sec-filters');\n      move('btnManageTags', 'sec-tags'); move('btnBulkSelect', 'sec-tags');\n      move('btnBackupExport', 'sec-data'); move('btnBackupImport', 'sec-data');\n      move('btnShortcuts', 'sec-utils');\n    }\n    \n    const mark = (el) => { el?.classList?.add('admin-tool'); if (!el.dataset.adminLabel) el.dataset.adminLabel = (el.innerText || '').trim().toLowerCase(); };\n    const move = (id, containerId) => { const el = document.getElementById(id); const slot = document.getElementById(containerId); if (el && slot) { el.classList.remove('btn-sm'); el.classList.add('btn', 'btn-outline-secondary', 'w-100'); mark(el); slot.appendChild(el); } };\n    const moveInline = (id, containerId) => { const el = document.getElementById(id); const slot = document.getElementById(containerId); if (el && slot) { mark(el); slot.appendChild(el); } };\n    reLocateTools();\n    const search = document.getElementById('adminSearch');\n    function applyFilter(q) { const query = (q || '').trim().toLowerCase(); const secs = panelEl.querySelectorAll('.accordion-item'); secs.forEach(item => { const body = item.querySelector('.accordion-body'); const tools = body ? body.querySelectorAll('.admin-tool, form.quick-add') : []; let vis = 0; tools.forEach(el => { const label = el.dataset.adminLabel || (el.innerText || '').toLowerCase(); const show = !query || label.includes(query); el.classList.toggle('d-none', !show); if (show) vis++; }); item.classList.toggle('d-none', vis === 0); }); }\n    search?.addEventListener('input', () => applyFilter(search.value));\n    panelEl.addEventListener('shown.bs.offcanvas', () => { if (search) { search.value = ''; applyFilter(''); search.focus(); } reLocateTools(); });\n  }\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', doAdminSidebarInit, { once: true });\n  } else {\n    doAdminSidebarInit();\n  }\n}\n","// assets/js/modules/admin-extensions.js\nimport { showToast } from '../ui/components.js';\nimport { Auth } from '../core/auth.js';\n\nfunction findSelectedIds() {\n  // support multiple possible markers\n  const set = new Set();\n  document.querySelectorAll('[data-selected=\"1\"],[data-selected=\"true\"],.selected,.is-selected').forEach(el=>{\n    const id = el.getAttribute('data-id') || el.getAttribute('data-doc-id');\n    if (id) set.add(id);\n  });\n  // fallback: Bulk module might maintain a list on window\n  if (window.Bulk && Array.isArray(window.Bulk.getSelected?.())) {\n    window.Bulk.getSelected().forEach(id => set.add(id));\n  }\n  return Array.from(set);\n}\n\n\n\nexport function initAdminExtensions(){\n  const THEME_KEY = 'msaas-theme';\n  window.Theme = window.Theme || {};\n\n  function applyTheme(val){\n    const root = document.documentElement;\n    root.classList.remove('theme-dark','theme-light');\n    if (val === 'dark')  root.classList.add('theme-dark');\n    if (val === 'light') root.classList.add('theme-light');\n  }\n\n  function updateThemeUI(mode){\n    const cs  = getComputedStyle(document.documentElement);\n    const map = {\n      auto:  (cs.getPropertyValue('--indicator-auto')  || '').trim() || '#16a34a',\n      light: (cs.getPropertyValue('--indicator-light') || '').trim() || '#f59e0b',\n      dark:  (cs.getPropertyValue('--indicator-dark')  || '').trim() || '#3b82f6'\n    };\n    ['btnThemeQuick','btnPalette'].forEach(id => {\n      const b = document.getElementById(id); if (!b) return;\n      b.title = `Theme: ${mode} (click to cycle)`;\n      let dot = b.querySelector('.theme-indicator');\n      if (!dot) { dot = document.createElement('span'); dot.className = 'theme-indicator'; b.appendChild(dot); }\n      dot.style.background = map[mode] || map.auto;\n    });\n  }\n\n  window.Theme.get   = () => localStorage.getItem(THEME_KEY) || 'auto';\n  window.Theme.set   = (v) => { localStorage.setItem(THEME_KEY, v); applyTheme(v); updateThemeUI(v); };\n  window.Theme.cycle = () => {\n    const order = ['auto','light','dark'];\n    const cur = window.Theme.get();\n    const next = order[(order.indexOf(cur)+1) % order.length];\n    window.Theme.set(next);\n    try { if (window.showToast) showToast('Theme: ' + next, 'secondary'); } catch(e){}\n  };\n\n  const savedTheme = window.Theme.get();\n  applyTheme(savedTheme);\n  updateThemeUI(savedTheme);\n\n  const btnQuick   = document.getElementById('btnThemeQuick');\n  if (btnQuick)   btnQuick.addEventListener('click', () => window.Theme.cycle());\n  const btnPalette = document.getElementById('btnPalette');\n  if (btnPalette) btnPalette.addEventListener('click', () => window.Theme.cycle());\n\n  const rbAuto  = document.getElementById('themeAuto');\n  const rbLight = document.getElementById('themeLight');\n  const rbDark  = document.getElementById('themeDark');\n  if (rbAuto && rbLight && rbDark) {\n    ({auto:rbAuto, light:rbLight, dark:rbDark}[savedTheme] || rbAuto).checked = true;\n    [rbAuto, rbLight, rbDark].forEach(rb => rb.addEventListener('change', (e) => {\n      if (e.target.checked) window.Theme.set(e.target.value);\n    }));\n  }\n}\n"],"names":["listeners","Map","on","event","handler","has","set","Set","get","add","delete","off","emit","payload","fn","err","console","error","KEY","SAFE_KEY","now","Date","toISOString","uid","crypto","randomUUID","Math","random","toString","slice","initial","docs","id","title","description","tags","url","createdAt","updatedAt","bookmarked","starred","comments","activities","savedFilters","state","raw","localStorage","getItem","parsed","JSON","parse","load","save","setItem","stringify","activity","type","meta","entry","ts","unshift","Store","all","sort","a","b","byId","find","d","search","query","q","trim","toLowerCase","this","filter","includes","some","t","getAllTags","s","Array","from","localeCompare","addDoc","doc","toggleBookmark","toggleStar","updateTags","updateTitle","String","updateDoc","patch","undefined","isArray","owner","status","icon","color","remove","x","commentsFor","addComment","text","author","msg","push","docId","counts","length","bookmarks","addFilter","name","f","removeFilter","exportFilters","map","importFilters","filters","overwriteByName","arr","added","Boolean","quickImportStarters","renameFilter","newName","reorderFilters","orderIds","next","removeFilters","ids","renameTag","oldName","to","changed","forEach","before","touched","seen","repl","deleteTag","tagName","mergeTags","sourceNames","targetName","target","total","isSafeMode","setSafeMode","removeItem","escapeHtml","replace","c","tagBadges","join","statusCls","timeAgo","iso","floor","r","n","u","m","h","dd","mo","docCard","urlBtn","window","Auth","canEdit","docCard2","showToast","message","variant","holder","document","getElementById","el","createElement","className","role","ariaLive","ariaAtomic","innerHTML","appendChild","bootstrap","Toast","delay","show","addEventListener","updateCounts","textContent","gridAll","searchInput","activeTagsEl","filtersBarEl","savedFiltersEl","btnSaveFilter","addDocButton","btnQuickImport","selectedTags","render","list","final","textFiltered","size","statusTokens","startsWith","tl","ds","applyFilters","value","classList","chips","statusIcon","prettyChipLabel","clear","renderSavedFilters","renderActiveFilters","replaceAll","token","v","charAt","toUpperCase","dot","hex","items","toggleEditor","card","ed","querySelector","toggle","focus","handleGridClicks","e","btn","closest","wrap","dataset","action","niceConfirm","okText","cancelText","then","ok","deleteDoc","confirmed","del","tok","tag","open","contains","querySelectorAll","input","split","safeSet","form","val","mode","modalEl","titleEl","submitBtn","handlerShow","removeAttribute","removeEventListener","Modal","getInstance","openEditDoc","handleFiltersBarClick","rm","clr","applySaved","removeSaved","chip","handleAddDocModal","setAttribute","inst","backdrop","keyboard","openModalById","initDocuments","preventDefault","fd","FormData","reset","hide","wireAddDocForm","wireEditDocForm","modal","grid","offcanvas","threadEl","metaEl","inputEl","formEl","currentDocId","listEl","hMsg","mine","renderThread","msgs","scrollTop","scrollHeight","onSubmit","initComments","Offcanvas","openFor","ICON","item","i","who","feed","ROLE_KEY","getRole","setRole","isAdmin","selectAllEl","btnSave","btnDelete","btnOpen","rowTpl","saveChanges","inputs","inp","validateNames","rows","li","bulkDelete","confirm","initFiltersAdmin","checked","draggingEl","dataTransfer","effectAllowed","over","rect","getBoundingClientRect","clientY","top","height","insertBefore","nextSibling","initDrag","readState","modalRoot","searchEl","btnRename","btnMerge","targetInput","ch","bump","key","uniq","entries","getTagStats","requireSelection","min","exact","sel","cb","doRename","wireModal","tr","prompt","names","doMerge","doDelete","activeId","lastActiveEl","setActiveCard","getAttribute","getActiveId","handleKeydown","isContentEditable","isTypingInField","shiftKey","ctrlKey","select","focusSearch","metaKey","toggleCheatsheet","altKey","click","current","editTagsQuick","selected","bar","countEl","btnSelect","btnClear","btnStar","btnUnstar","btnBm","btnUnbm","btnAddTag","btnRemoveTag","setSelectedVisual","refreshCount","toggleMode","body","ensureSomethingSelected","bulkStar","shouldStar","want","bulkBookmark","shouldBm","promptTag","bulkAddTag","bulkRemoveTag","isSafe","updateButton","badge","html","documentElement","apply","stored","initTheme","Tooltip","palettes","label","p","idx","indexOf","setContent","initPalette","initDensity","saved","trigger","Tab","rememberActiveTab","sessionStorage","active","activeElement","hasAttribute","blur","preventScroll","_","btnExport","btnImport","fileEl","textEl","overwriteEl","pretty","filename","blob","Blob","URL","createObjectURL","href","download","revokeObjectURL","pad","padStart","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","async","files","file","txt","loadFileToTextarea","obj","errors","cond","valid","validateState","cur","merged","setTimeout","location","reload","initBackupUI","first","initShortcuts","getId","stopPropagation","toggleSelFromEvent","inputTitle","inputTags","parseTags","newId","tryFns","createDocViaStore","initQuickAdd","evt","CustomEvent","detail","dispatchEvent","setSafe","initSafeMode","doAdminSidebarInit","toggleBtn","panelEl","getOrCreateInstance","reLocateTools","move","containerId","slot","mark","moveInline","adminLabel","innerText","applyFilter","tools","vis","readyState","once","initAdminSidebar","THEME_KEY","applyTheme","root","updateThemeUI","cs","getComputedStyle","auto","getPropertyValue","light","dark","style","background","Theme","cycle","order","savedTheme","btnQuick","btnPalette","rbAuto","rbLight","rbDark","rb","initAdminExtensions","warn"],"sourceRoot":""}