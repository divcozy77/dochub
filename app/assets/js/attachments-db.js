/*! DocHub Attachments DB (IndexedDB) */
window.AttachmentsDB=function(){const e="files";let t=null;async function n(){return t||await new Promise((n,o)=>{const r=indexedDB.open("dochub-attachments",1);r.onupgradeneeded=t=>{const n=t.target.result;n.objectStoreNames.contains(e)||n.createObjectStore(e,{keyPath:"key"}).createIndex("docId","docId",{unique:!1})},r.onsuccess=()=>{t=r.result,n(t)},r.onerror=()=>o(r.error)}),t}function o(e,t){return`${e}:${t}`}function r(r,c){return n().then(()=>new Promise((n,a)=>{const d=t.transaction(e,"readonly");d.objectStore(e).get(o(r,c)).onsuccess=e=>{const t=e.target.result;if(!t)return n(null);n(t.blob)},d.onerror=()=>a(d.error)}))}return{init:n,add:function(r,c){return n().then(()=>new Promise((n,a)=>{const d=crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).slice(2),s={key:o(r,d),id:d,docId:r,name:c.name,size:c.size,type:c.type||"application/pdf",addedAt:(new Date).toISOString(),blob:c},i=t.transaction(e,"readwrite");i.objectStore(e).put(s),i.oncomplete=()=>n({id:d,name:s.name,size:s.size,type:s.type,addedAt:s.addedAt}),i.onerror=()=>a(i.error)}))},list:function(o){return n().then(()=>new Promise((n,r)=>{const c=[],a=t.transaction(e,"readonly"),d=a.objectStore(e).index("docId"),s=IDBKeyRange.only(o);d.openCursor(s).onsuccess=e=>{const t=e.target.result;if(t){const e=t.value;c.push({id:e.id,name:e.name,size:e.size,type:e.type,addedAt:e.addedAt}),t.continue()}},a.oncomplete=()=>n(c.sort((e,t)=>t.addedAt.localeCompare(e.addedAt))),a.onerror=()=>r(a.error)}))},remove:function(r,c){return n().then(()=>new Promise((n,a)=>{const d=t.transaction(e,"readwrite");d.objectStore(e).delete(o(r,c)),d.oncomplete=()=>n(!0),d.onerror=()=>a(d.error)}))},getBlob:r,getUrl:async function(e,t){const n=await r(e,t);return n?URL.createObjectURL(n):null}}}();